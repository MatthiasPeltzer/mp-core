var O=Object.defineProperty,q=Object.getOwnPropertyNames,I=(e,t)=>function(){return e&&(t=(0,e[q(e)[0]])(e=0)),t},K=(e,t)=>{for(var i in t)O(e,i,{get:t[i],enumerable:!0})},H={};K(H,{HTML5Renderer:()=>z});var z,V=I({"src/renderers/HTML5Renderer.js"(){z=class{constructor(e){this.player=e,this.media=e.element}async init(){this.media.controls=!1,this.media.removeAttribute("controls"),this.attachEvents(),this.media.preload=this.player.options.preload,this.media.load()}attachEvents(){this.media.addEventListener("loadedmetadata",()=>{this.player.state.duration=this.media.duration,this.player.emit("loadedmetadata")}),this.media.addEventListener("play",()=>{this.player.state.playing=!0,this.player.state.paused=!1,this.player.state.ended=!1,this.player.emit("play"),this.player.options.onPlay&&this.player.options.onPlay.call(this.player),this.player.options.pauseOthersOnPlay&&this.pauseOtherPlayers()}),this.media.addEventListener("pause",()=>{this.player.state.playing=!1,this.player.state.paused=!0,this.player.emit("pause"),this.player.options.onPause&&this.player.options.onPause.call(this.player)}),this.media.addEventListener("ended",()=>{this.player.state.playing=!1,this.player.state.paused=!0,this.player.state.ended=!0,this.player.emit("ended"),this.player.options.onEnded&&this.player.options.onEnded.call(this.player),this.player.options.loop&&(this.player.seek(0),this.player.play())}),this.media.addEventListener("timeupdate",()=>{this.player.state.currentTime=this.media.currentTime,this.player.emit("timeupdate",this.media.currentTime),this.player.options.onTimeUpdate&&this.player.options.onTimeUpdate.call(this.player,this.media.currentTime)}),this.media.addEventListener("volumechange",()=>{this.player.state.volume=this.media.volume,this.player.state.muted=this.media.muted,this.player.emit("volumechange",this.media.volume),this.player.options.onVolumeChange&&this.player.options.onVolumeChange.call(this.player,this.media.volume)}),this.media.addEventListener("seeking",()=>{this.player.state.seeking=!0,this.player.emit("seeking")}),this.media.addEventListener("seeked",()=>{this.player.state.seeking=!1,this.player.emit("seeked")}),this.media.addEventListener("waiting",()=>{this.player.state.buffering=!0,this.player.emit("waiting")}),this.media.addEventListener("canplay",()=>{this.player.state.buffering=!1,this.player.emit("canplay")}),this.media.addEventListener("progress",()=>{if(this.media.buffered.length>0){const e=this.media.buffered.end(this.media.buffered.length-1);this.player.emit("progress",e)}}),this.media.addEventListener("error",e=>{this.player.handleError(this.media.error)}),this.media.addEventListener("ratechange",()=>{this.player.state.playbackSpeed=this.media.playbackRate,this.player.emit("ratechange",this.media.playbackRate)})}pauseOtherPlayers(){document.querySelectorAll(".vidply-player").forEach(t=>{if(t!==this.player.container){const i=t.querySelector("video, audio");i&&!i.paused&&i.pause()}})}play(){const e=this.media.play();e!==void 0&&e.catch(t=>{this.player.log("Play failed:",t,"warn"),this.player.options.autoplay&&!this.player.state.muted&&(this.player.log("Retrying play with muted audio","info"),this.media.muted=!0,this.media.play().catch(i=>{this.player.handleError(i)}))})}pause(){this.media.pause()}seek(e){this.media.currentTime=e}setVolume(e){this.media.volume=e}setMuted(e){this.media.muted=e}setPlaybackSpeed(e){this.media.playbackRate=e}getQualities(){const e=Array.from(this.media.querySelectorAll("source"));return e.length<=1?[]:e.map((t,i)=>{const s=t.getAttribute("data-quality")||t.getAttribute("label")||"",a=t.getAttribute("data-height")||this.extractHeightFromLabel(s),n=t.getAttribute("data-width")||"";return{index:i,height:a?parseInt(a):0,width:n?parseInt(n):0,src:t.src,type:t.type,name:s||(a?`${a}p`:`Quality ${i+1}`)}}).filter(t=>t.height>0)}extractHeightFromLabel(e){const t=e.match(/(\d+)p/i);return t?parseInt(t[1]):0}switchQuality(e){const t=this.getQualities();if(e<0||e>=t.length){this.player.log("Invalid quality index","warn");return}const i=t[e],s=this.media.currentTime,a=!this.media.paused;if(this.media.currentSrc===i.src){this.player.log("Already at this quality level","info");return}this.player.log(`Switching to quality: ${i.name}`,"info"),this.media.src=i.src;const o=()=>{this.media.removeEventListener("loadedmetadata",o),this.media.currentTime=s,a&&this.media.play().catch(r=>{this.player.log("Failed to resume playback after quality switch","warn")}),this.player.emit("qualitychange",{quality:i.name,index:e})};this.media.addEventListener("loadedmetadata",o),this.media.load()}getCurrentQuality(){const e=this.getQualities(),t=this.media.currentSrc;for(let i=0;i<e.length;i++)if(e[i].src===t)return i;return 0}destroy(){this.media.removeEventListener("loadedmetadata",()=>{}),this.media.removeEventListener("play",()=>{}),this.media.removeEventListener("pause",()=>{})}}}}),_=class{constructor(){this.events={}}on(e,t){return this.events[e]||(this.events[e]=[]),this.events[e].push(t),this}once(e,t){const i=(...s)=>{t(...s),this.off(e,i)};return this.on(e,i)}off(e,t){return this.events[e]?(t?this.events[e]=this.events[e].filter(i=>i!==t):delete this.events[e],this):this}emit(e,...t){return this.events[e]?(this.events[e].forEach(i=>{i(...t)}),this):this}removeAllListeners(){return this.events={},this}},l={createElement(e,t={}){const i=document.createElement(e);return t.className&&(i.className=t.className),t.attributes&&Object.entries(t.attributes).forEach(([s,a])=>{i.setAttribute(s,a)}),t.innerHTML&&(i.innerHTML=t.innerHTML),t.textContent&&(i.textContent=t.textContent),t.style&&Object.assign(i.style,t.style),t.children&&t.children.forEach(s=>{s&&i.appendChild(s)}),i},addClass(e,t){e&&t&&e.classList.add(t)},removeClass(e,t){e&&t&&e.classList.remove(t)},toggleClass(e,t){e&&t&&e.classList.toggle(t)},hasClass(e,t){return e&&e.classList.contains(t)},show(e){e&&(e.style.display="")},hide(e){e&&(e.style.display="none")},fadeIn(e,t=300){if(!e)return;e.style.opacity="0",e.style.display="";let i=null;const s=a=>{i||(i=a);const n=a-i,o=Math.min(n/t,1);e.style.opacity=o,n<t&&requestAnimationFrame(s)};requestAnimationFrame(s)},fadeOut(e,t=300){if(!e)return;const i=parseFloat(getComputedStyle(e).opacity)||1;let s=null;const a=n=>{s||(s=n);const o=n-s,r=Math.max(i-o/t,0);e.style.opacity=r,o<t?requestAnimationFrame(a):e.style.display="none"};requestAnimationFrame(a)},offset(e){if(!e)return{top:0,left:0};const t=e.getBoundingClientRect();return{top:t.top+window.pageYOffset,left:t.left+window.pageXOffset,width:t.width,height:t.height}},escapeHTML(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML},sanitizeHTML(e){const t=document.createElement("div"),i=e.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,"").replace(/<iframe\b[^<]*(?:(?!<\/iframe>)<[^<]*)*<\/iframe>/gi,"").replace(/on\w+\s*=/gi,"").replace(/javascript:/gi,"");return t.innerHTML=i,t.innerHTML}},Q={en:{player:{label:"Video Player",play:"Play",pause:"Pause",stop:"Stop",restart:"Restart from beginning",rewind:"Rewind",forward:"Forward",rewindSeconds:"Rewind {seconds} seconds",forwardSeconds:"Forward {seconds} seconds",previous:"Previous track",next:"Next track",volume:"Volume",mute:"Mute",unmute:"Unmute",fullscreen:"Fullscreen",exitFullscreen:"Exit Fullscreen",captions:"Captions",chapters:"Chapters",quality:"Quality",captionStyling:"Caption styling",transcript:"Toggle transcript",audioDescription:"Audio description",signLanguage:"Sign language video",settings:"Settings",speed:"Playback Speed",pip:"Picture in Picture",currentTime:"Current time",duration:"Duration",progress:"Progress",seekForward:"Seek forward {seconds} seconds",seekBackward:"Seek backward {seconds} seconds",volumeUp:"Volume up",volumeDown:"Volume down",loading:"Loading...",loadingChapters:"Loading chapters...",error:"Error loading media",buffering:"Buffering...",signLanguageVideo:"Sign Language Video",noChapters:"No chapters available",noCaptions:"No captions available",auto:"Auto",autoQuality:"Auto (no quality selection available)",noQuality:"Quality selection not available",signLanguageDragResize:"Sign Language Video - Press D to drag with keyboard, R to resize",signLanguageDragActive:"Sign Language Video - Drag mode active. Use arrow keys to move, Escape to exit.",signLanguageResizeActive:"Sign Language Video - Resize mode active. Use left/right arrow keys to resize, Escape to exit.",resizeHandle:"Resize {direction} corner"},captions:{off:"Off",select:"Select captions",fontSize:"Font Size",fontFamily:"Font Family",color:"Text Color",backgroundColor:"Background Color",opacity:"Opacity"},fontSizes:{small:"Small",normal:"Normal",large:"Large",xlarge:"X-Large"},fontFamilies:{sansSerif:"Sans-serif",serif:"Serif",monospace:"Monospace"},styleLabels:{textColor:"Text Color",background:"Background",font:"Font",fontSize:"Font Size",opacity:"Opacity"},audioDescription:{enable:"Enable audio description",disable:"Disable audio description"},signLanguage:{show:"Show sign language video",hide:"Hide sign language video"},transcript:{title:"Transcript",close:"Close transcript",loading:"Loading transcript...",noTranscript:"No transcript available for this video.",settings:"Transcript settings. Press Enter to open menu, or D to enable drag mode",keyboardDragMode:"Toggle keyboard drag mode with arrow keys. Shortcut: D key",keyboardDragActive:"⌨️ Keyboard Drag Mode Active (Arrow keys to move, Shift+Arrows for large steps, D or ESC to exit)",dragResizePrompt:"Press D to drag or R to resize. Use Home to reset position, Esc to close.",dragModeEnabled:"Keyboard drag mode enabled. Use arrow keys to move, Shift+Arrow for larger steps. Press D or Esc to exit.",dragModeDisabled:"Keyboard drag mode disabled.",resizeWindow:"Resize Window",disableResizeWindow:"Disable Resize Mode",resizeModeHint:"Resize handles enabled. Drag edges or corners to adjust. Press Esc or R to exit.",resizeModeEnabled:"Resize mode enabled. Drag edges or corners to adjust. Press Esc or R to exit.",resizeModeDisabled:"Resize mode disabled.",positionReset:"Transcript position reset.",styleTranscript:"Open transcript style settings",closeMenu:"Close Menu",styleTitle:"Transcript Style",autoscroll:"Autoscroll",settingsMenu:"Settings menu"},settings:{title:"Settings",quality:"Quality",speed:"Speed",captions:"Captions",language:"Language",reset:"Reset to defaults",close:"Close"},speeds:{normal:"Normal"},time:{display:"Time display",durationPrefix:"Duration: ",hour:"{count} hour",hours:"{count} hours",minute:"{count} minute",minutes:"{count} minutes",second:"{count} second",seconds:"{count} seconds"}},de:{player:{label:"Videoplayer",play:"Abspielen",pause:"Pause",stop:"Stopp",restart:"Von vorne beginnen",rewind:"Zurückspulen",forward:"Vorspulen",rewindSeconds:"{seconds} Sekunden zurückspulen",forwardSeconds:"{seconds} Sekunden vorspulen",previous:"Vorheriger Titel",next:"Nächster Titel",volume:"Lautstärke",mute:"Stumm",unmute:"Ton ein",fullscreen:"Vollbild",exitFullscreen:"Vollbild beenden",captions:"Untertitel",chapters:"Kapitel",quality:"Qualität",captionStyling:"Untertitel-Stil",transcript:"Transkript umschalten",audioDescription:"Audiodeskription",signLanguage:"Gebärdensprache-Video",settings:"Einstellungen",speed:"Wiedergabegeschwindigkeit",pip:"Bild-in-Bild",currentTime:"Aktuelle Zeit",duration:"Dauer",progress:"Fortschritt",seekForward:"{seconds} Sekunden vorspulen",seekBackward:"{seconds} Sekunden zurückspulen",volumeUp:"Lauter",volumeDown:"Leiser",loading:"Lädt...",loadingChapters:"Kapitel werden geladen...",error:"Fehler beim Laden",buffering:"Puffern...",signLanguageVideo:"Gebärdensprache-Video",noChapters:"Keine Kapitel verfügbar",noCaptions:"Keine Untertitel verfügbar",auto:"Automatisch",autoQuality:"Automatisch (keine Qualitätsauswahl verfügbar)",noQuality:"Qualitätsauswahl nicht verfügbar",signLanguageDragResize:"Gebärdensprache-Video - Drücken Sie D zum Verschieben per Tastatur, R zum Ändern der Größe",signLanguageDragActive:"Gebärdensprache-Video - Verschiebemodus aktiv. Pfeiltasten zum Bewegen, Escape zum Beenden.",signLanguageResizeActive:"Gebärdensprache-Video - Größenänderungsmodus aktiv. Links-/Rechts-Pfeiltasten zum Ändern der Größe, Escape zum Beenden.",resizeHandle:"Größenänderung {direction}-Ecke"},captions:{off:"Aus",select:"Untertitel auswählen",fontSize:"Schriftgröße",fontFamily:"Schriftart",color:"Textfarbe",backgroundColor:"Hintergrundfarbe",opacity:"Deckkraft"},fontSizes:{small:"Klein",normal:"Normal",large:"Groß",xlarge:"Sehr groß"},fontFamilies:{sansSerif:"Sans-serif",serif:"Serif",monospace:"Monospace"},styleLabels:{textColor:"Textfarbe",background:"Hintergrund",font:"Schrift",fontSize:"Schriftgröße",opacity:"Deckkraft"},audioDescription:{enable:"Audiodeskription aktivieren",disable:"Audiodeskription deaktivieren"},signLanguage:{show:"Gebärdensprache-Video anzeigen",hide:"Gebärdensprache-Video ausblenden"},transcript:{title:"Transkript",close:"Transkript schließen",loading:"Transkript wird geladen...",noTranscript:"Kein Transkript für dieses Video verfügbar.",settings:"Transkript-Einstellungen. Eingabetaste zum Öffnen des Menüs drücken oder D zum Aktivieren des Verschiebemodus",keyboardDragMode:"Tastatur-Verschiebemodus mit Pfeiltasten umschalten. Tastenkombination: D-Taste",keyboardDragActive:"⌨️ Tastatur-Verschiebemodus aktiv (Pfeiltasten zum Bewegen, Umschalt+Pfeiltasten für große Schritte, D oder ESC zum Beenden)",dragResizePrompt:"Drücken Sie D zum Verschieben oder R zur Größenänderung. Home setzt die Position zurück, Esc schließt.",dragModeEnabled:"Tastatur-Verschiebemodus aktiviert. Pfeiltasten zum Bewegen, Umschalt+Pfeiltasten für größere Schritte. D oder Esc zum Beenden.",dragModeDisabled:"Tastatur-Verschiebemodus deaktiviert.",resizeWindow:"Fenster vergrößern/verkleinern",disableResizeWindow:"Resize-Modus deaktivieren",resizeModeHint:"Griffe aktiviert. Ziehen Sie Kanten oder Ecken zum Anpassen. Esc oder R zum Beenden.",resizeModeEnabled:"Resize-Modus aktiviert. Kanten oder Ecken ziehen; Esc oder R beendet.",resizeModeDisabled:"Resize-Modus deaktiviert.",positionReset:"Transkriptposition zurückgesetzt.",styleTranscript:"Transkript-Stileinstellungen öffnen",closeMenu:"Menü schließen",styleTitle:"Transkript-Stil",autoscroll:"Automatisches Scrollen",settingsMenu:"Einstellungsmenü"},settings:{title:"Einstellungen",quality:"Qualität",speed:"Geschwindigkeit",captions:"Untertitel",language:"Sprache",reset:"Zurücksetzen",close:"Schließen"},speeds:{normal:"Normal"},time:{display:"Zeitanzeige",durationPrefix:"Dauer: ",hour:"{count} Stunde",hours:"{count} Stunden",minute:"{count} Minute",minutes:"{count} Minuten",second:"{count} Sekunde",seconds:"{count} Sekunden"}},es:{player:{label:"Reproductor de video",play:"Reproducir",pause:"Pausa",stop:"Detener",restart:"Reiniciar desde el principio",rewind:"Retroceder",forward:"Avanzar",rewindSeconds:"Retroceder {seconds} segundos",forwardSeconds:"Avanzar {seconds} segundos",previous:"Pista anterior",next:"Siguiente pista",volume:"Volumen",mute:"Silenciar",unmute:"Activar sonido",fullscreen:"Pantalla completa",exitFullscreen:"Salir de pantalla completa",captions:"Subtítulos",chapters:"Capítulos",quality:"Calidad",captionStyling:"Estilo de subtítulos",transcript:"Alternar transcripción",audioDescription:"Audiodescripción",signLanguage:"Video en lengua de señas",settings:"Configuración",speed:"Velocidad de reproducción",pip:"Imagen en imagen",currentTime:"Tiempo actual",duration:"Duración",progress:"Progreso",seekForward:"Avanzar {seconds} segundos",seekBackward:"Retroceder {seconds} segundos",volumeUp:"Subir volumen",volumeDown:"Bajar volumen",loading:"Cargando...",loadingChapters:"Cargando capítulos...",error:"Error al cargar",buffering:"Almacenando en búfer...",signLanguageVideo:"Video en Lengua de Señas",noChapters:"No hay capítulos disponibles",noCaptions:"No hay subtítulos disponibles",auto:"Automático",autoQuality:"Automático (selección de calidad no disponible)",noQuality:"Selección de calidad no disponible",signLanguageDragResize:"Video en Lengua de Señas - Presione D para arrastrar con el teclado, R para cambiar el tamaño",signLanguageDragActive:"Video en Lengua de Señas - Modo de arrastre activo. Use las teclas de flecha para mover, Escape para salir.",signLanguageResizeActive:"Video en Lengua de Señas - Modo de cambio de tamaño activo. Use las teclas de flecha izquierda/derecha para cambiar el tamaño, Escape para salir.",resizeHandle:"Cambiar tamaño esquina {direction}"},captions:{off:"Desactivado",select:"Seleccionar subtítulos",fontSize:"Tamaño de fuente",fontFamily:"Familia de fuente",color:"Color de texto",backgroundColor:"Color de fondo",opacity:"Opacidad"},fontSizes:{small:"Pequeño",normal:"Normal",large:"Grande",xlarge:"Muy grande"},fontFamilies:{sansSerif:"Sans-serif",serif:"Serif",monospace:"Monospace"},styleLabels:{textColor:"Color de texto",background:"Fondo",font:"Fuente",fontSize:"Tamaño de fuente",opacity:"Opacidad"},audioDescription:{enable:"Activar audiodescripción",disable:"Desactivar audiodescripción"},signLanguage:{show:"Mostrar video en lengua de señas",hide:"Ocultar video en lengua de señas"},transcript:{title:"Transcripción",close:"Cerrar transcripción",loading:"Cargando transcripción...",noTranscript:"No hay transcripción disponible para este video.",settings:"Configuración de transcripción. Presione Enter para abrir el menú o D para activar el modo de arrastre",keyboardDragMode:"Alternar modo de arrastre con teclado usando teclas de flecha. Atajo: tecla D",keyboardDragActive:"⌨️ Modo de Arrastre con Teclado Activo (Teclas de flecha para mover, Mayús+Flechas para pasos grandes, D o ESC para salir)",dragResizePrompt:"Pulsa D para mover o R para cambiar el tamaño. Home restablece la posición; Esc cierra.",dragModeEnabled:"Modo de arrastre con teclado activado. Usa flechas para mover, Mayús+Flechas para pasos grandes. Pulsa D o Esc para salir.",dragModeDisabled:"Modo de arrastre con teclado desactivado.",resizeWindow:"Cambiar tamaño de ventana",disableResizeWindow:"Desactivar modo de cambio de tamaño",resizeModeHint:"Controladores habilitados. Arrastra bordes o esquinas para ajustar. Pulsa Esc o R para salir.",resizeModeEnabled:"Modo de cambio de tamaño activado. Arrastra bordes o esquinas. Pulsa Esc o R para salir.",resizeModeDisabled:"Modo de cambio de tamaño desactivado.",positionReset:"Posición de la transcripción restablecida.",styleTranscript:"Abrir configuración de estilo de transcripción",closeMenu:"Cerrar menú",styleTitle:"Estilo de Transcripción",autoscroll:"Desplazamiento automático",settingsMenu:"Menú de configuración"},settings:{title:"Configuración",quality:"Calidad",speed:"Velocidad",captions:"Subtítulos",language:"Idioma",reset:"Restablecer",close:"Cerrar"},speeds:{normal:"Normal"},time:{display:"Visualización de tiempo",durationPrefix:"Duración: ",hour:"{count} hora",hours:"{count} horas",minute:"{count} minuto",minutes:"{count} minutos",second:"{count} segundo",seconds:"{count} segundos"}},fr:{player:{label:"Lecteur vidéo",play:"Lecture",pause:"Pause",stop:"Arrêt",restart:"Redémarrer du début",rewind:"Reculer",forward:"Avancer",rewindSeconds:"Reculer de {seconds} secondes",forwardSeconds:"Avancer de {seconds} secondes",previous:"Piste précédente",next:"Piste suivante",volume:"Volume",mute:"Muet",unmute:"Activer le son",fullscreen:"Plein écran",exitFullscreen:"Quitter le plein écran",captions:"Sous-titres",chapters:"Chapitres",quality:"Qualité",captionStyling:"Style des sous-titres",transcript:"Activer/désactiver la transcription",audioDescription:"Audiodescription",signLanguage:"Vidéo en langue des signes",settings:"Paramètres",speed:"Vitesse de lecture",pip:"Image dans l'image",currentTime:"Temps actuel",duration:"Durée",progress:"Progression",seekForward:"Avancer de {seconds} secondes",seekBackward:"Reculer de {seconds} secondes",volumeUp:"Augmenter le volume",volumeDown:"Diminuer le volume",loading:"Chargement...",loadingChapters:"Chargement des chapitres...",error:"Erreur de chargement",buffering:"Mise en mémoire tampon...",signLanguageVideo:"Vidéo en Langue des Signes",noChapters:"Aucun chapitre disponible",noCaptions:"Aucun sous-titre disponible",auto:"Automatique",autoQuality:"Automatique (sélection de qualité non disponible)",noQuality:"Sélection de qualité non disponible",signLanguageDragResize:"Vidéo en Langue des Signes - Appuyez sur D pour déplacer avec le clavier, R pour redimensionner",signLanguageDragActive:"Vidéo en Langue des Signes - Mode glissement actif. Utilisez les touches fléchées pour déplacer, Échap pour quitter.",signLanguageResizeActive:"Vidéo en Langue des Signes - Mode redimensionnement actif. Utilisez les touches fléchées gauche/droite pour redimensionner, Échap pour quitter.",resizeHandle:"Redimensionner coin {direction}"},captions:{off:"Désactivé",select:"Sélectionner les sous-titres",fontSize:"Taille de police",fontFamily:"Police",color:"Couleur du texte",backgroundColor:"Couleur de fond",opacity:"Opacité"},fontSizes:{small:"Petit",normal:"Normal",large:"Grand",xlarge:"Très grand"},fontFamilies:{sansSerif:"Sans-serif",serif:"Serif",monospace:"Monospace"},styleLabels:{textColor:"Couleur du texte",background:"Arrière-plan",font:"Police",fontSize:"Taille de police",opacity:"Opacité"},audioDescription:{enable:"Activer l'audiodescription",disable:"Désactiver l'audiodescription"},signLanguage:{show:"Afficher la vidéo en langue des signes",hide:"Masquer la vidéo en langue des signes"},transcript:{title:"Transcription",close:"Fermer la transcription",loading:"Chargement de la transcription...",noTranscript:"Aucune transcription disponible pour cette vidéo.",settings:"Paramètres de transcription. Appuyez sur Entrée pour ouvrir le menu ou D pour activer le mode glissement",keyboardDragMode:"Basculer le mode glissement avec les touches fléchées. Raccourci: touche D",keyboardDragActive:"⌨️ Mode Glissement Clavier Actif (Touches fléchées pour déplacer, Maj+Fléchées pour grands pas, D ou Échap pour quitter)",dragResizePrompt:"Appuyez sur D pour déplacer ou R pour redimensionner. Home réinitialise la position, Échap ferme.",dragModeEnabled:"Mode glissement clavier activé. Utilisez les flèches pour déplacer, Maj+Flèches pour de grands pas. Appuyez sur D ou Échap pour quitter.",dragModeDisabled:"Mode glissement clavier désactivé.",resizeWindow:"Redimensionner la fenêtre",disableResizeWindow:"Désactiver le mode de redimensionnement",resizeModeHint:"Poignées activées. Faites glisser les bords ou les coins pour ajuster. Appuyez sur Échap ou R pour quitter.",resizeModeEnabled:"Mode redimensionnement activé. Faites glisser les bords ou coins. Appuyez sur Échap ou R pour quitter.",resizeModeDisabled:"Mode redimensionnement désactivé.",positionReset:"Position de la transcription réinitialisée.",styleTranscript:"Ouvrir les paramètres de style de transcription",closeMenu:"Fermer le menu",styleTitle:"Style de Transcription",autoscroll:"Défilement automatique",settingsMenu:"Menu des paramètres"},settings:{title:"Paramètres",quality:"Qualité",speed:"Vitesse",captions:"Sous-titres",language:"Langue",reset:"Réinitialiser",close:"Fermer"},speeds:{normal:"Normal"},time:{display:"Affichage du temps",durationPrefix:"Durée : ",hour:"{count} heure",hours:"{count} heures",minute:"{count} minute",minutes:"{count} minutes",second:"{count} seconde",seconds:"{count} secondes"}},ja:{player:{label:"ビデオプレーヤー",play:"再生",pause:"一時停止",stop:"停止",restart:"最初から再生",rewind:"巻き戻し",forward:"早送り",rewindSeconds:"{seconds}秒戻す",forwardSeconds:"{seconds}秒進める",previous:"前のトラック",next:"次のトラック",volume:"音量",mute:"ミュート",unmute:"ミュート解除",fullscreen:"全画面表示",exitFullscreen:"全画面表示を終了",captions:"字幕",chapters:"チャプター",quality:"画質",captionStyling:"字幕スタイル",transcript:"文字起こし切り替え",audioDescription:"音声解説",signLanguage:"手話動画",settings:"設定",speed:"再生速度",pip:"ピクチャーインピクチャー",currentTime:"現在の時間",duration:"再生時間",progress:"進行状況",seekForward:"{seconds}秒進める",seekBackward:"{seconds}秒戻す",volumeUp:"音量を上げる",volumeDown:"音量を下げる",loading:"読み込み中...",loadingChapters:"チャプター読み込み中...",error:"読み込みエラー",buffering:"バッファリング中...",signLanguageVideo:"手話動画",noChapters:"チャプターがありません",noCaptions:"字幕がありません",auto:"自動",autoQuality:"自動（画質選択不可）",noQuality:"画質選択不可",signLanguageDragResize:"手話動画 - キーボードでドラッグするにはDキーを、サイズ変更するにはRキーを押してください",signLanguageDragActive:"手話動画 - ドラッグモードが有効です。矢印キーで移動、Escapeで終了します。",signLanguageResizeActive:"手話動画 - サイズ変更モードが有効です。左右の矢印キーでサイズ変更、Escapeで終了します。",resizeHandle:"{direction}コーナーのサイズ変更"},captions:{off:"オフ",select:"字幕を選択",fontSize:"フォントサイズ",fontFamily:"フォント",color:"テキストの色",backgroundColor:"背景色",opacity:"不透明度"},fontSizes:{small:"小",normal:"標準",large:"大",xlarge:"特大"},fontFamilies:{sansSerif:"サンセリフ",serif:"セリフ",monospace:"等幅"},styleLabels:{textColor:"テキストの色",background:"背景",font:"フォント",fontSize:"フォントサイズ",opacity:"不透明度"},audioDescription:{enable:"音声解説を有効にする",disable:"音声解説を無効にする"},signLanguage:{show:"手話動画を表示",hide:"手話動画を非表示"},transcript:{title:"文字起こし",close:"文字起こしを閉じる",loading:"文字起こしを読み込み中...",noTranscript:"このビデオの文字起こしはありません。",settings:"文字起こし設定。Enterキーでメニューを開く、またはDキーでドラッグモードを有効にする",keyboardDragMode:"矢印キーでキーボードドラッグモードを切り替え。ショートカット：Dキー",keyboardDragActive:"⌨️ キーボードドラッグモード有効（矢印キーで移動、Shift+矢印キーで大きく移動、DまたはESCで終了）",dragResizePrompt:"Dキーで移動、Rキーでサイズ変更。Homeで位置をリセット、Escで閉じます。",dragModeEnabled:"キーボードドラッグモードを有効にしました。矢印キーで移動、Shift+矢印キーで大きく移動できます。終了するには D または Esc を押します。",dragModeDisabled:"キーボードドラッグモードを無効にしました。",resizeWindow:"ウィンドウのサイズ変更",disableResizeWindow:"サイズ変更モードを無効にする",resizeModeHint:"リサイズハンドルが有効になりました。辺や角をドラッグして調整します。Esc または R で終了します。",resizeModeEnabled:"サイズ変更モードを有効にしました。辺や角をドラッグして調整します。Esc または R で終了します。",resizeModeDisabled:"サイズ変更モードを無効にしました。",positionReset:"文字起こしの位置をリセットしました。",styleTranscript:"文字起こしスタイル設定を開く",closeMenu:"メニューを閉じる",styleTitle:"文字起こしスタイル",autoscroll:"自動スクロール",settingsMenu:"設定メニュー"},settings:{title:"設定",quality:"画質",speed:"速度",captions:"字幕",language:"言語",reset:"リセット",close:"閉じる"},speeds:{normal:"通常"},time:{display:"時間表示",durationPrefix:"再生時間: ",hour:"{count}時間",hours:"{count}時間",minute:"{count}分",minutes:"{count}分",second:"{count}秒",seconds:"{count}秒"}}},U=class{constructor(){this.currentLanguage="en",this.translations=Q}setLanguage(e){this.translations[e]?this.currentLanguage=e:(console.warn(`Language "${e}" not found, falling back to English`),this.currentLanguage="en")}getLanguage(){return this.currentLanguage}t(e,t={}){const i=e.split(".");let s=this.translations[this.currentLanguage];for(const a of i)if(s&&typeof s=="object"&&a in s)s=s[a];else{s=this.translations.en;for(const n of i)if(s&&typeof s=="object"&&n in s)s=s[n];else return e;break}return typeof s=="string"&&Object.entries(t).forEach(([a,n])=>{s=s.replace(new RegExp(`{${a}}`,"g"),n)}),s}addTranslation(e,t){this.translations[e]||(this.translations[e]={}),Object.assign(this.translations[e],t)}},u=new U,T={formatTime(e,t=!1){if(!isFinite(e)||e<0)return t?"00:00:00":"00:00";const i=Math.floor(e/3600),s=Math.floor(e%3600/60),a=Math.floor(e%60),n=o=>String(o).padStart(2,"0");return i>0||t?`${n(i)}:${n(s)}:${n(a)}`:`${n(s)}:${n(a)}`},parseTime(e){const t=e.split(":").map(i=>parseInt(i,10));return t.length===3?t[0]*3600+t[1]*60+t[2]:t.length===2?t[0]*60+t[1]:t.length===1?t[0]:0},formatDuration(e){if(!isFinite(e)||e<0)return u.t("time.seconds",{count:0});const t=Math.floor(e/3600),i=Math.floor(e%3600/60),s=Math.floor(e%60),a=[];if(t>0){const n=t===1?"time.hour":"time.hours";a.push(u.t(n,{count:t}))}if(i>0){const n=i===1?"time.minute":"time.minutes";a.push(u.t(n,{count:i}))}if(s>0||a.length===0){const n=s===1?"time.second":"time.seconds";a.push(u.t(n,{count:s}))}return a.join(", ")},formatPercentage(e,t){return t===0?0:Math.round(e/t*100)}},Y={play:'<path d="M8 5v14l11-7z"/>',pause:'<path d="M6 4h4v16H6V4zm8 0h4v16h-4V4z"/>',stop:'<rect x="6" y="6" width="12" height="12"/>',rewind:'<path d="M11 18V6l-8.5 6 8.5 6zm.5-6l8.5 6V6l-8.5 6z"/>',forward:'<path d="M4 18l8.5-6L4 6v12zm9-12v12l8.5-6L13 6z"/>',skipPrevious:'<path d="M6 6h2v12H6V6zm3 6l8.5 6V6L9 12z"/>',skipNext:'<path d="M16 6h2v12h-2V6zM6 6l8.5 6L6 18V6z"/>',restart:'<path d="M12 5V1L7 6l5 5V7c3.31 0 6 2.69 6 6s-2.69 6-6 6-6-2.69-6-6H4c0 4.42 3.58 8 8 8s8-3.58 8-8-3.58-8-8-8z"/>',volumeHigh:'<path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"/>',volumeMedium:'<path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02z"/>',volumeLow:'<path d="M7 9v6h4l5 5V4l-5 5H7z"/>',volumeMuted:'<path d="M16.5 12c0-1.77-1.02-3.29-2.5-4.03v2.21l2.45 2.45c.03-.2.05-.41.05-.63zm2.5 0c0 .94-.2 1.82-.54 2.64l1.51 1.51C20.63 14.91 21 13.5 21 12c0-4.28-2.99-7.86-7-8.77v2.06c2.89.86 5 3.54 5 6.71zM4.27 3L3 4.27 7.73 9H3v6h4l5 5v-6.73l4.25 4.25c-.67.52-1.42.93-2.25 1.18v2.06c1.38-.31 2.63-.95 3.69-1.81L19.73 21 21 19.73l-9-9L4.27 3zM12 4L9.91 6.09 12 8.18V4z"/>',fullscreen:'<path d="M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"/>',fullscreenExit:'<path d="M5 16h3v3h2v-5H5v2zm3-8H5v2h5V5H8v3zm6 11h2v-3h3v-2h-5v5zm2-11V5h-2v5h5V8h-3z"/>',settings:'<path d="M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94L14.4 2.81c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.09.63-.09.94s.02.64.07.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"/>',captions:'<path d="M19 4H5c-1.11 0-2 .9-2 2v12c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm-8 7H9.5v-.5h-2v3h2V13H11v1c0 .55-.45 1-1 1H7c-.55 0-1-.45-1-1v-4c0-.55.45-1 1-1h3c.55 0 1 .45 1 1v1zm7 0h-1.5v-.5h-2v3h2V13H18v1c0 .55-.45 1-1 1h-3c-.55 0-1-.45-1-1v-4c0-.55.45-1 1-1h3c.55 0 1 .45 1 1v1z"/>',captionsOff:'<path d="M19 4H5c-1.11 0-2 .9-2 2v12c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm-8 7H9.5v-.5h-2v3h2V13H11v1c0 .55-.45 1-1 1H7c-.55 0-1-.45-1-1v-4c0-.55.45-1 1-1h3c.55 0 1 .45 1 1v1zm7 0h-1.5v-.5h-2v3h2V13H18v1c0 .55-.45 1-1 1h-3c-.55 0-1-.45-1-1v-4c0-.55.45-1 1-1h3c.55 0 1 .45 1 1v1z"/><path d="M0 0h24v24H0z" fill="none"/>',pip:'<path d="M19 7h-8v6h8V7zm2-4H3c-1.1 0-2 .9-2 2v14c0 1.1.9 1.98 2 1.98h18c1.1 0 2-.88 2-1.98V5c0-1.1-.9-2-2-2zm0 16.01H3V4.98h18v14.03z"/>',speed:'<path d="M20.38 8.57l-1.23 1.85a8 8 0 0 1-.22 7.58H5.07A8 8 0 0 1 15.58 6.85l1.85-1.23A10 10 0 0 0 3.35 19a2 2 0 0 0 1.72 1h13.85a2 2 0 0 0 1.74-1 10 10 0 0 0-.27-10.44z"/><path d="M10.59 15.41a2 2 0 0 0 2.83 0l5.66-8.49-8.49 5.66a2 2 0 0 0 0 2.83z"/>',close:'<path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>',check:'<path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>',arrowUp:'<path d="M7 14l5-5 5 5z"/>',arrowDown:'<path d="M7 10l5 5 5-5z"/>',arrowLeft:'<path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/>',arrowRight:'<path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"/>',loading:'<path d="M12 4V1L8 5l4 4V6c3.31 0 6 2.69 6 6 0 1.01-.25 1.97-.7 2.8l1.46 1.46C19.54 15.03 20 13.57 20 12c0-4.42-3.58-8-8-8zm0 14c-3.31 0-6-2.69-6-6 0-1.01.25-1.97.7-2.8L5.24 7.74C4.46 8.97 4 10.43 4 12c0 4.42 3.58 8 8 8v3l4-4-4-4v3z"/>',error:'<path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/>',download:'<path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"/>',link:'<path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"/>',playlist:'<path d="M15 6H3v2h12V6zm0 4H3v2h12v-2zM3 16h8v-2H3v2zM17 6v8.18c-.31-.11-.65-.18-1-.18-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3V8h3V6h-5z"/>',language:'<path d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zm6.93 6h-2.95c-.32-1.25-.78-2.45-1.38-3.56 1.84.63 3.37 1.91 4.33 3.56zM12 4.04c.83 1.2 1.48 2.53 1.91 3.96h-3.82c.43-1.43 1.08-2.76 1.91-3.96zM4.26 14C4.1 13.36 4 12.69 4 12s.1-1.36.26-2h3.38c-.08.66-.14 1.32-.14 2 0 .68.06 1.34.14 2H4.26zm.82 2h2.95c.32 1.25.78 2.45 1.38 3.56-1.84-.63-3.37-1.9-4.33-3.56zm2.95-8H5.08c.96-1.66 2.49-2.93 4.33-3.56C8.81 5.55 8.35 6.75 8.03 8zM12 19.96c-.83-1.2-1.48-2.53-1.91-3.96h3.82c-.43 1.43-1.08 2.76-1.91 3.96zM14.34 14H9.66c-.09-.66-.16-1.32-.16-2 0-.68.07-1.35.16-2h4.68c.09.65.16 1.32.16 2 0 .68-.07 1.34-.16 2zm.25 5.56c.6-1.11 1.06-2.31 1.38-3.56h2.95c-.96 1.65-2.49 2.93-4.33 3.56zM16.36 14c.08-.66.14-1.32.14-2 0-.68-.06-1.34-.14-2h3.38c.16.64.26 1.31.26 2s-.1 1.36-.26 2h-3.38z"/>',hd:'<path d="M19 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.11 0 2-.9 2-2V5c0-1.1-.89-2-2-2zm-8 12H9.5v-2h-2v2H6V9h1.5v2.5h2V9H11v6zm7-1c0 .55-.45 1-1 1h-.75v1.5h-1.5V15H14c-.55 0-1-.45-1-1v-4c0-.55.45-1 1-1h3c.55 0 1 .45 1 1v4zm-3.5-.5h2v-3h-2v3z"/>',transcript:'<path d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z"/>',audioDescription:'<rect x="2" y="5" width="20" height="14" rx="2" fill="#ffffff" stroke="#ffffff" stroke-width="2"/><text x="12" y="16" font-family="Arial, sans-serif" font-size="10" font-weight="bold" text-anchor="middle" fill="#1a1a1a">AD</text>',audioDescriptionOn:'<rect x="2" y="5" width="20" height="14" rx="2" fill="none" stroke="currentColor" stroke-width="2"/><text x="12" y="16" font-family="Arial, sans-serif" font-size="10" font-weight="bold" text-anchor="middle" fill="currentColor">AD</text>',signLanguage:'<g transform="scale(1.5)"><path d="M16 11.3c-.1-.9-4.8 1.3-5.4 1.1-2.6-1 5.8-1.3 5.1-2.9s-5.1 1.5-6 1.4C6.5 9.4 16.5 9.1 13.5 8c-1.9-.6-8.8 2.9-6.8.4.7-.6.7-1.9-.7-1.7-9.7 7.2-.7 12.2 8.8 7 0-1.3-3.5.4-4.1.4-2.6 0 5.6-2 5.4-3ZM3.9 7.8c3.2-4.2 3.7 1.2 6 .1s.2-.2.2-.3c.7-2.7 2.5-7.5-1.5-1.3-1.6 0 1.1-4 1-4.6C8.9-1 7.3 4.4 7.2 4.9c-1.6.7-.9-1.4-.7-1.5 3-6-.6-3.1-.9.4-2.5 1.8 0-2.8 0-3.5C2.8-.9 4 9.4 1.1 4.9S.1 4.6 0 5c-.4 2.7 2.6 7.2 3.9 2.8Z"/></g>',signLanguageOn:'<g transform="scale(1.5)"><path d="M16 11.3c-.1-.9-4.8 1.3-5.4 1.1-2.6-1 5.8-1.3 5.1-2.9s-5.1 1.5-6 1.4C6.5 9.4 16.5 9.1 13.5 8c-1.9-.6-8.8 2.9-6.8.4.7-.6.7-1.9-.7-1.7-9.7 7.2-.7 12.2 8.8 7 0-1.3-3.5.4-4.1.4-2.6 0 5.6-2 5.4-3ZM3.9 7.8c3.2-4.2 3.7 1.2 6 .1s.2-.2.2-.3c.7-2.7 2.5-7.5-1.5-1.3-1.6 0 1.1-4 1-4.6C8.9-1 7.3 4.4 7.2 4.9c-1.6.7-.9-1.4-.7-1.5 3-6-.6-3.1-.9.4-2.5 1.8 0-2.8 0-3.5C2.8-.9 4 9.4 1.1 4.9S.1 4.6 0 5c-.4 2.7 2.6 7.2 3.9 2.8Z"/></g>',speaker:'<path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02z"/>',music:'<path d="M12 3v9.28c-.47-.17-.97-.28-1.5-.28C8.01 12 6 14.01 6 16.5S8.01 21 10.5 21c2.31 0 4.2-1.75 4.45-4H15V6h4V3h-7zm-1.5 16c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/>',moreVertical:'<path d="M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"/>',moreHorizontal:'<path d="M6 10c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm12 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm-6 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"/>',move:'<path d="M10 9h4V6h3l-5-5-5 5h3v3zm-1 1H6V7l-5 5 5 5v-3h3v-4zm14 2l-5-5v3h-3v4h3v3l5-5zm-9 3h-4v3H7l5 5 5-5h-3v-3z"/>',resize:'<path d="M21.71 11.29l-9-9c-.39-.39-1.02-.39-1.41 0l-9 9c-.39.39-.39 1.02 0 1.41l9 9c.39.39 1.02.39 1.41 0l9-9c.39-.38.39-1.01 0-1.41zM14 14.5V12h-4v2.5L7 11l3-3.5V10h4V7.5l3 3.5-3 3.5z"/>'},j=e=>`<svg viewBox="0 0 24 24" fill="currentColor">${e}</svg>`,P=Object.fromEntries(Object.entries(Y).map(([e,t])=>[e,j(t)]));function X(e){return P[e]||P.play}function f(e,t=""){const i=document.createElement("span");return i.className=`vidply-icon ${t}`.trim(),i.innerHTML=X(e),i.setAttribute("aria-hidden","true"),i}function G(){const e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.setAttribute("class","vidply-play-overlay"),e.setAttribute("viewBox","0 0 80 80"),e.setAttribute("width","80"),e.setAttribute("height","80"),e.setAttribute("aria-hidden","true"),e.setAttribute("role","presentation"),e.style.cursor="pointer";const t=document.createElementNS("http://www.w3.org/2000/svg","defs"),i=`vidply-play-shadow-${Math.random().toString(36).substr(2,9)}`,s=document.createElementNS("http://www.w3.org/2000/svg","filter");s.setAttribute("id",i),s.setAttribute("x","-50%"),s.setAttribute("y","-50%"),s.setAttribute("width","200%"),s.setAttribute("height","200%");const a=document.createElementNS("http://www.w3.org/2000/svg","feGaussianBlur");a.setAttribute("in","SourceAlpha"),a.setAttribute("stdDeviation","3");const n=document.createElementNS("http://www.w3.org/2000/svg","feOffset");n.setAttribute("dx","0"),n.setAttribute("dy","2"),n.setAttribute("result","offsetblur");const o=document.createElementNS("http://www.w3.org/2000/svg","feComponentTransfer"),r=document.createElementNS("http://www.w3.org/2000/svg","feFuncA");r.setAttribute("type","linear"),r.setAttribute("slope","0.3"),o.appendChild(r);const c=document.createElementNS("http://www.w3.org/2000/svg","feMerge"),d=document.createElementNS("http://www.w3.org/2000/svg","feMergeNode"),h=document.createElementNS("http://www.w3.org/2000/svg","feMergeNode");h.setAttribute("in","SourceGraphic"),c.appendChild(d),c.appendChild(h),s.appendChild(a),s.appendChild(n),s.appendChild(o),s.appendChild(c),t.appendChild(s),e.appendChild(t);const g=document.createElementNS("http://www.w3.org/2000/svg","circle");g.setAttribute("cx","40"),g.setAttribute("cy","40"),g.setAttribute("r","40"),g.setAttribute("fill","rgba(255, 255, 255, 0.95)"),g.setAttribute("filter",`url(#${i})`),g.setAttribute("class","vidply-play-overlay-bg"),e.appendChild(g);const y=document.createElementNS("http://www.w3.org/2000/svg","polygon");return y.setAttribute("points","32,28 32,52 54,40"),y.setAttribute("fill","#0a406e"),y.setAttribute("class","vidply-play-overlay-icon"),e.appendChild(y),e}var J=class{constructor(e){this.player=e,this.element=null,this.controls={},this.hideTimeout=null,this.isDraggingProgress=!1,this.isDraggingVolume=!1,this.init()}init(){this.createElement(),this.createControls(),this.attachEvents(),this.setupAutoHide()}isMobile(){return window.innerWidth<640}positionMenu(e,t){this.isMobile()||setTimeout(()=>{const s=t.getBoundingClientRect(),a=e.getBoundingClientRect(),n=window.innerWidth,o=window.innerHeight,r=s.top,c=o-s.bottom;r<a.height+20&&c>r&&(e.style.bottom="auto",e.style.top="calc(100% + 8px)",e.classList.add("vidply-menu-below"));const d=s.left+s.width/2-a.width/2;d<10?(e.style.right="auto",e.style.left="0",e.style.transform="translateX(0)"):d+a.width>n-10&&(e.style.left="auto",e.style.right="0",e.style.transform="translateX(0)")},0)}attachMenuCloseHandler(e,t,i=!1){this.positionMenu(e,t),setTimeout(()=>{const s=n=>{i&&e.contains(n.target)||!e.contains(n.target)&&!t.contains(n.target)&&(e.remove(),document.removeEventListener("click",s),document.removeEventListener("keydown",a))},a=n=>{n.key==="Escape"&&(e.remove(),document.removeEventListener("click",s),document.removeEventListener("keydown",a),t.focus())};document.addEventListener("click",s),document.addEventListener("keydown",a)},100)}attachMenuKeyboardNavigation(e){const t=Array.from(e.querySelectorAll(`.${this.player.options.classPrefix}-menu-item`));if(t.length===0)return;const i=s=>{const a=t.indexOf(document.activeElement);switch(s.key){case"ArrowDown":s.preventDefault();const n=(a+1)%t.length;t[n].focus();break;case"ArrowUp":s.preventDefault();const o=(a-1+t.length)%t.length;t[o].focus();break;case"Home":s.preventDefault(),t[0].focus();break;case"End":s.preventDefault(),t[t.length-1].focus();break;case"Enter":case" ":s.preventDefault(),document.activeElement&&t.includes(document.activeElement)&&document.activeElement.click();break}};e.addEventListener("keydown",i)}createElement(){this.element=l.createElement("div",{className:`${this.player.options.classPrefix}-controls`,attributes:{role:"region","aria-label":u.t("player.label")+" controls"}})}createControls(){this.player.options.progressBar&&this.createProgressBar();const e=l.createElement("div",{className:`${this.player.options.classPrefix}-controls-buttons`}),t=l.createElement("div",{className:`${this.player.options.classPrefix}-controls-left`});this.player.playlistManager&&t.appendChild(this.createPreviousButton()),this.player.options.playPauseButton&&t.appendChild(this.createPlayPauseButton()),t.appendChild(this.createRestartButton()),this.player.playlistManager&&t.appendChild(this.createNextButton()),this.player.playlistManager||t.appendChild(this.createRewindButton()),this.player.playlistManager||t.appendChild(this.createForwardButton()),this.player.options.volumeControl&&t.appendChild(this.createVolumeControl()),(this.player.options.currentTime||this.player.options.duration)&&t.appendChild(this.createTimeDisplay()),this.rightButtons=l.createElement("div",{className:`${this.player.options.classPrefix}-controls-right`});const i=this.hasChapterTracks(),s=this.hasCaptionTracks(),a=this.hasQualityLevels(),n=this.hasAudioDescription();this.player.options.chaptersButton&&i&&this.rightButtons.appendChild(this.createChaptersButton()),this.player.options.qualityButton&&a&&this.rightButtons.appendChild(this.createQualityButton()),this.player.options.captionStyleButton&&s&&this.rightButtons.appendChild(this.createCaptionStyleButton()),this.player.options.speedButton&&this.rightButtons.appendChild(this.createSpeedButton()),this.player.options.captionsButton&&s&&this.rightButtons.appendChild(this.createCaptionsButton()),this.player.options.transcriptButton&&s&&this.rightButtons.appendChild(this.createTranscriptButton()),this.player.options.audioDescriptionButton&&n&&this.rightButtons.appendChild(this.createAudioDescriptionButton());const o=this.hasSignLanguage();this.player.options.signLanguageButton&&o&&this.rightButtons.appendChild(this.createSignLanguageButton()),this.player.options.pipButton&&"pictureInPictureEnabled"in document&&this.rightButtons.appendChild(this.createPipButton()),this.player.options.fullscreenButton&&this.rightButtons.appendChild(this.createFullscreenButton()),e.appendChild(t),e.appendChild(this.rightButtons),this.element.appendChild(e)}hasChapterTracks(){const e=this.player.element.textTracks;for(let t=0;t<e.length;t++)if(e[t].kind==="chapters")return!0;return!1}hasCaptionTracks(){const e=this.player.element.textTracks;for(let t=0;t<e.length;t++)if(e[t].kind==="captions"||e[t].kind==="subtitles")return!0;return!1}hasQualityLevels(){if(this.player.renderer&&this.player.renderer.getQualities){const e=this.player.renderer.getQualities();return e&&e.length>1}return!1}hasAudioDescription(){return this.player.audioDescriptionSrc&&this.player.audioDescriptionSrc.length>0?!0:Array.from(this.player.element.textTracks||[]).some(t=>t.kind==="descriptions")}hasSignLanguage(){return this.player.signLanguageSrc&&this.player.signLanguageSrc.length>0}createProgressBar(){const e=l.createElement("div",{className:`${this.player.options.classPrefix}-progress-container`,attributes:{role:"slider","aria-label":u.t("player.progress"),"aria-valuemin":"0","aria-valuemax":"100","aria-valuenow":"0",tabindex:"0"}});this.controls.buffered=l.createElement("div",{className:`${this.player.options.classPrefix}-progress-buffered`}),this.controls.played=l.createElement("div",{className:`${this.player.options.classPrefix}-progress-played`}),this.controls.progressHandle=l.createElement("div",{className:`${this.player.options.classPrefix}-progress-handle`}),this.controls.progressTooltip=l.createElement("div",{className:`${this.player.options.classPrefix}-progress-tooltip`}),e.appendChild(this.controls.buffered),e.appendChild(this.controls.played),this.controls.played.appendChild(this.controls.progressHandle),e.appendChild(this.controls.progressTooltip),this.controls.progress=e,this.element.appendChild(e),this.setupProgressBarEvents()}setupProgressBarEvents(){const e=this.controls.progress,t=i=>{const s=e.getBoundingClientRect(),a=Math.max(0,Math.min(1,(i-s.left)/s.width)),n=a*this.player.state.duration;return{percent:a,time:n}};e.addEventListener("mousedown",i=>{this.isDraggingProgress=!0;const{time:s}=t(i.clientX);this.player.seek(s)}),document.addEventListener("mousemove",i=>{if(this.isDraggingProgress){const{time:s}=t(i.clientX);this.player.seek(s)}}),document.addEventListener("mouseup",()=>{this.isDraggingProgress=!1}),e.addEventListener("mousemove",i=>{if(!this.isDraggingProgress){const{time:s}=t(i.clientX);this.controls.progressTooltip.textContent=T.formatTime(s),this.controls.progressTooltip.style.left=`${i.clientX-e.getBoundingClientRect().left}px`,this.controls.progressTooltip.style.display="block"}}),e.addEventListener("mouseleave",()=>{this.controls.progressTooltip.style.display="none"}),e.addEventListener("keydown",i=>{i.key==="ArrowLeft"?(i.preventDefault(),this.player.seekBackward(5)):i.key==="ArrowRight"&&(i.preventDefault(),this.player.seekForward(5))}),e.addEventListener("touchstart",i=>{this.isDraggingProgress=!0;const s=i.touches[0],{time:a}=t(s.clientX);this.player.seek(a)}),e.addEventListener("touchmove",i=>{if(this.isDraggingProgress){i.preventDefault();const s=i.touches[0],{time:a}=t(s.clientX);this.player.seek(a)}}),e.addEventListener("touchend",()=>{this.isDraggingProgress=!1})}createPlayPauseButton(){const e=l.createElement("button",{className:`${this.player.options.classPrefix}-button ${this.player.options.classPrefix}-play-pause`,attributes:{type:"button","aria-label":u.t("player.play")}});return e.appendChild(f("play")),e.addEventListener("click",()=>{this.player.toggle()}),this.controls.playPause=e,e}createRestartButton(){const e=l.createElement("button",{className:`${this.player.options.classPrefix}-button ${this.player.options.classPrefix}-restart`,attributes:{type:"button","aria-label":u.t("player.restart")}});return e.appendChild(f("restart")),e.addEventListener("click",()=>{this.player.seek(0),this.player.play()}),e}createPreviousButton(){const e=l.createElement("button",{className:`${this.player.options.classPrefix}-button ${this.player.options.classPrefix}-previous`,attributes:{type:"button","aria-label":u.t("player.previous")}});e.appendChild(f("skipPrevious")),e.addEventListener("click",()=>{this.player.playlistManager&&this.player.playlistManager.previous()});const t=()=>{this.player.playlistManager&&(e.disabled=!this.player.playlistManager.hasPrevious()&&!this.player.playlistManager.options.loop)};return this.player.on("playlisttrackchange",t),t(),this.controls.previous=e,e}createNextButton(){const e=l.createElement("button",{className:`${this.player.options.classPrefix}-button ${this.player.options.classPrefix}-next`,attributes:{type:"button","aria-label":u.t("player.next")}});e.appendChild(f("skipNext")),e.addEventListener("click",()=>{this.player.playlistManager&&this.player.playlistManager.next()});const t=()=>{this.player.playlistManager&&(e.disabled=!this.player.playlistManager.hasNext()&&!this.player.playlistManager.options.loop)};return this.player.on("playlisttrackchange",t),t(),this.controls.next=e,e}createRewindButton(){const e=l.createElement("button",{className:`${this.player.options.classPrefix}-button ${this.player.options.classPrefix}-rewind`,attributes:{type:"button","aria-label":u.t("player.rewindSeconds",{seconds:15})}});return e.appendChild(f("rewind")),e.addEventListener("click",()=>{this.player.seekBackward(15)}),e}createForwardButton(){const e=l.createElement("button",{className:`${this.player.options.classPrefix}-button ${this.player.options.classPrefix}-forward`,attributes:{type:"button","aria-label":u.t("player.forwardSeconds",{seconds:15})}});return e.appendChild(f("forward")),e.addEventListener("click",()=>{this.player.seekForward(15)}),e}createVolumeControl(){const e=l.createElement("button",{className:`${this.player.options.classPrefix}-button ${this.player.options.classPrefix}-mute`,attributes:{type:"button","aria-label":u.t("player.volume"),"aria-haspopup":"true"}});return e.appendChild(f("volumeHigh")),e.addEventListener("contextmenu",t=>{t.preventDefault(),this.player.toggleMute()}),e.addEventListener("click",()=>{this.showVolumeSlider(e)}),this.controls.mute=e,e}showVolumeSlider(e){const t=document.querySelector(`.${this.player.options.classPrefix}-volume-menu`);if(t){t.remove();return}const i=l.createElement("div",{className:`${this.player.options.classPrefix}-volume-menu ${this.player.options.classPrefix}-menu`}),s=l.createElement("div",{className:`${this.player.options.classPrefix}-volume-slider`,attributes:{role:"slider","aria-label":u.t("player.volume"),"aria-valuemin":"0","aria-valuemax":"100","aria-valuenow":String(Math.round(this.player.state.volume*100)),tabindex:"0"}}),a=l.createElement("div",{className:`${this.player.options.classPrefix}-volume-track`}),n=l.createElement("div",{className:`${this.player.options.classPrefix}-volume-fill`}),o=l.createElement("div",{className:`${this.player.options.classPrefix}-volume-handle`});a.appendChild(n),n.appendChild(o),s.appendChild(a),i.appendChild(s);const r=c=>{const d=a.getBoundingClientRect(),h=Math.max(0,Math.min(1,1-(c-d.top)/d.height));this.player.setVolume(h)};s.addEventListener("mousedown",c=>{c.stopPropagation(),this.isDraggingVolume=!0,r(c.clientY)}),document.addEventListener("mousemove",c=>{this.isDraggingVolume&&r(c.clientY)}),document.addEventListener("mouseup",()=>{this.isDraggingVolume=!1}),s.addEventListener("keydown",c=>{c.key==="ArrowUp"?(c.preventDefault(),this.player.setVolume(Math.min(1,this.player.state.volume+.1))):c.key==="ArrowDown"&&(c.preventDefault(),this.player.setVolume(Math.max(0,this.player.state.volume-.1)))}),i.addEventListener("click",c=>{c.stopPropagation()}),e.appendChild(i),this.controls.volumeSlider=s,this.controls.volumeFill=n,this.attachMenuCloseHandler(i,e,!0)}createTimeDisplay(){const e=l.createElement("div",{className:`${this.player.options.classPrefix}-time`,attributes:{role:"group","aria-label":u.t("time.display")}});this.controls.currentTimeDisplay=l.createElement("span",{className:`${this.player.options.classPrefix}-current-time`});const t=l.createElement("span",{textContent:"00:00",attributes:{"aria-hidden":"true"}}),i=l.createElement("span",{className:"vidply-sr-only",textContent:u.t("time.seconds",{count:0})});this.controls.currentTimeDisplay.appendChild(t),this.controls.currentTimeDisplay.appendChild(i),this.controls.currentTimeVisual=t,this.controls.currentTimeAccessible=i;const s=l.createElement("span",{textContent:" / ",attributes:{"aria-hidden":"true"}});this.controls.durationDisplay=l.createElement("span",{className:`${this.player.options.classPrefix}-duration`});const a=l.createElement("span",{textContent:"00:00",attributes:{"aria-hidden":"true"}}),n=l.createElement("span",{className:"vidply-sr-only",textContent:u.t("time.durationPrefix")+u.t("time.seconds",{count:0})});return this.controls.durationDisplay.appendChild(a),this.controls.durationDisplay.appendChild(n),this.controls.durationVisual=a,this.controls.durationAccessible=n,e.appendChild(this.controls.currentTimeDisplay),e.appendChild(s),e.appendChild(this.controls.durationDisplay),e}createChaptersButton(){const e=l.createElement("button",{className:`${this.player.options.classPrefix}-button ${this.player.options.classPrefix}-chapters`,attributes:{type:"button","aria-label":u.t("player.chapters"),"aria-haspopup":"menu"}});return e.appendChild(f("playlist")),e.addEventListener("click",()=>{this.showChaptersMenu(e)}),this.controls.chapters=e,e}showChaptersMenu(e){const t=document.querySelector(`.${this.player.options.classPrefix}-chapters-menu`);if(t){t.remove();return}const i=l.createElement("div",{className:`${this.player.options.classPrefix}-chapters-menu ${this.player.options.classPrefix}-menu`,attributes:{role:"menu","aria-label":u.t("player.chapters")}}),s=Array.from(this.player.element.textTracks).filter(a=>a.kind==="chapters");if(s.length===0){const a=l.createElement("div",{className:`${this.player.options.classPrefix}-menu-item`,textContent:u.t("player.noChapters"),style:{opacity:"0.5",cursor:"default"}});i.appendChild(a)}else{const a=s[0];if(a.mode==="disabled"&&(a.mode="hidden"),!a.cues||a.cues.length===0){const n=l.createElement("div",{className:`${this.player.options.classPrefix}-menu-item`,textContent:u.t("player.loadingChapters"),style:{opacity:"0.5",cursor:"default"}});i.appendChild(n);const o=()=>{i.remove(),this.showChaptersMenu(e)};a.addEventListener("load",o,{once:!0}),setTimeout(()=>{a.cues&&a.cues.length>0&&document.contains(i)&&(i.remove(),this.showChaptersMenu(e))},500)}else{const n=a.cues;for(let o=0;o<n.length;o++){const r=n[o],c=l.createElement("button",{className:`${this.player.options.classPrefix}-menu-item`,attributes:{type:"button",role:"menuitem",tabindex:"-1"}}),d=l.createElement("span",{className:`${this.player.options.classPrefix}-chapter-time`,textContent:T.formatTime(r.startTime)}),h=l.createElement("span",{className:`${this.player.options.classPrefix}-chapter-title`,textContent:r.text});c.appendChild(d),c.appendChild(document.createTextNode(" ")),c.appendChild(h),c.addEventListener("click",()=>{this.player.seek(r.startTime),i.remove()}),i.appendChild(c)}this.attachMenuKeyboardNavigation(i),setTimeout(()=>{const o=i.querySelector(`.${this.player.options.classPrefix}-menu-item`);o&&o.focus()},0)}}e.appendChild(i),this.attachMenuCloseHandler(i,e)}createQualityButton(){const e=l.createElement("button",{className:`${this.player.options.classPrefix}-button ${this.player.options.classPrefix}-quality`,attributes:{type:"button","aria-label":u.t("player.quality"),"aria-haspopup":"menu"}});e.appendChild(f("hd"));const t=l.createElement("span",{className:`${this.player.options.classPrefix}-quality-text`,textContent:""});return e.appendChild(t),e.addEventListener("click",()=>{this.showQualityMenu(e)}),this.controls.quality=e,this.controls.qualityText=t,setTimeout(()=>this.updateQualityIndicator(),500),e}showQualityMenu(e){const t=document.querySelector(`.${this.player.options.classPrefix}-quality-menu`);if(t){t.remove();return}const i=l.createElement("div",{className:`${this.player.options.classPrefix}-quality-menu ${this.player.options.classPrefix}-menu`,attributes:{role:"menu","aria-label":u.t("player.quality")}});if(this.player.renderer&&this.player.renderer.getQualities){const s=this.player.renderer.getQualities(),a=this.player.renderer.getCurrentQuality?this.player.renderer.getCurrentQuality():-1,n=this.player.renderer.hls!==void 0;if(s.length===0){const o=l.createElement("div",{className:`${this.player.options.classPrefix}-menu-item`,textContent:u.t("player.autoQuality"),style:{opacity:"0.5",cursor:"default"}});i.appendChild(o)}else{let o=null;if(n){const r=l.createElement("button",{className:`${this.player.options.classPrefix}-menu-item`,textContent:u.t("player.auto"),attributes:{type:"button",role:"menuitem",tabindex:"-1"}});this.player.renderer.hls&&this.player.renderer.hls.currentLevel===-1&&(r.classList.add(`${this.player.options.classPrefix}-menu-item-active`),r.appendChild(f("check")),o=r),r.addEventListener("click",()=>{this.player.renderer.switchQuality&&this.player.renderer.switchQuality(-1),i.remove()}),i.appendChild(r)}s.forEach(r=>{const c=l.createElement("button",{className:`${this.player.options.classPrefix}-menu-item`,textContent:r.name||`${r.height}p`,attributes:{type:"button",role:"menuitem",tabindex:"-1"}});r.index===a&&(c.classList.add(`${this.player.options.classPrefix}-menu-item-active`),c.appendChild(f("check")),o=c),c.addEventListener("click",()=>{this.player.renderer.switchQuality&&this.player.renderer.switchQuality(r.index),i.remove()}),i.appendChild(c)}),this.attachMenuKeyboardNavigation(i),setTimeout(()=>{const r=o||i.querySelector(`.${this.player.options.classPrefix}-menu-item`);r&&r.focus()},0)}}else{const s=l.createElement("div",{className:`${this.player.options.classPrefix}-menu-item`,textContent:u.t("player.noQuality"),style:{opacity:"0.5",cursor:"default"}});i.appendChild(s)}e.appendChild(i),this.attachMenuCloseHandler(i,e)}createCaptionStyleButton(){const e=l.createElement("button",{className:`${this.player.options.classPrefix}-button ${this.player.options.classPrefix}-caption-style`,attributes:{type:"button","aria-label":u.t("player.captionStyling"),"aria-haspopup":"menu",title:u.t("player.captionStyling")}}),t=l.createElement("span",{textContent:"Aa",style:{fontSize:"14px",fontWeight:"bold"}});return e.appendChild(t),e.addEventListener("click",()=>{this.showCaptionStyleMenu(e)}),this.controls.captionStyle=e,e}showCaptionStyleMenu(e){const t=document.querySelector(`.${this.player.options.classPrefix}-caption-style-menu`);if(t){t.remove();return}const i=l.createElement("div",{className:`${this.player.options.classPrefix}-caption-style-menu ${this.player.options.classPrefix}-menu ${this.player.options.classPrefix}-settings-menu`,attributes:{role:"menu","aria-label":u.t("player.captionStyling")}});if(i.addEventListener("click",c=>{c.stopPropagation()}),!this.player.captionManager||this.player.captionManager.tracks.length===0){const c=l.createElement("div",{className:`${this.player.options.classPrefix}-menu-item`,textContent:u.t("player.noCaptions"),style:{opacity:"0.5",cursor:"default",padding:"12px 16px"}});i.appendChild(c),e.appendChild(i),this.attachMenuCloseHandler(i,e,!0);return}const s=this.createStyleControl(u.t("styleLabels.fontSize"),"captionsFontSize",[{label:u.t("fontSizes.small"),value:"87.5%"},{label:u.t("fontSizes.normal"),value:"100%"},{label:u.t("fontSizes.large"),value:"125%"},{label:u.t("fontSizes.xlarge"),value:"150%"}]);i.appendChild(s);const a=this.createStyleControl(u.t("styleLabels.font"),"captionsFontFamily",[{label:u.t("fontFamilies.sansSerif"),value:"sans-serif"},{label:u.t("fontFamilies.serif"),value:"serif"},{label:u.t("fontFamilies.monospace"),value:"monospace"}]);i.appendChild(a);const n=this.createColorControl(u.t("styleLabels.textColor"),"captionsColor");i.appendChild(n);const o=this.createColorControl(u.t("styleLabels.background"),"captionsBackgroundColor");i.appendChild(o);const r=this.createOpacityControl(u.t("styleLabels.opacity"),"captionsOpacity");i.appendChild(r),i.style.minWidth="220px",e.appendChild(i),this.attachMenuCloseHandler(i,e,!0),setTimeout(()=>{const c=i.querySelector("select");c&&c.focus()},0)}createStyleControl(e,t,i){const s=l.createElement("div",{className:`${this.player.options.classPrefix}-style-group`}),a=l.createElement("label",{textContent:e,style:{display:"block",fontSize:"12px",marginBottom:"4px",color:"rgba(255,255,255,0.7)"}});s.appendChild(a);const n=l.createElement("select",{className:`${this.player.options.classPrefix}-style-select`,style:{width:"100%",padding:"6px",background:"var(--vidply-white)",border:"1px solid var(--vidply-white-10)",borderRadius:"4px",color:"var(--vidply-black)",fontSize:"13px"}}),o=this.player.options[t];return i.forEach(r=>{const c=l.createElement("option",{textContent:r.label,attributes:{value:r.value}});r.value===o&&(c.selected=!0),n.appendChild(c)}),n.addEventListener("mousedown",r=>{r.stopPropagation()}),n.addEventListener("click",r=>{r.stopPropagation()}),n.addEventListener("change",r=>{r.stopPropagation(),this.player.options[t]=r.target.value,this.player.captionManager&&this.player.captionManager.setCaptionStyle(t.replace("captions","").charAt(0).toLowerCase()+t.replace("captions","").slice(1),r.target.value)}),s.appendChild(n),s}createColorControl(e,t){const i=l.createElement("div",{className:`${this.player.options.classPrefix}-style-group`}),s=l.createElement("label",{textContent:e,style:{display:"block",fontSize:"12px",marginBottom:"4px",color:"rgba(255,255,255,0.7)"}});i.appendChild(s);const a=l.createElement("input",{attributes:{type:"color",value:this.player.options[t]},style:{width:"100%",height:"32px",padding:"2px",background:"rgba(255,255,255,0.1)",border:"1px solid rgba(255,255,255,0.2)",borderRadius:"4px",cursor:"pointer"}});return a.addEventListener("mousedown",n=>{n.stopPropagation()}),a.addEventListener("click",n=>{n.stopPropagation()}),a.addEventListener("change",n=>{n.stopPropagation(),this.player.options[t]=n.target.value,this.player.captionManager&&this.player.captionManager.setCaptionStyle(t.replace("captions","").charAt(0).toLowerCase()+t.replace("captions","").slice(1),n.target.value)}),i.appendChild(a),i}createOpacityControl(e,t){const i=l.createElement("div",{className:`${this.player.options.classPrefix}-style-group`}),s=l.createElement("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"4px"}}),a=l.createElement("label",{textContent:e,style:{fontSize:"12px",color:"rgba(255,255,255,0.7)"}}),n=l.createElement("span",{textContent:Math.round(this.player.options[t]*100)+"%",style:{fontSize:"12px",color:"rgba(255,255,255,0.7)"}});s.appendChild(a),s.appendChild(n),i.appendChild(s);const o=l.createElement("input",{attributes:{type:"range",min:"0",max:"1",step:"0.1",value:String(this.player.options[t])},style:{width:"100%",cursor:"pointer"}});return o.addEventListener("mousedown",r=>{r.stopPropagation()}),o.addEventListener("click",r=>{r.stopPropagation()}),o.addEventListener("input",r=>{r.stopPropagation();const c=parseFloat(r.target.value);n.textContent=Math.round(c*100)+"%",this.player.options[t]=c,this.player.captionManager&&this.player.captionManager.setCaptionStyle(t.replace("captions","").charAt(0).toLowerCase()+t.replace("captions","").slice(1),c)}),i.appendChild(o),i}createSpeedButton(){const e=l.createElement("button",{className:`${this.player.options.classPrefix}-button ${this.player.options.classPrefix}-speed`,attributes:{type:"button","aria-label":u.t("player.speed"),"aria-haspopup":"menu"}});e.appendChild(f("speed"));const t=l.createElement("span",{className:`${this.player.options.classPrefix}-speed-text`,textContent:"1x"});return e.appendChild(t),e.addEventListener("click",()=>{this.showSpeedMenu(e)}),this.controls.speed=e,this.controls.speedText=t,e}formatSpeedLabel(e){return e===1?u.t("speeds.normal"):`${e.toLocaleString(u.getLanguage(),{minimumFractionDigits:0,maximumFractionDigits:2})}×`}showSpeedMenu(e){const t=document.querySelector(`.${this.player.options.classPrefix}-speed-menu`);if(t){t.remove();return}const i=l.createElement("div",{className:`${this.player.options.classPrefix}-speed-menu ${this.player.options.classPrefix}-menu`,attributes:{role:"menu"}}),s=[.25,.5,.75,1,1.25,1.5,1.75,2];let a=null;s.forEach(n=>{const o=l.createElement("button",{className:`${this.player.options.classPrefix}-menu-item`,textContent:this.formatSpeedLabel(n),attributes:{type:"button",role:"menuitem",tabindex:"-1"}});n===this.player.state.playbackSpeed&&(o.classList.add(`${this.player.options.classPrefix}-menu-item-active`),o.appendChild(f("check")),a=o),o.addEventListener("click",()=>{this.player.setPlaybackSpeed(n),i.remove()}),i.appendChild(o)}),e.appendChild(i),this.attachMenuKeyboardNavigation(i),this.attachMenuCloseHandler(i,e),setTimeout(()=>{const n=a||i.querySelector(`.${this.player.options.classPrefix}-menu-item`);n&&n.focus()},0)}createCaptionsButton(){const e=l.createElement("button",{className:`${this.player.options.classPrefix}-button ${this.player.options.classPrefix}-captions-button`,attributes:{type:"button","aria-label":u.t("player.captions"),"aria-pressed":"false","aria-haspopup":"menu"}});return e.appendChild(f("captionsOff")),e.addEventListener("click",()=>{this.showCaptionsMenu(e)}),this.controls.captions=e,e}showCaptionsMenu(e){const t=document.querySelector(`.${this.player.options.classPrefix}-captions-menu`);if(t){t.remove();return}const i=l.createElement("div",{className:`${this.player.options.classPrefix}-captions-menu ${this.player.options.classPrefix}-menu`,attributes:{role:"menu","aria-label":u.t("captions.select")}});if(!this.player.captionManager||this.player.captionManager.tracks.length===0){const o=l.createElement("div",{className:`${this.player.options.classPrefix}-menu-item`,textContent:u.t("player.noCaptions"),style:{opacity:"0.5",cursor:"default"}});i.appendChild(o),e.appendChild(i),this.attachMenuCloseHandler(i,e);return}let s=null;const a=l.createElement("button",{className:`${this.player.options.classPrefix}-menu-item`,textContent:u.t("captions.off"),attributes:{type:"button",role:"menuitem",tabindex:"-1"}});this.player.state.captionsEnabled||(a.classList.add(`${this.player.options.classPrefix}-menu-item-active`),a.appendChild(f("check")),s=a),a.addEventListener("click",()=>{this.player.disableCaptions(),this.updateCaptionsButton(),i.remove()}),i.appendChild(a),this.player.captionManager.getAvailableTracks().forEach(o=>{const r=l.createElement("button",{className:`${this.player.options.classPrefix}-menu-item`,textContent:o.label,attributes:{type:"button",role:"menuitem",lang:o.language,tabindex:"-1"}});this.player.state.captionsEnabled&&this.player.captionManager.currentTrack===this.player.captionManager.tracks[o.index]&&(r.classList.add(`${this.player.options.classPrefix}-menu-item-active`),r.appendChild(f("check")),s=r),r.addEventListener("click",()=>{this.player.captionManager.switchTrack(o.index),this.updateCaptionsButton(),i.remove()}),i.appendChild(r)}),e.appendChild(i),this.attachMenuKeyboardNavigation(i),this.attachMenuCloseHandler(i,e),setTimeout(()=>{const o=s||i.querySelector(`.${this.player.options.classPrefix}-menu-item`);o&&o.focus()},0)}updateCaptionsButton(){if(!this.controls.captions)return;const e=this.controls.captions.querySelector(".vidply-icon"),t=this.player.state.captionsEnabled;e.innerHTML=t?f("captions").innerHTML:f("captionsOff").innerHTML,this.controls.captions.setAttribute("aria-pressed",t?"true":"false")}createTranscriptButton(){const e=l.createElement("button",{className:`${this.player.options.classPrefix}-button ${this.player.options.classPrefix}-transcript`,attributes:{type:"button","aria-label":u.t("player.transcript"),"aria-pressed":"false"}});return e.appendChild(f("transcript")),e.addEventListener("click",()=>{this.player.transcriptManager&&(this.player.transcriptManager.toggleTranscript(),this.updateTranscriptButton())}),this.controls.transcript=e,e}updateTranscriptButton(){if(!this.controls.transcript)return;const e=this.player.transcriptManager&&this.player.transcriptManager.isVisible;this.controls.transcript.setAttribute("aria-pressed",e?"true":"false")}createAudioDescriptionButton(){const e=l.createElement("button",{className:`${this.player.options.classPrefix}-button ${this.player.options.classPrefix}-audio-description`,attributes:{type:"button","aria-label":u.t("player.audioDescription"),"aria-pressed":"false",title:u.t("player.audioDescription")}});return e.appendChild(f("audioDescription")),e.addEventListener("click",async()=>{await this.player.toggleAudioDescription(),this.updateAudioDescriptionButton()}),this.controls.audioDescription=e,e}updateAudioDescriptionButton(){if(!this.controls.audioDescription)return;const e=this.controls.audioDescription.querySelector(".vidply-icon"),t=this.player.state.audioDescriptionEnabled;e.innerHTML=t?f("audioDescriptionOn").innerHTML:f("audioDescription").innerHTML,this.controls.audioDescription.setAttribute("aria-pressed",t?"true":"false"),this.controls.audioDescription.setAttribute("aria-label",t?u.t("audioDescription.disable"):u.t("audioDescription.enable"))}createSignLanguageButton(){const e=l.createElement("button",{className:`${this.player.options.classPrefix}-button ${this.player.options.classPrefix}-sign-language`,attributes:{type:"button","aria-label":u.t("player.signLanguage"),"aria-pressed":"false",title:u.t("player.signLanguage")}});return e.appendChild(f("signLanguage")),e.addEventListener("click",()=>{this.player.toggleSignLanguage(),this.updateSignLanguageButton()}),this.controls.signLanguage=e,e}updateSignLanguageButton(){if(!this.controls.signLanguage)return;const e=this.controls.signLanguage.querySelector(".vidply-icon"),t=this.player.state.signLanguageEnabled;e.innerHTML=t?f("signLanguageOn").innerHTML:f("signLanguage").innerHTML,this.controls.signLanguage.setAttribute("aria-pressed",t?"true":"false"),this.controls.signLanguage.setAttribute("aria-label",t?u.t("signLanguage.hide"):u.t("signLanguage.show"))}createSettingsButton(){const e=l.createElement("button",{className:`${this.player.options.classPrefix}-button ${this.player.options.classPrefix}-settings`,attributes:{type:"button","aria-label":u.t("player.settings")}});return e.appendChild(f("settings")),e.addEventListener("click",()=>{this.player.showSettings()}),e}createPipButton(){const e=l.createElement("button",{className:`${this.player.options.classPrefix}-button ${this.player.options.classPrefix}-pip`,attributes:{type:"button","aria-label":u.t("player.pip")}});return e.appendChild(f("pip")),e.addEventListener("click",()=>{this.player.togglePiP()}),e}createFullscreenButton(){const e=l.createElement("button",{className:`${this.player.options.classPrefix}-button ${this.player.options.classPrefix}-fullscreen`,attributes:{type:"button","aria-label":u.t("player.fullscreen")}});return e.appendChild(f("fullscreen")),e.addEventListener("click",()=>{this.player.toggleFullscreen()}),this.controls.fullscreen=e,e}attachEvents(){this.player.on("play",()=>this.updatePlayPauseButton()),this.player.on("pause",()=>this.updatePlayPauseButton()),this.player.on("timeupdate",()=>this.updateProgress()),this.player.on("loadedmetadata",()=>{this.updateDuration(),this.ensureQualityButton(),this.updateQualityIndicator()}),this.player.on("volumechange",()=>this.updateVolumeDisplay()),this.player.on("progress",()=>this.updateBuffered()),this.player.on("playbackspeedchange",()=>this.updateSpeedDisplay()),this.player.on("fullscreenchange",()=>this.updateFullscreenButton()),this.player.on("captionsenabled",()=>this.updateCaptionsButton()),this.player.on("captionsdisabled",()=>this.updateCaptionsButton()),this.player.on("audiodescriptionenabled",()=>this.updateAudioDescriptionButton()),this.player.on("audiodescriptiondisabled",()=>this.updateAudioDescriptionButton()),this.player.on("signlanguageenabled",()=>this.updateSignLanguageButton()),this.player.on("signlanguagedisabled",()=>this.updateSignLanguageButton()),this.player.on("qualitychange",()=>this.updateQualityIndicator()),this.player.on("hlslevelswitched",()=>this.updateQualityIndicator()),this.player.on("hlsmanifestparsed",()=>{this.ensureQualityButton(),this.updateQualityIndicator()})}updatePlayPauseButton(){if(!this.controls.playPause)return;const e=this.controls.playPause.querySelector(".vidply-icon"),t=this.player.state.playing;e.innerHTML=t?f("pause").innerHTML:f("play").innerHTML,this.controls.playPause.setAttribute("aria-label",t?u.t("player.pause"):u.t("player.play"))}updateProgress(){if(!this.controls.played)return;const e=this.player.state.currentTime/this.player.state.duration*100;if(this.controls.played.style.width=`${e}%`,this.controls.progress.setAttribute("aria-valuenow",String(Math.round(e))),this.controls.currentTimeVisual){const t=this.player.state.currentTime;this.controls.currentTimeVisual.textContent=T.formatTime(t),this.controls.currentTimeAccessible&&(this.controls.currentTimeAccessible.textContent=T.formatDuration(t))}}updateDuration(){if(this.controls.durationVisual){const e=this.player.state.duration;this.controls.durationVisual.textContent=T.formatTime(e),this.controls.durationAccessible&&(this.controls.durationAccessible.textContent=u.t("time.durationPrefix")+T.formatDuration(e))}}updateVolumeDisplay(){const e=this.player.state.volume*100;if(this.controls.volumeFill&&(this.controls.volumeFill.style.height=`${e}%`),this.controls.mute){const t=this.controls.mute.querySelector(".vidply-icon");if(t){let i;this.player.state.muted||this.player.state.volume===0?i="volumeMuted":this.player.state.volume<.3?i="volumeLow":this.player.state.volume<.7?i="volumeMedium":i="volumeHigh",t.innerHTML=f(i).innerHTML,this.controls.mute.setAttribute("aria-label",this.player.state.muted?u.t("player.unmute"):u.t("player.mute"))}}this.controls.volumeSlider&&this.controls.volumeSlider.setAttribute("aria-valuenow",String(Math.round(e)))}updateBuffered(){if(!this.controls.buffered||!this.player.element.buffered||this.player.element.buffered.length===0)return;const t=this.player.element.buffered.end(this.player.element.buffered.length-1)/this.player.state.duration*100;this.controls.buffered.style.width=`${t}%`}updateSpeedDisplay(){this.controls.speedText&&(this.controls.speedText.textContent=`${this.player.state.playbackSpeed}x`)}updateFullscreenButton(){if(!this.controls.fullscreen)return;const e=this.controls.fullscreen.querySelector(".vidply-icon"),t=this.player.state.fullscreen;e.innerHTML=t?f("fullscreenExit").innerHTML:f("fullscreen").innerHTML,this.controls.fullscreen.setAttribute("aria-label",t?u.t("player.exitFullscreen"):u.t("player.fullscreen"))}ensureQualityButton(){if(!this.player.options.qualityButton||this.controls.quality||!this.hasQualityLevels())return;const e=this.createQualityButton(),t=this.rightButtons.querySelector(`.${this.player.options.classPrefix}-speed`),s=this.rightButtons.querySelector(`.${this.player.options.classPrefix}-caption-style`)||t;s?this.rightButtons.insertBefore(e,s):this.rightButtons.insertBefore(e,this.rightButtons.firstChild),this.player.log("Quality button added dynamically","info")}updateQualityIndicator(){if(!this.controls.qualityText||!this.player.renderer||!this.player.renderer.getQualities)return;const e=this.player.renderer.getQualities();if(e.length===0){this.controls.qualityText.textContent="";return}let t="";if(this.player.renderer.hls&&this.player.renderer.hls.currentLevel===-1)t="Auto";else if(this.player.renderer.getCurrentQuality){const i=this.player.renderer.getCurrentQuality(),s=e.find(a=>a.index===i);s&&(t=s.height?`${s.height}p`:"")}this.controls.qualityText.textContent=t}setupAutoHide(){if(this.player.element.tagName!=="VIDEO")return;const e=()=>{this.element.classList.add(`${this.player.options.classPrefix}-controls-visible`),this.player.container.classList.add(`${this.player.options.classPrefix}-controls-visible`),this.player.state.controlsVisible=!0,clearTimeout(this.hideTimeout),this.player.state.playing&&(this.hideTimeout=setTimeout(()=>{this.element.classList.remove(`${this.player.options.classPrefix}-controls-visible`),this.player.container.classList.remove(`${this.player.options.classPrefix}-controls-visible`),this.player.state.controlsVisible=!1},this.player.options.hideControlsDelay))};this.player.container.addEventListener("mousemove",e),this.player.container.addEventListener("touchstart",e),this.player.container.addEventListener("click",e),this.element.addEventListener("focusin",e),this.player.on("pause",()=>{e(),clearTimeout(this.hideTimeout)}),this.player.on("play",()=>{e()}),e()}show(){this.element.style.display=""}hide(){this.element.style.display="none"}destroy(){this.hideTimeout&&clearTimeout(this.hideTimeout),this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element)}},A=class{constructor(e="vidply"){this.namespace=e,this.storage=this.isStorageAvailable()?localStorage:null}isStorageAvailable(){try{const e="__storage_test__";return localStorage.setItem(e,e),localStorage.removeItem(e),!0}catch{return!1}}getKey(e){return`${this.namespace}_${e}`}set(e,t){if(!this.storage)return!1;try{const i=this.getKey(e);return this.storage.setItem(i,JSON.stringify(t)),!0}catch(i){return console.warn("Failed to save to localStorage:",i),!1}}get(e,t=null){if(!this.storage)return t;try{const i=this.getKey(e),s=this.storage.getItem(i);return s?JSON.parse(s):t}catch(i){return console.warn("Failed to read from localStorage:",i),t}}remove(e){if(!this.storage)return!1;try{const t=this.getKey(e);return this.storage.removeItem(t),!0}catch(t){return console.warn("Failed to remove from localStorage:",t),!1}}clear(){if(!this.storage)return!1;try{return Object.keys(this.storage).forEach(t=>{t.startsWith(this.namespace)&&this.storage.removeItem(t)}),!0}catch(e){return console.warn("Failed to clear localStorage:",e),!1}}saveTranscriptPreferences(e){return this.set("transcript_preferences",e)}getTranscriptPreferences(){return this.get("transcript_preferences",null)}saveCaptionPreferences(e){return this.set("caption_preferences",e)}getCaptionPreferences(){return this.get("caption_preferences",null)}savePlayerPreferences(e){return this.set("player_preferences",e)}getPlayerPreferences(){return this.get("player_preferences",null)}saveSignLanguagePreferences(e){return this.set("sign_language_preferences",e)}getSignLanguagePreferences(){return this.get("sign_language_preferences",null)}},F=class{constructor(e){this.player=e,this.element=null,this.tracks=[],this.currentTrack=null,this.currentCue=null,this.storage=new A("vidply"),this.loadSavedPreferences(),this.init()}loadSavedPreferences(){const e=this.storage.getCaptionPreferences();e&&(e.fontSize&&(this.player.options.captionsFontSize=e.fontSize),e.fontFamily&&(this.player.options.captionsFontFamily=e.fontFamily),e.color&&(this.player.options.captionsColor=e.color),e.backgroundColor&&(this.player.options.captionsBackgroundColor=e.backgroundColor),e.opacity!==void 0&&(this.player.options.captionsOpacity=e.opacity))}saveCaptionPreferences(){this.storage.saveCaptionPreferences({fontSize:this.player.options.captionsFontSize,fontFamily:this.player.options.captionsFontFamily,color:this.player.options.captionsColor,backgroundColor:this.player.options.captionsBackgroundColor,opacity:this.player.options.captionsOpacity})}init(){this.createElement(),this.loadTracks(),this.attachEvents(),this.player.options.captionsDefault&&this.tracks.length>0&&this.enable()}createElement(){this.element=l.createElement("div",{className:`${this.player.options.classPrefix}-captions`,attributes:{"aria-live":"polite","aria-atomic":"true",role:"region","aria-label":u.t("player.captions")}}),this.updateStyles(),(this.player.videoWrapper||this.player.container).appendChild(this.element)}loadTracks(){const e=this.player.element.textTracks;for(let t=0;t<e.length;t++){const i=e[t];(i.kind==="subtitles"||i.kind==="captions")&&(this.tracks.push({track:i,language:i.language,label:i.label,kind:i.kind,index:t}),i.mode="hidden")}}attachEvents(){this.player.on("timeupdate",()=>{this.updateCaptions()}),this.player.on("captionschange",()=>{this.updateStyles()})}enable(e=0){if(this.tracks.length===0)return;this.currentTrack&&(this.currentTrack.track.mode="hidden");const t=this.tracks[e];t&&(t.track.mode="hidden",this.currentTrack=t,this.player.state.captionsEnabled=!0,this.cueChangeHandler&&t.track.removeEventListener("cuechange",this.cueChangeHandler),this.cueChangeHandler=()=>{this.updateCaptions()},t.track.addEventListener("cuechange",this.cueChangeHandler),this.player.emit("captionsenabled",t))}disable(){this.currentTrack&&(this.currentTrack.track.mode="hidden",this.currentTrack=null),this.element.style.display="none",this.element.innerHTML="",this.currentCue=null,this.player.state.captionsEnabled=!1,this.player.emit("captionsdisabled")}updateCaptions(){if(!this.currentTrack||!this.currentTrack.track.activeCues)return;const e=this.currentTrack.track.activeCues;if(e.length>0){const t=e[0];if(this.currentCue!==t){this.currentCue=t;let i=t.text;i=this.parseVTTFormatting(i),this.element.innerHTML=l.sanitizeHTML(i),this.element.style.display="block",this.player.emit("captionchange",t)}}else this.currentCue&&(this.element.innerHTML="",this.element.style.display="none",this.currentCue=null)}parseVTTFormatting(e){return e=e.replace(/<c[^>]*>(.*?)<\/c>/g,'<span class="caption-class">$1</span>'),e=e.replace(/<b>(.*?)<\/b>/g,"<strong>$1</strong>"),e=e.replace(/<i>(.*?)<\/i>/g,"<em>$1</em>"),e=e.replace(/<u>(.*?)<\/u>/g,"<u>$1</u>"),e=e.replace(/<v\s+([^>]+)>(.*?)<\/v>/g,'<span class="caption-voice" data-voice="$1">$2</span>'),e}updateStyles(){if(!this.element)return;const e=this.player.options;this.element.style.fontSize=e.captionsFontSize,this.element.style.fontFamily=e.captionsFontFamily,this.element.style.color=e.captionsColor,this.element.style.backgroundColor=this.hexToRgba(e.captionsBackgroundColor,e.captionsOpacity)}hexToRgba(e,t){const i=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return i?`rgba(${parseInt(i[1],16)}, ${parseInt(i[2],16)}, ${parseInt(i[3],16)}, ${t})`:e}setCaptionStyle(e,t){switch(e){case"fontSize":this.player.options.captionsFontSize=t;break;case"fontFamily":this.player.options.captionsFontFamily=t;break;case"color":this.player.options.captionsColor=t;break;case"backgroundColor":this.player.options.captionsBackgroundColor=t;break;case"opacity":this.player.options.captionsOpacity=t;break}this.updateStyles(),this.saveCaptionPreferences(),this.player.emit("captionschange")}getAvailableTracks(){return this.tracks.map((e,t)=>({index:t,language:e.language,label:e.label||e.language,kind:e.kind}))}switchTrack(e){e>=0&&e<this.tracks.length&&(this.disable(),this.enable(e))}destroy(){this.disable(),this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element)}},Z=class{constructor(e){this.player=e,this.shortcuts=e.options.keyboardShortcuts,this.init()}init(){this.attachEvents()}attachEvents(){this.player.container.addEventListener("keydown",e=>{this.handleKeydown(e)}),this.player.container.hasAttribute("tabindex")||this.player.container.setAttribute("tabindex","0")}handleKeydown(e){if(e.target.tagName==="INPUT"||e.target.tagName==="TEXTAREA"||e.target.tagName==="SELECT")return;const t=e.key;let i=!1;for(const[s,a]of Object.entries(this.shortcuts))if(a.includes(t)&&(i=this.executeAction(s,e),i)){e.preventDefault(),e.stopPropagation(),this.announceAction(s);break}!i&&this.player.options.debug&&console.log("[VidPly] Unhandled key:",e.key,"code:",e.code,"shiftKey:",e.shiftKey)}executeAction(e,t){switch(e){case"play-pause":return this.player.toggle(),!0;case"volume-up":return this.player.setVolume(Math.min(1,this.player.state.volume+.1)),!0;case"volume-down":return this.player.setVolume(Math.max(0,this.player.state.volume-.1)),!0;case"seek-forward":return this.player.seekForward(),!0;case"seek-backward":return this.player.seekBackward(),!0;case"mute":return this.player.toggleMute(),!0;case"fullscreen":return this.player.toggleFullscreen(),!0;case"captions":if(this.player.captionManager&&this.player.captionManager.tracks.length>1){const i=this.player.controlBar&&this.player.controlBar.controls.captions;i?this.player.controlBar.showCaptionsMenu(i):this.player.toggleCaptions()}else this.player.toggleCaptions();return!0;case"caption-style-menu":return this.player.controlBar&&this.player.controlBar.controls.captionStyle?(this.player.controlBar.showCaptionStyleMenu(this.player.controlBar.controls.captionStyle),!0):!1;case"speed-up":return this.player.setPlaybackSpeed(Math.min(2,this.player.state.playbackSpeed+.25)),!0;case"speed-down":return this.player.setPlaybackSpeed(Math.max(.25,this.player.state.playbackSpeed-.25)),!0;case"speed-menu":return this.player.controlBar&&this.player.controlBar.controls.speed?(this.player.controlBar.showSpeedMenu(this.player.controlBar.controls.speed),!0):!1;case"quality-menu":return this.player.controlBar&&this.player.controlBar.controls.quality?(this.player.controlBar.showQualityMenu(this.player.controlBar.controls.quality),!0):!1;case"chapters-menu":return this.player.controlBar&&this.player.controlBar.controls.chapters?(this.player.controlBar.showChaptersMenu(this.player.controlBar.controls.chapters),!0):!1;case"transcript-toggle":return this.player.transcriptManager?(this.player.transcriptManager.toggleTranscript(),!0):!1;default:return!1}}announceAction(e){if(!this.player.options.screenReaderAnnouncements)return;let t="";switch(e){case"play-pause":t=this.player.state.playing?"Playing":"Paused";break;case"volume-up":t=`Volume ${Math.round(this.player.state.volume*100)}%`;break;case"volume-down":t=`Volume ${Math.round(this.player.state.volume*100)}%`;break;case"mute":t=this.player.state.muted?"Muted":"Unmuted";break;case"fullscreen":t=this.player.state.fullscreen?"Fullscreen":"Exit fullscreen";break;case"captions":t=this.player.state.captionsEnabled?"Captions on":"Captions off";break;case"speed-up":case"speed-down":t=`Speed ${this.player.state.playbackSpeed}x`;break}t&&this.announce(t)}announce(e,t="polite"){let i=document.getElementById("vidply-announcer");i||(i=document.createElement("div"),i.id="vidply-announcer",i.className="vidply-sr-only",i.setAttribute("aria-live",t),i.setAttribute("aria-atomic","true"),i.style.cssText=`
        position: absolute;
        left: -10000px;
        width: 1px;
        height: 1px;
        overflow: hidden;
      `,document.body.appendChild(i)),i.textContent="",setTimeout(()=>{i.textContent=e},100)}updateShortcut(e,t){Array.isArray(t)&&(this.shortcuts[e]=t)}destroy(){}},$=class{constructor(e,t={}){this.element=e,this.options={dragHandle:null,resizeHandles:[],onDragStart:null,onDrag:null,onDragEnd:null,onResizeStart:null,onResize:null,onResizeEnd:null,constrainToViewport:!0,minWidth:150,minHeight:100,maintainAspectRatio:!1,keyboardDragKey:"d",keyboardResizeKey:"r",keyboardStep:5,keyboardStepLarge:10,maxWidth:null,maxHeight:null,pointerResizeIndicatorText:null,onPointerResizeToggle:null,classPrefix:"draggable",storage:null,storageKey:null,...t},this.isDragging=!1,this.isResizing=!1,this.resizeDirection=null,this.dragOffsetX=0,this.dragOffsetY=0,this.positionOffsetX=0,this.positionOffsetY=0,this.initialMouseX=0,this.initialMouseY=0,this.needsPositionConversion=!1,this.resizeStartX=0,this.resizeStartY=0,this.resizeStartWidth=0,this.resizeStartHeight=0,this.resizeStartLeft=0,this.resizeStartTop=0,this.keyboardDragMode=!1,this.keyboardResizeMode=!1,this.pointerResizeMode=!1,this.manuallyPositioned=!1,this.resizeHandlesManaged=new Map,this.resizeIndicatorElement=null,this.handlers={mousedown:this.onMouseDown.bind(this),mousemove:this.onMouseMove.bind(this),mouseup:this.onMouseUp.bind(this),touchstart:this.onTouchStart.bind(this),touchmove:this.onTouchMove.bind(this),touchend:this.onTouchEnd.bind(this),keydown:this.onKeyDown.bind(this),resizeHandleMousedown:this.onResizeHandleMouseDown.bind(this)},this.init()}hasManagedResizeHandles(){return Array.from(this.resizeHandlesManaged.values()).some(Boolean)}storeOriginalHandleDisplay(e){e.dataset.originalDisplay||(e.dataset.originalDisplay=e.style.display||"")}hideResizeHandle(e){e.style.display="none",e.setAttribute("aria-hidden","true")}showResizeHandle(e){const t=e.dataset.originalDisplay!==void 0?e.dataset.originalDisplay:"";e.style.display=t,e.removeAttribute("aria-hidden")}setManagedHandlesVisible(e){!this.options.resizeHandles||this.options.resizeHandles.length===0||this.options.resizeHandles.forEach(t=>{this.resizeHandlesManaged.get(t)&&(e?this.showResizeHandle(t):this.hideResizeHandle(t))})}init(){const e=this.options.dragHandle||this.element;e.addEventListener("mousedown",this.handlers.mousedown),e.addEventListener("touchstart",this.handlers.touchstart),document.addEventListener("mousemove",this.handlers.mousemove),document.addEventListener("mouseup",this.handlers.mouseup),document.addEventListener("touchmove",this.handlers.touchmove,{passive:!1}),document.addEventListener("touchend",this.handlers.touchend),this.element.addEventListener("keydown",this.handlers.keydown),this.options.resizeHandles&&this.options.resizeHandles.length>0&&this.options.resizeHandles.forEach(t=>{t.addEventListener("mousedown",this.handlers.resizeHandleMousedown),t.addEventListener("touchstart",this.handlers.resizeHandleMousedown);const i=t.dataset.vidplyManagedResize==="true";this.resizeHandlesManaged.set(t,i),i&&(this.storeOriginalHandleDisplay(t),this.hideResizeHandle(t))})}onMouseDown(e){e.target.classList.contains(`${this.options.classPrefix}-resize-handle`)||this.options.onDragStart&&!this.options.onDragStart(e)||(this.startDragging(e.clientX,e.clientY),e.preventDefault())}onTouchStart(e){if(e.target.classList.contains(`${this.options.classPrefix}-resize-handle`)||this.options.onDragStart&&!this.options.onDragStart(e))return;const t=e.touches[0];this.startDragging(t.clientX,t.clientY)}onResizeHandleMouseDown(e){var t,i,s,a;e.preventDefault(),e.stopPropagation();const n=e.target;this.resizeDirection=n.getAttribute("data-direction");const o=e.clientX||((i=(t=e.touches)==null?void 0:t[0])==null?void 0:i.clientX),r=e.clientY||((a=(s=e.touches)==null?void 0:s[0])==null?void 0:a.clientY);this.startResizing(o,r)}onMouseMove(e){this.isDragging?(this.drag(e.clientX,e.clientY),e.preventDefault()):this.isResizing&&(this.resize(e.clientX,e.clientY),e.preventDefault())}onTouchMove(e){if(this.isDragging||this.isResizing){const t=e.touches[0];this.isDragging?this.drag(t.clientX,t.clientY):this.resize(t.clientX,t.clientY),e.preventDefault()}}onMouseUp(){this.isDragging?this.stopDragging():this.isResizing&&this.stopResizing()}onTouchEnd(){this.isDragging?this.stopDragging():this.isResizing&&this.stopResizing()}onKeyDown(e){if(e.key.toLowerCase()===this.options.keyboardDragKey.toLowerCase()){e.preventDefault(),this.toggleKeyboardDragMode();return}if(e.key.toLowerCase()===this.options.keyboardResizeKey.toLowerCase()){e.preventDefault(),this.hasManagedResizeHandles()?this.togglePointerResizeMode():this.toggleKeyboardResizeMode();return}if(e.key==="Escape"){if(this.pointerResizeMode){e.preventDefault(),this.disablePointerResizeMode();return}if(this.keyboardDragMode||this.keyboardResizeMode){e.preventDefault(),this.disableKeyboardDragMode(),this.disableKeyboardResizeMode();return}}["ArrowLeft","ArrowRight","ArrowUp","ArrowDown"].includes(e.key)&&(this.keyboardDragMode?(e.preventDefault(),e.stopPropagation(),this.keyboardDrag(e.key,e.shiftKey)):this.keyboardResizeMode&&(e.preventDefault(),e.stopPropagation(),this.keyboardResize(e.key,e.shiftKey))),e.key==="Home"&&(this.keyboardDragMode||this.keyboardResizeMode)&&(e.preventDefault(),this.resetPosition())}startDragging(e,t){const i=this.element.getBoundingClientRect(),s=window.getComputedStyle(this.element),a=s.right!=="auto"||s.bottom!=="auto"||s.transform!=="none";if(this.positionOffsetX=0,this.positionOffsetY=0,a){let o,r;if(s.position==="absolute"){const g=(this.element.offsetParent||document.body).getBoundingClientRect();o=i.left-g.left,r=i.top-g.top,this.positionOffsetX=g.left,this.positionOffsetY=g.top}else if(s.position==="fixed"){const h=parseFloat(s.left),g=parseFloat(s.top),y=Number.isFinite(h),m=Number.isFinite(g);o=y?h:i.left,r=m?g:i.top,this.positionOffsetX=i.left-o,this.positionOffsetY=i.top-r}else o=i.left,r=i.top,this.positionOffsetX=i.left-o,this.positionOffsetY=i.top-r;let d=this.element.style.cssText.split(";").filter(h=>{const g=h.trim();return g&&!g.startsWith("right:")&&!g.startsWith("bottom:")&&!g.startsWith("transform:")&&!g.startsWith("left:")&&!g.startsWith("top:")&&!g.startsWith("inset:")}).join("; ");d&&(d+="; "),d+=`left: ${o}px; top: ${r}px; right: auto; bottom: auto; transform: none`,this.element.style.cssText=d}const n=this.element.getBoundingClientRect();this.dragOffsetX=e-n.left,this.dragOffsetY=t-n.top,this.isDragging=!0,this.element.classList.add(`${this.options.classPrefix}-dragging`),document.body.style.cursor="grabbing",document.body.style.userSelect="none"}drag(e,t){if(!this.isDragging)return;let i=e-this.dragOffsetX-this.positionOffsetX,s=t-this.dragOffsetY-this.positionOffsetY;if(this.options.constrainToViewport){const a=this.element.getBoundingClientRect(),n=document.documentElement.clientWidth,o=document.documentElement.clientHeight,r=100,c=-(a.width-r),d=-(a.height-r),h=n-r,g=o-r;i=Math.max(c,Math.min(i,h)),s=Math.max(d,Math.min(s,g))}this.element.style.left=`${i}px`,this.element.style.top=`${s}px`,this.options.onDrag&&this.options.onDrag({x:i,y:s})}stopDragging(){this.isDragging=!1,this.element.classList.remove(`${this.options.classPrefix}-dragging`),document.body.style.cursor="",document.body.style.userSelect="",this.manuallyPositioned=!0,this.options.onDragEnd&&this.options.onDragEnd()}startResizing(e,t){this.isResizing=!0,this.resizeStartX=e,this.resizeStartY=t;const i=this.element.getBoundingClientRect();this.resizeStartWidth=i.width,this.resizeStartHeight=i.height,this.resizeStartLeft=i.left,this.resizeStartTop=i.top,this.element.classList.add(`${this.options.classPrefix}-resizing`),document.body.style.userSelect="none",this.options.onResizeStart&&this.options.onResizeStart()}resize(e,t){if(!this.isResizing)return;const i=e-this.resizeStartX,s=t-this.resizeStartY;let a=this.resizeStartWidth,n=this.resizeStartHeight,o=this.resizeStartLeft,r=this.resizeStartTop;if(this.resizeDirection.includes("e")&&(a=Math.max(this.options.minWidth,this.resizeStartWidth+i)),this.resizeDirection.includes("w")){const d=Math.max(this.options.minWidth,this.resizeStartWidth-i);o=this.resizeStartLeft+(this.resizeStartWidth-d),a=d}const c=typeof this.options.maxWidth=="function"?this.options.maxWidth():this.options.maxWidth;if(Number.isFinite(c)){const d=Math.min(a,c);d!==a&&this.resizeDirection.includes("w")&&(o+=a-d),a=d}if(!this.options.maintainAspectRatio){if(this.resizeDirection.includes("s")&&(n=Math.max(this.options.minHeight,this.resizeStartHeight+s)),this.resizeDirection.includes("n")){const h=Math.max(this.options.minHeight,this.resizeStartHeight-s);r=this.resizeStartTop+(this.resizeStartHeight-h),n=h}const d=typeof this.options.maxHeight=="function"?this.options.maxHeight():this.options.maxHeight;if(Number.isFinite(d)){const h=Math.min(n,d);h!==n&&this.resizeDirection.includes("n")&&(r+=n-h),n=h}}this.element.style.width=`${a}px`,this.options.maintainAspectRatio?this.element.style.height="auto":this.element.style.height=`${n}px`,this.resizeDirection.includes("w")&&(this.element.style.left=`${o}px`),this.resizeDirection.includes("n")&&!this.options.maintainAspectRatio&&(this.element.style.top=`${r}px`),this.options.onResize&&this.options.onResize({width:a,height:n,left:o,top:r})}stopResizing(){this.isResizing=!1,this.resizeDirection=null,this.element.classList.remove(`${this.options.classPrefix}-resizing`),document.body.style.userSelect="",this.manuallyPositioned=!0,this.options.onResizeEnd&&this.options.onResizeEnd()}toggleKeyboardDragMode(){this.keyboardDragMode?this.disableKeyboardDragMode():this.enableKeyboardDragMode()}enableKeyboardDragMode(){this.keyboardDragMode=!0,this.keyboardResizeMode=!1,this.element.classList.add(`${this.options.classPrefix}-keyboard-drag`),this.element.classList.remove(`${this.options.classPrefix}-keyboard-resize`),this.focusElement()}disableKeyboardDragMode(){this.keyboardDragMode=!1,this.element.classList.remove(`${this.options.classPrefix}-keyboard-drag`)}toggleKeyboardResizeMode(){this.keyboardResizeMode?this.disableKeyboardResizeMode():this.enableKeyboardResizeMode()}enableKeyboardResizeMode(){this.keyboardResizeMode=!0,this.keyboardDragMode=!1,this.element.classList.add(`${this.options.classPrefix}-keyboard-resize`),this.element.classList.remove(`${this.options.classPrefix}-keyboard-drag`),this.focusElement()}disableKeyboardResizeMode(){this.keyboardResizeMode=!1,this.element.classList.remove(`${this.options.classPrefix}-keyboard-resize`)}enablePointerResizeMode({focus:e=!0}={}){if(!this.hasManagedResizeHandles()){this.enableKeyboardResizeMode();return}this.pointerResizeMode||(this.pointerResizeMode=!0,this.setManagedHandlesVisible(!0),this.element.classList.add(`${this.options.classPrefix}-resizable`),this.enableKeyboardResizeMode(),e&&this.focusElement(),typeof this.options.onPointerResizeToggle=="function"&&this.options.onPointerResizeToggle(!0))}disablePointerResizeMode({focus:e=!1}={}){this.pointerResizeMode&&(this.pointerResizeMode=!1,this.setManagedHandlesVisible(!1),this.element.classList.remove(`${this.options.classPrefix}-resizable`),this.disableKeyboardResizeMode(),e&&this.focusElement(),typeof this.options.onPointerResizeToggle=="function"&&this.options.onPointerResizeToggle(!1))}togglePointerResizeMode(){return this.pointerResizeMode?this.disablePointerResizeMode():this.enablePointerResizeMode(),this.pointerResizeMode}focusElement(){if(typeof this.element.focus=="function")try{this.element.focus({preventScroll:!0})}catch{this.element.focus()}}keyboardDrag(e,t){const i=t?this.options.keyboardStepLarge:this.options.keyboardStep;let s=parseFloat(this.element.style.left)||0,a=parseFloat(this.element.style.top)||0;if(window.getComputedStyle(this.element).transform!=="none"){const c=this.element.getBoundingClientRect();s=c.left,a=c.top,this.element.style.transform="none",this.element.style.left=`${s}px`,this.element.style.top=`${a}px`}let o=s,r=a;switch(e){case"ArrowLeft":o-=i;break;case"ArrowRight":o+=i;break;case"ArrowUp":r-=i;break;case"ArrowDown":r+=i;break}this.element.style.left=`${o}px`,this.element.style.top=`${r}px`,this.options.onDrag&&this.options.onDrag({x:o,y:r})}keyboardResize(e,t){const i=t?this.options.keyboardStepLarge:this.options.keyboardStep,s=this.element.getBoundingClientRect();let a=s.width,n=s.height;switch(e){case"ArrowLeft":a-=i;break;case"ArrowRight":a+=i;break;case"ArrowUp":this.options.maintainAspectRatio?a+=i:n-=i;break;case"ArrowDown":this.options.maintainAspectRatio?a-=i:n+=i;break}a=Math.max(this.options.minWidth,a),n=Math.max(this.options.minHeight,n),this.element.style.width=`${a}px`,this.options.maintainAspectRatio?this.element.style.height="auto":this.element.style.height=`${n}px`,this.options.onResize&&this.options.onResize({width:a,height:n})}resetPosition(){this.element.style.left="50%",this.element.style.top="50%",this.element.style.transform="translate(-50%, -50%)",this.element.style.right="",this.element.style.bottom="",this.manuallyPositioned=!1,this.options.onDrag&&this.options.onDrag({centered:!0})}destroy(){const e=this.options.dragHandle||this.element;this.disablePointerResizeMode(),e.removeEventListener("mousedown",this.handlers.mousedown),e.removeEventListener("touchstart",this.handlers.touchstart),document.removeEventListener("mousemove",this.handlers.mousemove),document.removeEventListener("mouseup",this.handlers.mouseup),document.removeEventListener("touchmove",this.handlers.touchmove),document.removeEventListener("touchend",this.handlers.touchend),this.element.removeEventListener("keydown",this.handlers.keydown),this.options.resizeHandles&&this.options.resizeHandles.length>0&&this.options.resizeHandles.forEach(t=>{t.removeEventListener("mousedown",this.handlers.resizeHandleMousedown),t.removeEventListener("touchstart",this.handlers.resizeHandleMousedown)}),this.element.classList.remove(`${this.options.classPrefix}-dragging`,`${this.options.classPrefix}-resizing`,`${this.options.classPrefix}-keyboard-drag`,`${this.options.classPrefix}-keyboard-resize`)}},B=class{constructor(e){this.player=e,this.transcriptWindow=null,this.transcriptEntries=[],this.metadataCues=[],this.currentActiveEntry=null,this.isVisible=!1,this.storage=new A("vidply"),this.draggableResizable=null,this.settingsMenuVisible=!1,this.settingsMenu=null,this.settingsButton=null,this.settingsMenuJustOpened=!1,this.resizeOptionButton=null,this.resizeOptionText=null,this.resizeModeIndicator=null,this.resizeModeIndicatorTimeout=null,this.transcriptResizeHandles=[],this.liveRegion=null,this.styleDialog=null,this.styleDialogVisible=!1,this.styleDialogJustOpened=!1,this.languageSelector=null,this.currentTranscriptLanguage=null,this.availableTranscriptLanguages=[],this.languageSelectorHandler=null;const t=this.storage.getTranscriptPreferences();this.autoscrollEnabled=t?.autoscroll!==void 0?t.autoscroll:!0,this.transcriptStyle={fontSize:t?.fontSize||this.player.options.transcriptFontSize||"100%",fontFamily:t?.fontFamily||this.player.options.transcriptFontFamily||"sans-serif",color:t?.color||this.player.options.transcriptColor||"#ffffff",backgroundColor:t?.backgroundColor||this.player.options.transcriptBackgroundColor||"#1e1e1e",opacity:t?.opacity??this.player.options.transcriptOpacity??.98},this.handlers={timeupdate:()=>this.updateActiveEntry(),resize:null,settingsClick:null,settingsKeydown:null,documentClick:null,styleDialogKeydown:null},this.timeouts=new Set,this.init()}init(){this.setupMetadataHandlingOnLoad(),this.player.on("timeupdate",this.handlers.timeupdate),this.player.on("fullscreenchange",()=>{this.isVisible&&(!this.draggableResizable||!this.draggableResizable.manuallyPositioned)&&this.setManagedTimeout(()=>this.positionTranscript(),100)})}toggleTranscript(){this.isVisible?this.hideTranscript():this.showTranscript()}showTranscript(){if(this.transcriptWindow){this.transcriptWindow.style.display="flex",this.isVisible=!0,this.player.controlBar&&typeof this.player.controlBar.updateTranscriptButton=="function"&&this.player.controlBar.updateTranscriptButton(),this.setManagedTimeout(()=>{this.transcriptHeader&&this.transcriptHeader.focus()},150);return}this.createTranscriptWindow(),this.loadTranscriptData(),this.transcriptWindow&&(this.transcriptWindow.style.display="flex",(!this.draggableResizable||!this.draggableResizable.manuallyPositioned)&&this.setManagedTimeout(()=>this.positionTranscript(),0),this.setManagedTimeout(()=>{this.transcriptHeader&&this.transcriptHeader.focus()},150)),this.isVisible=!0}hideTranscript({focusButton:e=!1}={}){var t,i;if(this.transcriptWindow&&(this.transcriptWindow.style.display="none",this.isVisible=!1),this.draggableResizable&&this.draggableResizable.pointerResizeMode&&(this.draggableResizable.disablePointerResizeMode(),this.updateResizeOptionState()),this.hideResizeModeIndicator(),this.announceLive(""),this.player.controlBar&&typeof this.player.controlBar.updateTranscriptButton=="function"&&this.player.controlBar.updateTranscriptButton(),e){const s=(i=(t=this.player.controlBar)==null?void 0:t.controls)==null?void 0:i.transcript;s&&typeof s.focus=="function"&&s.focus()}}createTranscriptWindow(){this.transcriptWindow=l.createElement("div",{className:`${this.player.options.classPrefix}-transcript-window`,attributes:{role:"dialog","aria-label":"Video Transcript",tabindex:"-1"}}),this.transcriptHeader=l.createElement("div",{className:`${this.player.options.classPrefix}-transcript-header`,attributes:{tabindex:"0"}}),this.headerLeft=l.createElement("div",{className:`${this.player.options.classPrefix}-transcript-header-left`}),this.settingsButton=l.createElement("button",{className:`${this.player.options.classPrefix}-transcript-settings`,attributes:{type:"button","aria-label":u.t("transcript.settingsMenu"),"aria-expanded":"false"}}),this.settingsButton.appendChild(f("settings")),this.handlers.settingsClick=n=>{n.preventDefault(),n.stopPropagation(),this.settingsMenuVisible?this.hideSettingsMenu():this.showSettingsMenu()},this.settingsButton.addEventListener("click",this.handlers.settingsClick),this.handlers.settingsKeydown=n=>{n.key==="d"||n.key==="D"?(n.preventDefault(),n.stopPropagation(),this.toggleKeyboardDragMode()):n.key==="r"||n.key==="R"?(n.preventDefault(),n.stopPropagation(),this.toggleResizeMode()):n.key==="Escape"&&this.settingsMenuVisible&&(n.preventDefault(),n.stopPropagation(),this.hideSettingsMenu())},this.settingsButton.addEventListener("keydown",this.handlers.settingsKeydown);const e=l.createElement("h3",{textContent:`${u.t("transcript.title")}. ${u.t("transcript.dragResizePrompt")}`}),t=l.createElement("label",{className:`${this.player.options.classPrefix}-transcript-autoscroll-label`,attributes:{title:u.t("transcript.autoscroll")}});this.autoscrollCheckbox=l.createElement("input",{attributes:{type:"checkbox",checked:this.autoscrollEnabled,"aria-label":u.t("transcript.autoscroll")}});const i=l.createElement("span",{textContent:u.t("transcript.autoscroll"),className:`${this.player.options.classPrefix}-transcript-autoscroll-text`});t.appendChild(this.autoscrollCheckbox),t.appendChild(i),this.autoscrollCheckbox.addEventListener("change",n=>{this.autoscrollEnabled=n.target.checked,this.saveAutoscrollPreference()}),this.transcriptHeader.appendChild(e),this.headerLeft.appendChild(this.settingsButton),this.headerLeft.appendChild(t),this.languageSelector=l.createElement("select",{className:`${this.player.options.classPrefix}-transcript-language-select`,attributes:{"aria-label":u.t("settings.language")||"Language",style:"display: none;"}}),this.headerLeft.appendChild(this.languageSelector);const s=l.createElement("button",{className:`${this.player.options.classPrefix}-transcript-close`,attributes:{type:"button","aria-label":u.t("transcript.close")}});s.appendChild(f("close")),s.addEventListener("click",()=>this.hideTranscript({focusButton:!0})),this.transcriptHeader.appendChild(this.headerLeft),this.transcriptHeader.appendChild(s),this.transcriptContent=l.createElement("div",{className:`${this.player.options.classPrefix}-transcript-content`}),this.transcriptWindow.appendChild(this.transcriptHeader),this.transcriptWindow.appendChild(this.transcriptContent),this.createResizeHandles(),this.liveRegion=l.createElement("div",{className:"vidply-sr-only",attributes:{"aria-live":"polite","aria-atomic":"true"}}),this.transcriptWindow.appendChild(this.liveRegion),this.player.container.appendChild(this.transcriptWindow),this.setupDragAndDrop(),(!this.draggableResizable||!this.draggableResizable.manuallyPositioned)&&this.positionTranscript(),this.handlers.documentClick=n=>{this.settingsMenuJustOpened||this.styleDialogJustOpened||this.settingsButton&&this.settingsButton.contains(n.target)||this.settingsMenu&&this.settingsMenu.contains(n.target)||(this.settingsMenuVisible&&this.hideSettingsMenu(),this.styleDialogVisible&&this.styleDialog&&!this.styleDialog.contains(n.target)&&this.hideStyleDialog())},this.documentClickHandlerAdded=!1;let a;this.handlers.resize=()=>{a&&this.clearManagedTimeout(a),a=this.setManagedTimeout(()=>{(!this.draggableResizable||!this.draggableResizable.manuallyPositioned)&&this.positionTranscript()},100)},window.addEventListener("resize",this.handlers.resize)}createResizeHandles(){if(!this.transcriptWindow)return;const e=["n","s","e","w","ne","nw","se","sw"];this.transcriptResizeHandles=e.map(t=>{const i=l.createElement("div",{className:`${this.player.options.classPrefix}-transcript-resize-handle ${this.player.options.classPrefix}-transcript-resize-${t}`,attributes:{"data-direction":t,"data-vidply-managed-resize":"true","aria-hidden":"true"}});return i.style.display="none",this.transcriptWindow.appendChild(i),i})}positionTranscript(){if(!this.transcriptWindow||!this.player.videoWrapper||!this.isVisible||this.draggableResizable&&this.draggableResizable.manuallyPositioned)return;const e=window.innerWidth<640,t=this.player.videoWrapper.getBoundingClientRect(),i=this.player.state.fullscreen;if(e&&!i)this.transcriptWindow.style.position="relative",this.transcriptWindow.style.left="0",this.transcriptWindow.style.right="0",this.transcriptWindow.style.bottom="auto",this.transcriptWindow.style.top="auto",this.transcriptWindow.style.width="100%",this.transcriptWindow.style.maxWidth="100%",this.transcriptWindow.style.maxHeight="400px",this.transcriptWindow.style.height="auto",this.transcriptWindow.style.borderRadius="0",this.transcriptWindow.style.transform="none",this.transcriptWindow.style.border="none",this.transcriptWindow.style.borderTop="1px solid var(--vidply-border-light)",this.transcriptWindow.style.boxShadow="none",this.transcriptHeader&&(this.transcriptHeader.style.cursor="default"),this.transcriptWindow.parentNode!==this.player.container&&this.player.container.appendChild(this.transcriptWindow);else if(i){this.transcriptWindow.style.position="fixed",this.transcriptWindow.style.left="auto",this.transcriptWindow.style.right="20px",this.transcriptWindow.style.bottom="80px",this.transcriptWindow.style.top="auto",this.transcriptWindow.style.maxHeight="calc(100vh - 180px)",this.transcriptWindow.style.height="auto";const s=260,a=Math.max(s,window.innerWidth-40),n=parseFloat(this.transcriptWindow.style.width)||400,o=Math.max(s,Math.min(n,a));this.transcriptWindow.style.width=`${o}px`,this.transcriptWindow.style.maxWidth="none",this.transcriptWindow.style.borderRadius="8px",this.transcriptWindow.style.border="1px solid var(--vidply-border)",this.transcriptWindow.style.borderTop="",this.transcriptWindow.parentNode!==this.player.container&&this.player.container.appendChild(this.transcriptWindow)}else{const s=parseFloat(this.transcriptWindow.style.width)||400,a=20,n=260,o=this.player.container.getBoundingClientRect();(()=>{window.getComputedStyle(this.player.container).position==="static"&&(this.player.container.style.position="relative")})();const c=t.right-o.left+a,d=window.innerWidth-t.right-a,h=Math.max(n,Math.min(s,d)),g=t.height;this.transcriptWindow.style.position="absolute",this.transcriptWindow.style.left=`${c}px`,this.transcriptWindow.style.right="auto",this.transcriptWindow.style.bottom="auto",this.transcriptWindow.style.top="0",this.transcriptWindow.style.height=`${g}px`,this.transcriptWindow.style.maxHeight="none",this.transcriptWindow.style.width=`${h}px`,this.transcriptWindow.style.maxWidth="none",this.transcriptWindow.style.borderRadius="8px",this.transcriptWindow.style.border="1px solid var(--vidply-border)",this.transcriptWindow.style.borderTop="",this.transcriptHeader&&(this.transcriptHeader.style.cursor="move"),this.transcriptWindow.parentNode!==this.player.container&&this.player.container.appendChild(this.transcriptWindow)}}getAvailableTranscriptLanguages(){const e=this.player.textTracks,t=new Map;return e.forEach(i=>{(i.kind==="captions"||i.kind==="subtitles")&&i.language&&(t.has(i.language)||t.set(i.language,{language:i.language,label:i.label||i.language,track:i}))}),Array.from(t.values())}updateLanguageSelector(){if(this.languageSelector){if(this.availableTranscriptLanguages=this.getAvailableTranscriptLanguages(),this.languageSelector.innerHTML="",this.availableTranscriptLanguages.length<2){this.languageSelector.style.display="none";return}if(this.languageSelector.style.display="block",this.availableTranscriptLanguages.forEach((e,t)=>{const i=l.createElement("option",{textContent:e.label,attributes:{value:e.language}});this.languageSelector.appendChild(i)}),this.currentTranscriptLanguage)this.languageSelector.value=this.currentTranscriptLanguage;else if(this.availableTranscriptLanguages.length>0){const e=this.player.textTracks.find(t=>(t.kind==="captions"||t.kind==="subtitles")&&t.mode==="showing");this.currentTranscriptLanguage=e?e.language:this.availableTranscriptLanguages[0].language,this.languageSelector.value=this.currentTranscriptLanguage}this.languageSelectorHandler&&this.languageSelector.removeEventListener("change",this.languageSelectorHandler),this.languageSelectorHandler=e=>{this.currentTranscriptLanguage=e.target.value,this.loadTranscriptData()},this.languageSelector.addEventListener("change",this.languageSelectorHandler)}}loadTranscriptData(){this.transcriptEntries=[],this.transcriptContent.innerHTML="";const e=this.player.textTracks;let t=null;this.currentTranscriptLanguage&&(t=e.find(r=>(r.kind==="captions"||r.kind==="subtitles")&&r.language===this.currentTranscriptLanguage)),t||(t=e.find(r=>r.kind==="captions"||r.kind==="subtitles"),t&&(this.currentTranscriptLanguage=t.language));let i=null;this.currentTranscriptLanguage&&(i=e.find(r=>r.kind==="descriptions"&&r.language===this.currentTranscriptLanguage)),i||(i=e.find(r=>r.kind==="descriptions"));const s=e.find(r=>r.kind==="metadata");if(!t&&!i&&!s){this.showNoTranscriptMessage();return}const a=[t,i,s].filter(Boolean);if(a.forEach(r=>{r.mode==="disabled"&&(r.mode="hidden")}),a.some(r=>!r.cues||r.cues.length===0)){const r=l.createElement("div",{className:`${this.player.options.classPrefix}-transcript-loading`,textContent:u.t("transcript.loading")});this.transcriptContent.appendChild(r);let c=0;const d=()=>{c++,c>=a.length&&this.loadTranscriptData()};a.forEach(h=>{h.addEventListener("load",d,{once:!0})}),this.setManagedTimeout(()=>{this.loadTranscriptData()},500);return}const o=[];t&&t.cues&&Array.from(t.cues).forEach(r=>{o.push({cue:r,type:"caption"})}),i&&i.cues&&Array.from(i.cues).forEach(r=>{o.push({cue:r,type:"description"})}),s&&s.cues&&(this.metadataCues=Array.from(s.cues),this.setupMetadataHandling()),o.sort((r,c)=>r.cue.startTime-c.cue.startTime),o.forEach((r,c)=>{const d=this.createTranscriptEntry(r.cue,c,r.type);this.transcriptEntries.push({element:d,cue:r.cue,type:r.type,startTime:r.cue.startTime,endTime:r.cue.endTime}),this.transcriptContent.appendChild(d)}),this.applyTranscriptStyles(),this.updateLanguageSelector()}setupMetadataHandlingOnLoad(){const e=()=>{const i=this.player.textTracks.find(s=>s.kind==="metadata");if(i){if(i.mode==="disabled"&&(i.mode="hidden"),this.metadataCueChangeHandler&&i.removeEventListener("cuechange",this.metadataCueChangeHandler),this.metadataCueChangeHandler=()=>{const s=Array.from(i.activeCues||[]);s.length>0&&this.player.options.debug&&console.log("[VidPly Metadata] Active cues:",s.map(a=>({start:a.startTime,end:a.endTime,text:a.text}))),s.forEach(a=>{this.handleMetadataCue(a)})},i.addEventListener("cuechange",this.metadataCueChangeHandler),this.player.options.debug){const s=i.cues?i.cues.length:0;console.log("[VidPly Metadata] Track enabled,",s,"cues available")}}else this.player.options.debug&&console.warn("[VidPly Metadata] No metadata track found")};e(),this.player.on("loadedmetadata",e)}setupMetadataHandling(){!this.metadataCues||this.metadataCues.length===0||this.player.options.debug&&console.log("[VidPly Metadata]",this.metadataCues.length,"cues stored from transcript load")}handleMetadataCue(e){const t=e.text.trim();this.player.options.debug&&console.log("[VidPly Metadata] Processing cue:",{time:e.startTime,text:t}),this.player.emit("metadata",{time:e.startTime,endTime:e.endTime,text:t,cue:e}),t.includes("PAUSE")&&(this.player.state.paused||(this.player.options.debug&&console.log("[VidPly Metadata] Pausing video at",e.startTime),this.player.pause()),this.player.emit("metadata:pause",{time:e.startTime,text:t}));const i=t.match(/FOCUS:([\w#-]+)/);if(i){const a=i[1],n=document.querySelector(a);n?(this.player.options.debug&&console.log("[VidPly Metadata] Focusing element:",a),this.setManagedTimeout(()=>{n.focus()},10)):this.player.options.debug&&console.warn("[VidPly Metadata] Element not found:",a),this.player.emit("metadata:focus",{time:e.startTime,target:a,element:n,text:t})}const s=t.match(/#[\w-]+/g);s&&(this.player.options.debug&&console.log("[VidPly Metadata] Hashtags found:",s),this.player.emit("metadata:hashtags",{time:e.startTime,hashtags:s,text:t}))}createTranscriptEntry(e,t,i="caption"){const s=l.createElement("div",{className:`${this.player.options.classPrefix}-transcript-entry ${this.player.options.classPrefix}-transcript-${i}`,attributes:{"data-start":String(e.startTime),"data-end":String(e.endTime),"data-type":i,role:"button",tabindex:"0"}}),a=l.createElement("span",{className:`${this.player.options.classPrefix}-transcript-time`,textContent:T.formatTime(e.startTime)}),n=l.createElement("span",{className:`${this.player.options.classPrefix}-transcript-text`,textContent:this.stripVTTFormatting(e.text)});s.appendChild(a),s.appendChild(n);const o=()=>{this.player.seek(e.startTime),this.player.state.paused&&this.player.play()};return s.addEventListener("click",o),s.addEventListener("keydown",r=>{(r.key==="Enter"||r.key===" ")&&(r.preventDefault(),o())}),s}stripVTTFormatting(e){return e.replace(/<[^>]+>/g,"").replace(/\n/g," ").trim()}showNoTranscriptMessage(){const e=l.createElement("div",{className:`${this.player.options.classPrefix}-transcript-empty`,textContent:u.t("transcript.noTranscript")});this.transcriptContent.appendChild(e)}updateActiveEntry(){if(!this.isVisible||this.transcriptEntries.length===0)return;const e=this.player.state.currentTime,t=this.transcriptEntries.find(i=>e>=i.startTime&&e<i.endTime);t&&t!==this.currentActiveEntry?(this.currentActiveEntry&&this.currentActiveEntry.element.classList.remove(`${this.player.options.classPrefix}-transcript-entry-active`),t.element.classList.add(`${this.player.options.classPrefix}-transcript-entry-active`),this.scrollToEntry(t.element),this.currentActiveEntry=t):!t&&this.currentActiveEntry&&(this.currentActiveEntry.element.classList.remove(`${this.player.options.classPrefix}-transcript-entry-active`),this.currentActiveEntry=null)}scrollToEntry(e){if(!this.transcriptContent||!this.autoscrollEnabled)return;const t=this.transcriptContent.getBoundingClientRect(),i=e.getBoundingClientRect();if(i.top<t.top||i.bottom>t.bottom){const s=e.offsetTop-this.transcriptContent.clientHeight/2+e.clientHeight/2;this.transcriptContent.scrollTo({top:s,behavior:"smooth"})}}saveAutoscrollPreference(){const e=this.storage.getTranscriptPreferences()||{};e.autoscroll=this.autoscrollEnabled,this.storage.saveTranscriptPreferences(e)}setupDragAndDrop(){if(!this.transcriptHeader||!this.transcriptWindow)return;const e=window.innerWidth<640,t=this.player.state.fullscreen;e&&!t||(this.draggableResizable=new $(this.transcriptWindow,{dragHandle:this.transcriptHeader,resizeHandles:this.transcriptResizeHandles,constrainToViewport:!0,classPrefix:`${this.player.options.classPrefix}-transcript`,keyboardDragKey:"d",keyboardResizeKey:"r",keyboardStep:10,keyboardStepLarge:50,minWidth:300,minHeight:200,maxWidth:()=>Math.max(320,window.innerWidth-40),maxHeight:()=>Math.max(200,window.innerHeight-120),pointerResizeIndicatorText:u.t("transcript.resizeModeHint"),onPointerResizeToggle:i=>this.onPointerResizeModeChange(i),onDragStart:i=>{const s=[`.${this.player.options.classPrefix}-transcript-close`,`.${this.player.options.classPrefix}-transcript-settings`,`.${this.player.options.classPrefix}-transcript-language-select`,`.${this.player.options.classPrefix}-transcript-settings-menu`,`.${this.player.options.classPrefix}-transcript-style-dialog`];for(const a of s)if(i.target.closest(a))return!1;return!0}}),this.customKeyHandler=i=>{const s=i.key.toLowerCase(),a=i.defaultPrevented;if(s==="home"){i.preventDefault(),i.stopPropagation(),this.draggableResizable&&(this.draggableResizable.pointerResizeMode&&this.draggableResizable.disablePointerResizeMode(),this.draggableResizable.manuallyPositioned=!1,this.positionTranscript(),this.updateResizeOptionState(),this.announceLive(u.t("transcript.positionReset")));return}if(s==="r"){if(a)return;i.preventDefault(),i.stopPropagation(),this.toggleResizeMode()&&this.transcriptWindow.focus();return}if(s==="escape"){if(i.preventDefault(),i.stopPropagation(),this.draggableResizable&&this.draggableResizable.pointerResizeMode){this.draggableResizable.disablePointerResizeMode();return}this.styleDialogVisible?this.hideStyleDialog():this.draggableResizable&&this.draggableResizable.keyboardDragMode?(this.draggableResizable.disableKeyboardDragMode(),this.announceLive(u.t("transcript.dragModeDisabled"))):this.settingsMenuVisible?this.hideSettingsMenu():this.hideTranscript({focusButton:!0});return}},this.transcriptWindow.addEventListener("keydown",this.customKeyHandler))}toggleKeyboardDragMode(){if(this.draggableResizable){const e=this.draggableResizable.keyboardDragMode;this.draggableResizable.toggleKeyboardDragMode();const t=this.draggableResizable.keyboardDragMode;!e&&t&&this.enableMoveMode(),this.settingsMenuVisible&&this.hideSettingsMenu(),this.transcriptWindow.focus()}}toggleSettingsMenu(){this.settingsMenuVisible?this.hideSettingsMenu():this.showSettingsMenu()}showSettingsMenu(){if(this.settingsMenuJustOpened=!0,setTimeout(()=>{this.settingsMenuJustOpened=!1},350),this.documentClickHandlerAdded||setTimeout(()=>{document.addEventListener("click",this.handlers.documentClick),this.documentClickHandlerAdded=!0},300),this.settingsMenu){this.settingsMenu.style.display="block",this.settingsMenuVisible=!0,this.settingsButton&&this.settingsButton.setAttribute("aria-expanded","true"),this.updateResizeOptionState(),setTimeout(()=>{const y=this.settingsMenu.querySelector(`.${this.player.options.classPrefix}-transcript-settings-item`);y&&y.focus()},0);return}this.settingsMenu=l.createElement("div",{className:`${this.player.options.classPrefix}-transcript-settings-menu`});const e=l.createElement("button",{className:`${this.player.options.classPrefix}-transcript-settings-item`,attributes:{type:"button","aria-label":u.t("transcript.keyboardDragMode")}}),t=f("move"),i=l.createElement("span",{textContent:u.t("transcript.keyboardDragMode")});e.appendChild(t),e.appendChild(i),e.addEventListener("click",()=>{this.toggleKeyboardDragMode(),this.hideSettingsMenu()});const s=l.createElement("button",{className:`${this.player.options.classPrefix}-transcript-settings-item`,attributes:{type:"button","aria-label":u.t("transcript.styleTranscript")}}),a=f("settings"),n=l.createElement("span",{textContent:u.t("transcript.styleTranscript")});s.appendChild(a),s.appendChild(n),s.addEventListener("click",y=>{y.preventDefault(),y.stopPropagation(),this.hideSettingsMenu(),setTimeout(()=>{this.showStyleDialog()},50)});const o=l.createElement("button",{className:`${this.player.options.classPrefix}-transcript-settings-item`,attributes:{type:"button","aria-label":u.t("transcript.resizeWindow"),"aria-pressed":"false"}}),r=f("resize"),c=l.createElement("span",{className:`${this.player.options.classPrefix}-transcript-settings-text`,textContent:u.t("transcript.resizeWindow")});o.appendChild(r),o.appendChild(c),o.addEventListener("click",y=>{y.preventDefault(),y.stopPropagation(),this.toggleResizeMode({focus:!1})?(this.hideSettingsMenu({focusButton:!1}),this.setManagedTimeout(()=>{this.transcriptWindow&&this.transcriptWindow.focus()},20)):this.hideSettingsMenu({focusButton:!0})}),this.resizeOptionButton=o,this.resizeOptionText=c,this.updateResizeOptionState();const d=l.createElement("button",{className:`${this.player.options.classPrefix}-transcript-settings-item`,attributes:{type:"button","aria-label":u.t("transcript.closeMenu")}}),h=f("close"),g=l.createElement("span",{textContent:u.t("transcript.closeMenu")});d.appendChild(h),d.appendChild(g),d.addEventListener("click",()=>{this.hideSettingsMenu()}),this.settingsMenu.appendChild(e),this.settingsMenu.appendChild(o),this.settingsMenu.appendChild(s),this.settingsMenu.appendChild(d),this.headerLeft?this.headerLeft.appendChild(this.settingsMenu):this.transcriptHeader.appendChild(this.settingsMenu),this.settingsMenuVisible=!0,this.settingsMenu.style.display="block",this.settingsButton&&this.settingsButton.setAttribute("aria-expanded","true"),this.updateResizeOptionState(),setTimeout(()=>{const y=this.settingsMenu.querySelector(`.${this.player.options.classPrefix}-transcript-settings-item`);y&&y.focus()},0)}hideSettingsMenu({focusButton:e=!0}={}){this.settingsMenu&&(this.settingsMenu.style.display="none",this.settingsMenuVisible=!1,this.settingsMenuJustOpened=!1,this.settingsButton&&(this.settingsButton.setAttribute("aria-expanded","false"),e&&this.settingsButton.focus()))}enableMoveMode(){this.hideResizeModeIndicator(),this.transcriptWindow.classList.add(`${this.player.options.classPrefix}-transcript-move-mode`);const e=l.createElement("div",{className:`${this.player.options.classPrefix}-transcript-move-tooltip`,textContent:"Drag with mouse or press D for keyboard drag mode"});this.transcriptHeader.appendChild(e),setTimeout(()=>{this.transcriptWindow.classList.remove(`${this.player.options.classPrefix}-transcript-move-mode`),e.parentNode&&e.remove()},2e3)}toggleResizeMode({focus:e=!0}={}){return this.draggableResizable?this.draggableResizable.pointerResizeMode?(this.draggableResizable.disablePointerResizeMode({focus:e}),!1):(this.draggableResizable.enablePointerResizeMode({focus:e}),!0):!1}updateResizeOptionState(){if(!this.resizeOptionButton)return;const e=!!(this.draggableResizable&&this.draggableResizable.pointerResizeMode),t=e?u.t("transcript.disableResizeWindow")||"Disable Resize Mode":u.t("transcript.resizeWindow");this.resizeOptionButton.setAttribute("aria-pressed",e?"true":"false"),this.resizeOptionButton.setAttribute("aria-label",t),this.resizeOptionButton.setAttribute("title",t),this.resizeOptionText&&(this.resizeOptionText.textContent=t)}showResizeModeIndicator(){if(!this.transcriptHeader)return;this.hideResizeModeIndicator();const e=l.createElement("div",{className:`${this.player.options.classPrefix}-transcript-resize-tooltip`,textContent:u.t("transcript.resizeModeHint")||"Resize handles enabled. Drag edges or corners to adjust. Press Esc or R to exit."});this.transcriptHeader.appendChild(e),this.resizeModeIndicator=e,this.resizeModeIndicatorTimeout=this.setManagedTimeout(()=>{this.hideResizeModeIndicator()},3e3)}hideResizeModeIndicator(){this.resizeModeIndicatorTimeout&&(this.clearManagedTimeout(this.resizeModeIndicatorTimeout),this.resizeModeIndicatorTimeout=null),this.resizeModeIndicator&&this.resizeModeIndicator.parentNode&&this.resizeModeIndicator.remove(),this.resizeModeIndicator=null}onPointerResizeModeChange(e){this.updateResizeOptionState(),e?(this.showResizeModeIndicator(),this.announceLive(u.t("transcript.resizeModeEnabled"))):(this.hideResizeModeIndicator(),this.announceLive(u.t("transcript.resizeModeDisabled")))}showStyleDialog(){if(this.styleDialog){this.styleDialog.style.display="block",this.styleDialogVisible=!0,this.styleDialogJustOpened=!0,setTimeout(()=>{this.styleDialogJustOpened=!1},350),setTimeout(()=>{const r=this.styleDialog.querySelector("select, input");r&&r.focus()},0);return}this.styleDialog=l.createElement("div",{className:`${this.player.options.classPrefix}-transcript-style-dialog`});const e=l.createElement("h4",{textContent:u.t("transcript.styleTitle"),className:`${this.player.options.classPrefix}-transcript-style-title`});this.styleDialog.appendChild(e);const t=this.createStyleSelectControl(u.t("captions.fontSize"),"fontSize",[{label:u.t("fontSizes.small"),value:"87.5%"},{label:u.t("fontSizes.normal"),value:"100%"},{label:u.t("fontSizes.large"),value:"125%"},{label:u.t("fontSizes.xlarge"),value:"150%"}]);this.styleDialog.appendChild(t);const i=this.createStyleSelectControl(u.t("captions.fontFamily"),"fontFamily",[{label:u.t("fontFamilies.sansSerif"),value:"sans-serif"},{label:u.t("fontFamilies.serif"),value:"serif"},{label:u.t("fontFamilies.monospace"),value:"monospace"}]);this.styleDialog.appendChild(i);const s=this.createStyleColorControl(u.t("captions.color"),"color");this.styleDialog.appendChild(s);const a=this.createStyleColorControl(u.t("captions.backgroundColor"),"backgroundColor");this.styleDialog.appendChild(a);const n=this.createStyleOpacityControl(u.t("captions.opacity"),"opacity");this.styleDialog.appendChild(n);const o=l.createElement("button",{className:`${this.player.options.classPrefix}-transcript-style-close`,textContent:u.t("settings.close"),attributes:{type:"button"}});o.addEventListener("click",()=>this.hideStyleDialog()),this.styleDialog.appendChild(o),this.handlers.styleDialogKeydown=r=>{r.key==="Escape"&&(r.preventDefault(),r.stopPropagation(),this.hideStyleDialog())},this.styleDialog.addEventListener("keydown",this.handlers.styleDialogKeydown),this.headerLeft?this.headerLeft.appendChild(this.styleDialog):this.transcriptHeader.appendChild(this.styleDialog),this.applyTranscriptStyles(),this.styleDialogVisible=!0,this.styleDialog.style.display="block",this.styleDialogJustOpened=!0,setTimeout(()=>{this.styleDialogJustOpened=!1},350),setTimeout(()=>{const r=this.styleDialog.querySelector("select, input");r&&r.focus()},0)}hideStyleDialog(){this.styleDialog&&(this.styleDialog.style.display="none",this.styleDialogVisible=!1,this.settingsButton&&this.settingsButton.focus())}createStyleSelectControl(e,t,i){const s=l.createElement("div",{className:`${this.player.options.classPrefix}-transcript-style-group`}),a=l.createElement("label",{textContent:e});s.appendChild(a);const n=l.createElement("select",{className:`${this.player.options.classPrefix}-transcript-style-select`});return i.forEach(o=>{const r=l.createElement("option",{textContent:o.label,attributes:{value:o.value}});this.transcriptStyle[t]===o.value&&(r.selected=!0),n.appendChild(r)}),n.addEventListener("change",o=>{this.transcriptStyle[t]=o.target.value,this.applyTranscriptStyles(),this.savePreferences()}),s.appendChild(n),s}createStyleColorControl(e,t){const i=l.createElement("div",{className:`${this.player.options.classPrefix}-transcript-style-group`}),s=l.createElement("label",{textContent:e});i.appendChild(s);const a=l.createElement("input",{attributes:{type:"color",value:this.transcriptStyle[t]},className:`${this.player.options.classPrefix}-transcript-style-color`});return a.addEventListener("input",n=>{this.transcriptStyle[t]=n.target.value,this.applyTranscriptStyles(),this.savePreferences()}),i.appendChild(a),i}createStyleOpacityControl(e,t){const i=l.createElement("div",{className:`${this.player.options.classPrefix}-transcript-style-group`}),s=l.createElement("label",{textContent:e});i.appendChild(s);const a=l.createElement("span",{textContent:Math.round(this.transcriptStyle[t]*100)+"%",className:`${this.player.options.classPrefix}-transcript-style-value`}),n=l.createElement("input",{attributes:{type:"range",min:"0",max:"1",step:"0.1",value:String(this.transcriptStyle[t])},className:`${this.player.options.classPrefix}-transcript-style-range`});n.addEventListener("input",r=>{const c=parseFloat(r.target.value);this.transcriptStyle[t]=c,a.textContent=Math.round(c*100)+"%",this.applyTranscriptStyles(),this.savePreferences()});const o=l.createElement("div",{className:`${this.player.options.classPrefix}-transcript-style-range-container`});return o.appendChild(n),o.appendChild(a),i.appendChild(s),i.appendChild(o),i}savePreferences(){this.storage.saveTranscriptPreferences(this.transcriptStyle)}applyTranscriptStyles(){if(!this.transcriptWindow)return;this.transcriptWindow.style.backgroundColor=this.transcriptStyle.backgroundColor,this.transcriptWindow.style.opacity=String(this.transcriptStyle.opacity),this.transcriptContent&&(this.transcriptContent.style.fontSize=this.transcriptStyle.fontSize,this.transcriptContent.style.fontFamily=this.transcriptStyle.fontFamily,this.transcriptContent.style.color=this.transcriptStyle.color),this.transcriptWindow.querySelectorAll(`.${this.player.options.classPrefix}-transcript-text`).forEach(i=>{i.style.fontSize=this.transcriptStyle.fontSize,i.style.fontFamily=this.transcriptStyle.fontFamily,i.style.color=this.transcriptStyle.color}),this.transcriptWindow.querySelectorAll(`.${this.player.options.classPrefix}-transcript-time`).forEach(i=>{i.style.fontFamily=this.transcriptStyle.fontFamily})}setManagedTimeout(e,t){const i=setTimeout(()=>{this.timeouts.delete(i),e()},t);return this.timeouts.add(i),i}clearManagedTimeout(e){e&&(clearTimeout(e),this.timeouts.delete(e))}destroy(){this.hideResizeModeIndicator(),this.draggableResizable&&(this.draggableResizable.pointerResizeMode&&(this.draggableResizable.disablePointerResizeMode(),this.updateResizeOptionState()),this.draggableResizable.destroy(),this.draggableResizable=null),this.transcriptWindow&&this.customKeyHandler&&(this.transcriptWindow.removeEventListener("keydown",this.customKeyHandler),this.customKeyHandler=null),this.handlers.timeupdate&&this.player.off("timeupdate",this.handlers.timeupdate),this.settingsButton&&(this.handlers.settingsClick&&this.settingsButton.removeEventListener("click",this.handlers.settingsClick),this.handlers.settingsKeydown&&this.settingsButton.removeEventListener("keydown",this.handlers.settingsKeydown)),this.styleDialog&&this.handlers.styleDialogKeydown&&this.styleDialog.removeEventListener("keydown",this.handlers.styleDialogKeydown),this.handlers.documentClick&&document.removeEventListener("click",this.handlers.documentClick),this.handlers.resize&&window.removeEventListener("resize",this.handlers.resize),this.timeouts.forEach(e=>clearTimeout(e)),this.timeouts.clear(),this.handlers=null,this.transcriptWindow&&this.transcriptWindow.parentNode&&this.transcriptWindow.parentNode.removeChild(this.transcriptWindow),this.transcriptWindow=null,this.transcriptHeader=null,this.transcriptContent=null,this.transcriptEntries=[],this.settingsMenu=null,this.styleDialog=null,this.transcriptResizeHandles=[],this.resizeOptionButton=null,this.resizeOptionText=null,this.liveRegion=null}announceLive(e){this.liveRegion&&(this.liveRegion.textContent=e||"")}};V();var ee=class{constructor(e){this.player=e,this.youtube=null,this.videoId=null,this.isReady=!1,this.iframe=null}async init(){if(this.videoId=this.extractVideoId(this.player.element.src),!this.videoId)throw new Error("Invalid YouTube URL");await this.loadYouTubeAPI(),this.createIframe(),await this.initializePlayer()}extractVideoId(e){const t=[/(?:youtube\.com\/watch\?v=|youtu\.be\/)([^&\s]+)/,/youtube\.com\/embed\/([^&\s]+)/];for(const i of t){const s=e.match(i);if(s&&s[1])return s[1]}return null}async loadYouTubeAPI(){return window.YT&&window.YT.Player?Promise.resolve():new Promise((e,t)=>{if(window.onYouTubeIframeAPIReady){const a=window.onYouTubeIframeAPIReady;window.onYouTubeIframeAPIReady=()=>{a(),e()};return}const i=document.createElement("script");i.src="https://www.youtube.com/iframe_api",window.onYouTubeIframeAPIReady=()=>{e()},i.onerror=()=>t(new Error("Failed to load YouTube API"));const s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(i,s)})}createIframe(){this.player.element.style.display="none",this.iframe=document.createElement("div"),this.iframe.id=`youtube-player-${Math.random().toString(36).substr(2,9)}`,this.iframe.style.width="100%",this.iframe.style.height="100%",this.player.element.parentNode.insertBefore(this.iframe,this.player.element)}async initializePlayer(){return new Promise(e=>{this.youtube=new window.YT.Player(this.iframe.id,{videoId:this.videoId,width:"100%",height:"100%",playerVars:{controls:0,disablekb:1,fs:0,modestbranding:1,rel:0,showinfo:0,iv_load_policy:3,autoplay:this.player.options.autoplay?1:0,mute:this.player.options.muted?1:0,start:this.player.options.startTime||0},events:{onReady:t=>{this.isReady=!0,this.attachEvents(),e()},onStateChange:t=>this.handleStateChange(t),onError:t=>this.handleError(t)}})})}attachEvents(){this.timeUpdateInterval=setInterval(()=>{if(this.isReady&&this.youtube){const e=this.youtube.getCurrentTime(),t=this.youtube.getDuration();this.player.state.currentTime=e,this.player.state.duration=t,this.player.emit("timeupdate",e)}},250),this.youtube.getDuration&&(this.player.state.duration=this.youtube.getDuration(),this.player.emit("loadedmetadata"))}handleStateChange(e){const t=window.YT.PlayerState;switch(e.data){case t.PLAYING:this.player.state.playing=!0,this.player.state.paused=!1,this.player.state.ended=!1,this.player.state.buffering=!1,this.player.emit("play"),this.player.emit("playing"),this.player.options.onPlay&&this.player.options.onPlay.call(this.player);break;case t.PAUSED:this.player.state.playing=!1,this.player.state.paused=!0,this.player.emit("pause"),this.player.options.onPause&&this.player.options.onPause.call(this.player);break;case t.ENDED:this.player.state.playing=!1,this.player.state.paused=!0,this.player.state.ended=!0,this.player.emit("ended"),this.player.options.onEnded&&this.player.options.onEnded.call(this.player),this.player.options.loop&&(this.youtube.seekTo(0),this.youtube.playVideo());break;case t.BUFFERING:this.player.state.buffering=!0,this.player.emit("waiting");break;case t.CUED:this.player.emit("loadedmetadata");break}}handleError(e){const t={2:"Invalid video ID",5:"HTML5 player error",100:"Video not found",101:"Video not allowed to be played in embedded players",150:"Video not allowed to be played in embedded players"},i=new Error(t[e.data]||"YouTube player error");this.player.handleError(i)}play(){this.isReady&&this.youtube&&this.youtube.playVideo()}pause(){this.isReady&&this.youtube&&this.youtube.pauseVideo()}seek(e){this.isReady&&this.youtube&&this.youtube.seekTo(e,!0)}setVolume(e){this.isReady&&this.youtube&&(this.youtube.setVolume(e*100),this.player.state.volume=e)}setMuted(e){this.isReady&&this.youtube&&(e?this.youtube.mute():this.youtube.unMute(),this.player.state.muted=e)}setPlaybackSpeed(e){this.isReady&&this.youtube&&(this.youtube.setPlaybackRate(e),this.player.state.playbackSpeed=e)}destroy(){this.timeUpdateInterval&&clearInterval(this.timeUpdateInterval),this.youtube&&this.youtube.destroy&&this.youtube.destroy(),this.iframe&&this.iframe.parentNode&&this.iframe.parentNode.removeChild(this.iframe),this.player.element&&(this.player.element.style.display="")}},te=class{constructor(e){this.player=e,this.vimeo=null,this.videoId=null,this.isReady=!1,this.iframe=null}async init(){if(this.videoId=this.extractVideoId(this.player.element.src),!this.videoId)throw new Error("Invalid Vimeo URL");await this.loadVimeoAPI(),this.createIframe(),await this.initializePlayer()}extractVideoId(e){const t=[/vimeo\.com\/(\d+)/,/vimeo\.com\/video\/(\d+)/,/player\.vimeo\.com\/video\/(\d+)/];for(const i of t){const s=e.match(i);if(s&&s[1])return s[1]}return null}async loadVimeoAPI(){return window.Vimeo&&window.Vimeo.Player?Promise.resolve():new Promise((e,t)=>{const i=document.createElement("script");i.src="https://player.vimeo.com/api/player.js",i.onload=()=>e(),i.onerror=()=>t(new Error("Failed to load Vimeo API")),document.head.appendChild(i)})}createIframe(){this.player.element.style.display="none",this.iframe=document.createElement("div"),this.iframe.id=`vimeo-player-${Math.random().toString(36).substr(2,9)}`,this.iframe.style.width="100%",this.iframe.style.height="100%",this.player.element.parentNode.insertBefore(this.iframe,this.player.element)}async initializePlayer(){const e={id:this.videoId,width:"100%",height:"100%",controls:!1,autoplay:this.player.options.autoplay,muted:this.player.options.muted,loop:this.player.options.loop,keyboard:!1};this.player.options.startTime>0&&(e.startTime=this.player.options.startTime),this.vimeo=new window.Vimeo.Player(this.iframe.id,e),await this.vimeo.ready(),this.isReady=!0,this.attachEvents();try{const t=await this.vimeo.getDuration();this.player.state.duration=t,this.player.emit("loadedmetadata")}catch(t){this.player.log("Error getting duration:",t,"warn")}}attachEvents(){this.vimeo.on("play",()=>{this.player.state.playing=!0,this.player.state.paused=!1,this.player.state.ended=!1,this.player.emit("play"),this.player.options.onPlay&&this.player.options.onPlay.call(this.player)}),this.vimeo.on("pause",()=>{this.player.state.playing=!1,this.player.state.paused=!0,this.player.emit("pause"),this.player.options.onPause&&this.player.options.onPause.call(this.player)}),this.vimeo.on("ended",()=>{this.player.state.playing=!1,this.player.state.paused=!0,this.player.state.ended=!0,this.player.emit("ended"),this.player.options.onEnded&&this.player.options.onEnded.call(this.player)}),this.vimeo.on("timeupdate",e=>{this.player.state.currentTime=e.seconds,this.player.state.duration=e.duration,this.player.emit("timeupdate",e.seconds),this.player.options.onTimeUpdate&&this.player.options.onTimeUpdate.call(this.player,e.seconds)}),this.vimeo.on("volumechange",e=>{this.player.state.volume=e.volume,this.player.emit("volumechange",e.volume)}),this.vimeo.on("bufferstart",()=>{this.player.state.buffering=!0,this.player.emit("waiting")}),this.vimeo.on("bufferend",()=>{this.player.state.buffering=!1,this.player.emit("canplay")}),this.vimeo.on("seeking",()=>{this.player.state.seeking=!0,this.player.emit("seeking")}),this.vimeo.on("seeked",()=>{this.player.state.seeking=!1,this.player.emit("seeked")}),this.vimeo.on("playbackratechange",e=>{this.player.state.playbackSpeed=e.playbackRate,this.player.emit("ratechange",e.playbackRate)}),this.vimeo.on("error",e=>{this.player.handleError(new Error(`Vimeo error: ${e.message}`))})}play(){this.isReady&&this.vimeo&&this.vimeo.play().catch(e=>{this.player.log("Play error:",e,"warn")})}pause(){this.isReady&&this.vimeo&&this.vimeo.pause().catch(e=>{this.player.log("Pause error:",e,"warn")})}seek(e){this.isReady&&this.vimeo&&this.vimeo.setCurrentTime(e).catch(t=>{this.player.log("Seek error:",t,"warn")})}setVolume(e){this.isReady&&this.vimeo&&(this.vimeo.setVolume(e).catch(t=>{this.player.log("Volume error:",t,"warn")}),this.player.state.volume=e)}setMuted(e){this.isReady&&this.vimeo&&(e?this.vimeo.setVolume(0):this.vimeo.setVolume(this.player.state.volume),this.player.state.muted=e)}setPlaybackSpeed(e){this.isReady&&this.vimeo&&(this.vimeo.setPlaybackRate(e).catch(t=>{this.player.log("Playback rate error:",t,"warn")}),this.player.state.playbackSpeed=e)}destroy(){this.vimeo&&this.vimeo.destroy&&this.vimeo.destroy(),this.iframe&&this.iframe.parentNode&&this.iframe.parentNode.removeChild(this.iframe),this.player.element&&(this.player.element.style.display="")}},ie=class{constructor(e){this.player=e,this.media=e.element,this.hls=null}async init(){this.canPlayNatively()?(this.player.log("Using native HLS support"),await this.initNative()):(this.player.log("Using hls.js for HLS support"),await this.initHlsJs())}canPlayNatively(){return document.createElement("video").canPlayType("application/vnd.apple.mpegurl")!==""}async initNative(){const e=(await Promise.resolve().then(()=>(V(),H))).HTML5Renderer,t=new e(this.player);await t.init(),Object.getOwnPropertyNames(Object.getPrototypeOf(t)).forEach(i=>{i!=="constructor"&&typeof t[i]=="function"&&(this[i]=t[i].bind(t))})}async initHlsJs(){if(this.media.controls=!1,this.media.removeAttribute("controls"),window.Hls||await this.loadHlsJs(),!window.Hls.isSupported())throw new Error("HLS is not supported in this browser");this.hls=new window.Hls({debug:this.player.options.debug,enableWorker:!0,lowLatencyMode:!1,backBufferLength:90,maxBufferLength:30,maxMaxBufferLength:600,maxBufferSize:60*1e3*1e3,maxBufferHole:.5,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:4,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3}),this.hls.attachMedia(this.media);let e;const t=this.player.element.querySelector("source");if(t?e=t.getAttribute("src"):e=this.player.element.getAttribute("src")||this.player.element.src,this.player.log(`Loading HLS source: ${e}`,"log"),!e)throw new Error("No HLS source found");this.hls.loadSource(e),this.attachHlsEvents(),this.attachMediaEvents()}async loadHlsJs(){return new Promise((e,t)=>{const i=document.createElement("script");i.src="https://cdn.jsdelivr.net/npm/hls.js@latest",i.onload=()=>e(),i.onerror=()=>t(new Error("Failed to load hls.js")),document.head.appendChild(i)})}attachHlsEvents(){this.hls.on(window.Hls.Events.MANIFEST_PARSED,(e,t)=>{this.player.log("HLS manifest loaded, found "+t.levels.length+" quality levels"),this.player.emit("hlsmanifestparsed",t)}),this.hls.on(window.Hls.Events.LEVEL_SWITCHED,(e,t)=>{this.player.log("HLS level switched to "+t.level),this.player.emit("hlslevelswitched",t)}),this.hls.on(window.Hls.Events.ERROR,(e,t)=>{this.handleHlsError(t)}),this.hls.on(window.Hls.Events.FRAG_BUFFERED,()=>{this.player.state.buffering=!1})}attachMediaEvents(){this.media.addEventListener("loadedmetadata",()=>{this.player.state.duration=this.media.duration,this.player.emit("loadedmetadata")}),this.media.addEventListener("play",()=>{this.player.state.playing=!0,this.player.state.paused=!1,this.player.state.ended=!1,this.player.emit("play"),this.player.options.onPlay&&this.player.options.onPlay.call(this.player)}),this.media.addEventListener("pause",()=>{this.player.state.playing=!1,this.player.state.paused=!0,this.player.emit("pause"),this.player.options.onPause&&this.player.options.onPause.call(this.player)}),this.media.addEventListener("ended",()=>{this.player.state.playing=!1,this.player.state.paused=!0,this.player.state.ended=!0,this.player.emit("ended"),this.player.options.onEnded&&this.player.options.onEnded.call(this.player),this.player.options.loop&&(this.player.seek(0),this.player.play())}),this.media.addEventListener("timeupdate",()=>{this.player.state.currentTime=this.media.currentTime,this.player.emit("timeupdate",this.media.currentTime),this.player.options.onTimeUpdate&&this.player.options.onTimeUpdate.call(this.player,this.media.currentTime)}),this.media.addEventListener("volumechange",()=>{this.player.state.volume=this.media.volume,this.player.state.muted=this.media.muted,this.player.emit("volumechange",this.media.volume)}),this.media.addEventListener("waiting",()=>{this.player.state.buffering=!0,this.player.emit("waiting")}),this.media.addEventListener("canplay",()=>{this.player.state.buffering=!1,this.player.emit("canplay")}),this.media.addEventListener("error",()=>{this.player.handleError(this.media.error)})}handleHlsError(e){if(this.player.log(`HLS Error - Type: ${e.type}, Details: ${e.details}, Fatal: ${e.fatal}`,"warn"),e.response&&this.player.log(`Response code: ${e.response.code}, URL: ${e.response.url}`,"warn"),e.fatal)switch(e.type){case window.Hls.ErrorTypes.NETWORK_ERROR:this.player.log("Fatal network error, trying to recover...","error"),this.player.log(`Network error details: ${e.details}`,"error"),setTimeout(()=>{this.hls.startLoad()},1e3);break;case window.Hls.ErrorTypes.MEDIA_ERROR:this.player.log("Fatal media error, trying to recover...","error"),this.hls.recoverMediaError();break;default:this.player.log("Fatal error, cannot recover","error"),this.player.handleError(new Error(`HLS Error: ${e.type} - ${e.details}`)),this.hls.destroy();break}else this.player.log("Non-fatal HLS error: "+e.details,"warn")}play(){const e=this.media.play();e!==void 0&&e.catch(t=>{this.player.log("Play failed:",t,"warn")})}pause(){this.media.pause()}seek(e){this.media.currentTime=e}setVolume(e){this.media.volume=e}setMuted(e){this.media.muted=e}setPlaybackSpeed(e){this.media.playbackRate=e}switchQuality(e){this.hls&&(this.hls.currentLevel=e)}getQualities(){return this.hls&&this.hls.levels?this.hls.levels.map((e,t)=>({index:t,height:e.height,width:e.width,bitrate:e.bitrate,name:`${e.height}p`})):[]}destroy(){this.hls&&(this.hls.destroy(),this.hls=null)}},N=class W extends _{constructor(t,i={}){if(super(),this.element=typeof t=="string"?document.querySelector(t):t,!this.element)throw new Error("VidPly: Element not found");if(this.element.tagName!=="VIDEO"&&this.element.tagName!=="AUDIO"){const a=i.mediaType||"video",n=document.createElement(a);Array.from(this.element.attributes).forEach(r=>{r.name!=="id"&&r.name!=="class"&&!r.name.startsWith("data-")&&n.setAttribute(r.name,r.value)}),this.element.querySelectorAll("track").forEach(r=>{n.appendChild(r.cloneNode(!0))}),this.element.innerHTML="",this.element.appendChild(n),this.element=n}this.options={width:null,height:null,poster:null,responsive:!0,fillContainer:!1,autoplay:!1,loop:!1,muted:!1,volume:.8,playbackSpeed:1,preload:"metadata",startTime:0,playsInline:!0,controls:!0,hideControlsDelay:3e3,playPauseButton:!0,progressBar:!0,currentTime:!0,duration:!0,volumeControl:!0,muteButton:!0,chaptersButton:!0,qualityButton:!0,captionStyleButton:!0,speedButton:!0,captionsButton:!0,transcriptButton:!0,fullscreenButton:!0,pipButton:!1,seekInterval:10,seekIntervalLarge:30,captions:!0,captionsDefault:!1,captionsFontSize:"100%",captionsFontFamily:"sans-serif",captionsColor:"#FFFFFF",captionsBackgroundColor:"#000000",captionsOpacity:.8,audioDescription:!0,audioDescriptionSrc:null,audioDescriptionButton:!0,signLanguage:!0,signLanguageSrc:null,signLanguageButton:!0,signLanguagePosition:"bottom-right",transcript:!1,transcriptPosition:"external",transcriptContainer:null,keyboard:!0,keyboardShortcuts:{"play-pause":[" ","p","k"],"volume-up":["ArrowUp"],"volume-down":["ArrowDown"],"seek-forward":["ArrowRight"],"seek-backward":["ArrowLeft"],mute:["m"],fullscreen:["f"],captions:["c"],"caption-style-menu":["a"],"speed-up":[">"],"speed-down":["<"],"speed-menu":["s"],"quality-menu":["q"],"chapters-menu":["j"],"transcript-toggle":["t"]},ariaLabels:{},screenReaderAnnouncements:!0,highContrast:!1,focusHighlight:!0,metadataAlerts:{},metadataHashtags:{},language:"en",languages:["en"],debug:!1,classPrefix:"vidply",iconType:"svg",pauseOthersOnPlay:!0,onReady:null,onPlay:null,onPause:null,onEnded:null,onTimeUpdate:null,onVolumeChange:null,onError:null,...i},this.options.metadataAlerts=this.options.metadataAlerts||{},this.options.metadataHashtags=this.options.metadataHashtags||{},this.storage=new A("vidply");const s=this.storage.getPlayerPreferences();s&&(s.volume!==void 0&&(this.options.volume=s.volume),s.playbackSpeed!==void 0&&(this.options.playbackSpeed=s.playbackSpeed),s.muted!==void 0&&(this.options.muted=s.muted)),this.state={ready:!1,playing:!1,paused:!0,ended:!1,buffering:!1,seeking:!1,muted:this.options.muted,volume:this.options.volume,currentTime:0,duration:0,playbackSpeed:this.options.playbackSpeed,fullscreen:!1,pip:!1,captionsEnabled:this.options.captionsDefault,currentCaption:null,controlsVisible:!0,audioDescriptionEnabled:!1,signLanguageEnabled:!1},this.originalSrc=null,this.audioDescriptionSrc=this.options.audioDescriptionSrc,this.signLanguageSrc=this.options.signLanguageSrc,this.signLanguageVideo=null,this.audioDescriptionSourceElement=null,this.originalAudioDescriptionSource=null,this.audioDescriptionCaptionTracks=[],this._audioDescriptionDesiredState=!1,this._textTracksCache=null,this._textTracksDirty=!0,this._sourceElementsCache=null,this._sourceElementsDirty=!0,this._trackElementsCache=null,this._trackElementsDirty=!0,this.timeouts=new Set,this.container=null,this.renderer=null,this.controlBar=null,this.captionManager=null,this.keyboardManager=null,this.settingsDialog=null,this.metadataCueChangeHandler=null,this.metadataAlertHandlers=new Map,this.init()}async init(){var t;try{if(this.log("Initializing VidPly player"),!this.options.language||this.options.language==="en"){const s=this.detectHtmlLanguage();s&&(this.options.language=s,this.log(`Auto-detected language from HTML: ${s}`))}u.setLanguage(this.options.language),this.createContainer(),this.element.src||((t=this.element.querySelector("source"))==null?void 0:t.src)?await this.initializeRenderer():this.log("No initial source - waiting for playlist or manual load"),this.options.controls&&(this.controlBar=new J(this),this.videoWrapper.appendChild(this.controlBar.element)),this.options.captions&&(this.captionManager=new F(this)),(this.options.transcript||this.options.transcriptButton)&&(this.transcriptManager=new B(this)),this.setupMetadataHandling(),this.options.keyboard&&(this.keyboardManager=new Z(this)),this.setupResponsiveHandlers(),this.options.startTime>0&&this.seek(this.options.startTime),this.options.muted&&this.mute(),this.options.volume!==.8&&this.setVolume(this.options.volume),this.state.ready=!0,this.emit("ready"),this.options.onReady&&this.options.onReady.call(this),this.options.autoplay&&this.play(),this.log("Player initialized successfully")}catch(i){this.handleError(i)}}detectHtmlLanguage(){const t=document.documentElement.lang||document.documentElement.getAttribute("lang");if(!t)return null;const i=t.toLowerCase().split("-")[0];return["en","de","es","fr","ja"].includes(i)?i:(this.log(`Language "${t}" not available, using English as fallback`),"en")}createContainer(){this.container=l.createElement("div",{className:`${this.options.classPrefix}-player`,attributes:{role:"region","aria-label":u.t("player.label"),tabindex:"0"}});const t=this.element.tagName.toLowerCase();this.container.classList.add(`${this.options.classPrefix}-${t}`),this.options.responsive&&this.container.classList.add(`${this.options.classPrefix}-responsive`),this.videoWrapper=l.createElement("div",{className:`${this.options.classPrefix}-video-wrapper`}),this.element.parentNode.insertBefore(this.container,this.element),this.container.appendChild(this.videoWrapper),this.videoWrapper.appendChild(this.element),this.element.controls=!1,this.element.removeAttribute("controls"),this.element.setAttribute("tabindex","-1"),this.element.style.width="100%",this.element.style.height="100%",this.element.tagName==="VIDEO"&&this.options.playsInline&&(this.element.setAttribute("playsinline",""),this.element.playsInline=!0),this.options.width&&(this.container.style.width=typeof this.options.width=="number"?`${this.options.width}px`:this.options.width),this.options.height&&(this.container.style.height=typeof this.options.height=="number"?`${this.options.height}px`:this.options.height),this.options.poster&&this.element.tagName==="VIDEO"&&(this.element.poster=this.options.poster),this.element.tagName==="VIDEO"&&this.createPlayButtonOverlay(),this.element.vidply=this,W.instances.push(this),this.element.style.cursor="pointer",this.element.addEventListener("click",i=>{i.target===this.element&&this.toggle()}),this.on("play",()=>{this.hidePosterOverlay()}),this.on("timeupdate",()=>{this.state.currentTime>0&&this.hidePosterOverlay()})}createPlayButtonOverlay(){this.playButtonOverlay=G(),this.playButtonOverlay.addEventListener("click",()=>{this.toggle()}),this.videoWrapper.appendChild(this.playButtonOverlay),this.on("play",()=>{this.playButtonOverlay.style.opacity="0",this.playButtonOverlay.style.pointerEvents="none"}),this.on("pause",()=>{this.playButtonOverlay.style.opacity="1",this.playButtonOverlay.style.pointerEvents="auto"}),this.on("ended",()=>{this.playButtonOverlay.style.opacity="1",this.playButtonOverlay.style.pointerEvents="auto"})}async initializeRenderer(){var t;const i=this.element.src||((t=this.element.querySelector("source"))==null?void 0:t.src);if(!i)throw new Error("No media source found");const s=this.sourceElements;for(const o of s){const r=o.getAttribute("data-desc-src"),c=o.getAttribute("data-orig-src");if(r||c){if(this.audioDescriptionSourceElement||(this.audioDescriptionSourceElement=o),c)this.originalAudioDescriptionSource||(this.originalAudioDescriptionSource=c),this.originalSrc||(this.originalSrc=c);else{const d=o.getAttribute("src");!this.originalAudioDescriptionSource&&d&&(this.originalAudioDescriptionSource=d),!this.originalSrc&&d&&(this.originalSrc=d)}r&&!this.audioDescriptionSrc&&(this.audioDescriptionSrc=r)}}this.trackElements.forEach(o=>{const r=o.getAttribute("kind"),c=o.getAttribute("data-desc-src");(r==="captions"||r==="subtitles"||r==="chapters")&&c&&(this.audioDescriptionCaptionTracks.push({trackElement:o,originalSrc:o.getAttribute("src"),describedSrc:c,originalTrackSrc:o.getAttribute("data-orig-src")||o.getAttribute("src"),explicit:!0}),this.log(`Found explicit described ${r} track: ${o.getAttribute("src")} -> ${c}`))}),this.originalSrc||(this.originalSrc=i);let n;i.includes("youtube.com")||i.includes("youtu.be")?n=ee:i.includes("vimeo.com")?n=te:i.includes(".m3u8")?n=ie:n=z,this.log(`Using ${n.name} renderer`),this.renderer=new n(this),await this.renderer.init(),this.invalidateTrackCache()}get textTracks(){return(!this._textTracksCache||this._textTracksDirty)&&(this._textTracksCache=Array.from(this.element.textTracks||[]),this._textTracksDirty=!1),this._textTracksCache}get sourceElements(){return(!this._sourceElementsCache||this._sourceElementsDirty)&&(this._sourceElementsCache=Array.from(this.element.querySelectorAll("source")),this._sourceElementsDirty=!1),this._sourceElementsCache}get trackElements(){return(!this._trackElementsCache||this._trackElementsDirty)&&(this._trackElementsCache=Array.from(this.element.querySelectorAll("track")),this._trackElementsDirty=!1),this._trackElementsCache}invalidateTrackCache(){this._textTracksDirty=!0,this._trackElementsDirty=!0,this._sourceElementsDirty=!0}findTextTrack(t,i=null){const s=this.textTracks;return i?s.find(a=>a.kind===t&&a.language===i):s.find(a=>a.kind===t)}findSourceElement(t,i=null){const s=this.sourceElements;return i?s.find(a=>a.getAttribute(t)===i):s.find(a=>a.hasAttribute(t))}findTrackElement(t){return this.trackElements.find(i=>i.track===t)}showPosterOverlay(){if(!this.videoWrapper||this.element.tagName!=="VIDEO")return;const t=this.element.getAttribute("poster")||this.element.poster||this.options.poster;t&&(this.videoWrapper.style.setProperty("--vidply-poster-image",`url("${t}")`),this.videoWrapper.classList.add("vidply-forced-poster"))}hidePosterOverlay(){this.videoWrapper&&(this.videoWrapper.classList.remove("vidply-forced-poster"),this.videoWrapper.style.removeProperty("--vidply-poster-image"))}setManagedTimeout(t,i){const s=setTimeout(()=>{this.timeouts.delete(s),t()},i);return this.timeouts.add(s),s}clearManagedTimeout(t){t&&(clearTimeout(t),this.timeouts.delete(t))}async load(t){try{this.log("Loading new media:",t.src),this.renderer&&this.pause(),this.trackElements.forEach(a=>a.remove()),this.invalidateTrackCache(),this.element.src=t.src,t.type&&(this.element.type=t.type),t.poster&&this.element.tagName==="VIDEO"&&(this.element.poster=t.poster),t.tracks&&t.tracks.length>0&&(t.tracks.forEach(a=>{const n=document.createElement("track");n.src=a.src,n.kind=a.kind||"captions",n.srclang=a.srclang||"en",n.label=a.label||a.srclang,a.default&&(n.default=!0),this.element.appendChild(n)}),this.invalidateTrackCache());const s=this.shouldChangeRenderer(t.src);if(s&&this.renderer&&(this.renderer.destroy(),this.renderer=null),!this.renderer||s?await this.initializeRenderer():(this.renderer.media=this.element,this.element.load()),this.captionManager&&(this.captionManager.destroy(),this.captionManager=new F(this)),this.transcriptManager){const a=this.transcriptManager.isVisible;this.transcriptManager.destroy(),this.transcriptManager=new B(this),a&&this.transcriptManager.showTranscript()}this.controlBar&&this.updateControlBar(),this.emit("sourcechange",t),this.log("Media loaded successfully")}catch(i){this.handleError(i)}}updateControlBar(){if(!this.controlBar)return;const t=this.controlBar;t.element.innerHTML="",t.createControls(),t.attachEvents(),t.setupAutoHide()}shouldChangeRenderer(t){if(!this.renderer)return!0;const i=t.includes("youtube.com")||t.includes("youtu.be"),s=t.includes("vimeo.com"),a=t.includes(".m3u8"),n=this.renderer.constructor.name;return!!(i&&n!=="YouTubeRenderer"||s&&n!=="VimeoRenderer"||a&&n!=="HLSRenderer"||!i&&!s&&!a&&n!=="HTML5Renderer")}play(){this.renderer&&this.renderer.play()}pause(){this.renderer&&this.renderer.pause()}stop(){this.pause(),this.seek(0)}toggle(){this.state.playing?this.pause():this.play()}seek(t){this.renderer&&this.renderer.seek(t)}seekForward(t=this.options.seekInterval){this.seek(Math.min(this.state.currentTime+t,this.state.duration))}seekBackward(t=this.options.seekInterval){this.seek(Math.max(this.state.currentTime-t,0))}setVolume(t){const i=Math.max(0,Math.min(1,t));this.renderer&&this.renderer.setVolume(i),this.state.volume=i,i>0&&this.state.muted&&(this.state.muted=!1),this.savePlayerPreferences()}getVolume(){return this.state.volume}mute(){this.renderer&&this.renderer.setMuted(!0),this.state.muted=!0,this.savePlayerPreferences(),this.emit("volumechange")}unmute(){this.renderer&&this.renderer.setMuted(!1),this.state.muted=!1,this.savePlayerPreferences(),this.emit("volumechange")}toggleMute(){this.state.muted?this.unmute():this.mute()}setPlaybackSpeed(t){const i=Math.max(.25,Math.min(2,t));this.renderer&&this.renderer.setPlaybackSpeed(i),this.state.playbackSpeed=i,this.savePlayerPreferences(),this.emit("playbackspeedchange",i)}getPlaybackSpeed(){return this.state.playbackSpeed}savePlayerPreferences(){this.storage.savePlayerPreferences({volume:this.state.volume,muted:this.state.muted,playbackSpeed:this.state.playbackSpeed})}enterFullscreen(){const t=this.container;t.requestFullscreen?t.requestFullscreen():t.webkitRequestFullscreen?t.webkitRequestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.msRequestFullscreen&&t.msRequestFullscreen(),this.state.fullscreen=!0,this.container.classList.add(`${this.options.classPrefix}-fullscreen`),this.emit("fullscreenchange",!0)}exitFullscreen(){document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen(),this.state.fullscreen=!1,this.container.classList.remove(`${this.options.classPrefix}-fullscreen`),this.emit("fullscreenchange",!1)}toggleFullscreen(){this.state.fullscreen?this.exitFullscreen():this.enterFullscreen()}enterPiP(){this.element.requestPictureInPicture&&(this.element.requestPictureInPicture(),this.state.pip=!0,this.emit("pipchange",!0))}exitPiP(){document.pictureInPictureElement&&(document.exitPictureInPicture(),this.state.pip=!1,this.emit("pipchange",!1))}togglePiP(){this.state.pip?this.exitPiP():this.enterPiP()}enableCaptions(){this.captionManager&&(this.captionManager.enable(),this.state.captionsEnabled=!0)}disableCaptions(){this.captionManager&&(this.captionManager.disable(),this.state.captionsEnabled=!1)}toggleCaptions(){this.state.captionsEnabled?this.disableCaptions():this.enableCaptions()}async validateTrackExists(t){try{return(await fetch(t,{method:"HEAD",cache:"no-cache"})).ok}catch{return!1}}async enableAudioDescription(){const t=this.sourceElements.some(r=>r.getAttribute("data-desc-src")),i=this.audioDescriptionCaptionTracks.length>0;if(!this.audioDescriptionSrc&&!t&&!i){console.warn("VidPly: No audio description source, source elements, or tracks provided");return}const s=this.state.currentTime,a=this.state.playing,n=!a&&s===0;n&&this.showPosterOverlay();let o=[];if(this.audioDescriptionSourceElement){const r=this.element.currentSrc||this.element.src,c=this.sourceElements;let d=null,h=this.audioDescriptionSrc;for(const m of c){const p=m.getAttribute("src"),b=m.getAttribute("data-desc-src"),v=p?p.split("/").pop():"",E=r?r.split("/").pop():"";if(r&&(r===p||r.includes(p)||r.includes(v)||v&&E===v)){d=m,b?h=b:p&&(h=this.audioDescriptionSrc||h);break}}if(!d){d=this.audioDescriptionSourceElement;const m=d.getAttribute("data-desc-src");m&&(h=m)}if(this.audioDescriptionCaptionTracks.length>0){const m=this.audioDescriptionCaptionTracks.map(async v=>{if(v.trackElement&&v.describedSrc)if(v.explicit===!0)try{const E=await this.validateTrackExists(v.describedSrc);return{trackInfo:v,exists:E}}catch{return{trackInfo:v,exists:!1}}else return{trackInfo:v,exists:!1};return{trackInfo:v,exists:!1}}),p=await Promise.all(m),b=p.filter(v=>v.exists);if(b.length>0){const v=new Map;b.forEach(({trackInfo:x})=>{const C=x.trackElement.track;C?v.set(x,{wasShowing:C.mode==="showing",wasHidden:C.mode==="hidden"}):v.set(x,{wasShowing:!1,wasHidden:!1})});const E=b.map(({trackInfo:x})=>{const C=x.trackElement.getAttribute("src"),w=x.trackElement.parentNode,S=x.trackElement.nextSibling,M={};return Array.from(x.trackElement.attributes).forEach(k=>{M[k.name]=k.value}),{trackInfo:x,oldSrc:C,parent:w,nextSibling:S,attributes:M}});E.forEach(({trackInfo:x})=>{x.trackElement.remove()}),this.element.load(),setTimeout(()=>{E.forEach(({trackInfo:C,oldSrc:w,parent:S,nextSibling:M,attributes:k})=>{o.push(C);const L=document.createElement("track");L.setAttribute("src",C.describedSrc),Object.keys(k).forEach(D=>{D!=="src"&&D!=="data-desc-src"&&L.setAttribute(D,k[D])}),M&&M.parentNode?S.insertBefore(L,M):S.appendChild(L),C.trackElement=L}),this.element.load(),this.invalidateTrackCache();const x=()=>{this.setManagedTimeout(()=>{o.forEach(C=>{const S=C.trackElement.track;if(S){const M=v.get(C)||{wasShowing:!1,wasHidden:!1};S.mode="hidden";const k=()=>{M.wasShowing||M.wasHidden?S.mode="hidden":S.mode="disabled"};S.readyState>=2?k():(S.addEventListener("load",k,{once:!0}),S.addEventListener("error",k,{once:!0}))}})},300)};this.element.readyState>=1?setTimeout(x,200):(this.element.addEventListener("loadedmetadata",x,{once:!0}),setTimeout(x,2e3))},100),p.length-b.length}}const g=this.sourceElements,y=[];if(g.forEach(m=>{const p=m.getAttribute("data-desc-src"),b=m.getAttribute("src");if(p){const v=m.getAttribute("type");let E=m.getAttribute("data-orig-src");E||(E=b),y.push({src:p,type:v,origSrc:E,descSrc:p})}else{const v=m.getAttribute("type"),E=m.getAttribute("src");y.push({src:E,type:v,origSrc:null,descSrc:null})}}),g.forEach(m=>{m.remove()}),y.forEach(m=>{const p=document.createElement("source");p.setAttribute("src",m.src),m.type&&p.setAttribute("type",m.type),m.origSrc&&p.setAttribute("data-orig-src",m.origSrc),m.descSrc&&p.setAttribute("data-desc-src",m.descSrc);const b=this.element.querySelector("track");b?this.element.insertBefore(p,b):this.element.appendChild(p)}),this._sourceElementsDirty=!0,this._sourceElementsCache=null,this.element.load(),await new Promise(m=>{const p=()=>{this.element.removeEventListener("loadedmetadata",p),m()};this.element.addEventListener("loadedmetadata",p)}),await new Promise(m=>setTimeout(m,300)),s>0&&this.seek(s),a&&this.play(),n||this.hidePosterOverlay(),!this._audioDescriptionDesiredState)return;this.state.audioDescriptionEnabled=!0,this.emit("audiodescriptionenabled")}else{if(this.audioDescriptionCaptionTracks.length>0){const d=this.audioDescriptionCaptionTracks.map(async y=>{if(y.trackElement&&y.describedSrc)if(y.explicit===!0)try{const m=await this.validateTrackExists(y.describedSrc);return{trackInfo:y,exists:m}}catch{return{trackInfo:y,exists:!1}}else return{trackInfo:y,exists:!1};return{trackInfo:y,exists:!1}}),g=(await Promise.all(d)).filter(y=>y.exists);if(g.length>0){const y=new Map;g.forEach(({trackInfo:p})=>{const b=p.trackElement.track;b?y.set(p,{wasShowing:b.mode==="showing",wasHidden:b.mode==="hidden"}):y.set(p,{wasShowing:!1,wasHidden:!1})});const m=g.map(({trackInfo:p})=>{const b=p.trackElement.getAttribute("src"),v=p.trackElement.parentNode,E=p.trackElement.nextSibling,x={};return Array.from(p.trackElement.attributes).forEach(C=>{x[C.name]=C.value}),{trackInfo:p,oldSrc:b,parent:v,nextSibling:E,attributes:x}});m.forEach(({trackInfo:p})=>{p.trackElement.remove()}),this.element.load(),setTimeout(()=>{m.forEach(({trackInfo:b,oldSrc:v,parent:E,nextSibling:x,attributes:C})=>{o.push(b);const w=document.createElement("track");w.setAttribute("src",b.describedSrc),Object.keys(C).forEach(S=>{S!=="src"&&S!=="data-desc-src"&&w.setAttribute(S,C[S])}),x&&x.parentNode?E.insertBefore(w,x):E.appendChild(w),b.trackElement=w}),this.element.load();const p=()=>{setTimeout(()=>{o.forEach(b=>{const E=b.trackElement.track;if(E){const x=y.get(b)||{wasShowing:!1,wasHidden:!1};E.mode="hidden";const C=()=>{x.wasShowing||x.wasHidden?E.mode="hidden":E.mode="disabled"};E.readyState>=2?C():(E.addEventListener("load",C,{once:!0}),E.addEventListener("error",C,{once:!0}))}})},300)};this.element.readyState>=1?setTimeout(p,200):(this.element.addEventListener("loadedmetadata",p,{once:!0}),setTimeout(p,2e3))},100)}}const r=this.sourceElements;if(r.some(d=>d.getAttribute("data-desc-src"))){const d=[];r.forEach(h=>{const g=h.getAttribute("data-desc-src"),y=h.getAttribute("src");if(g){const m=h.getAttribute("type");let p=h.getAttribute("data-orig-src");p||(p=y),d.push({src:g,type:m,origSrc:p,descSrc:g})}else{const m=h.getAttribute("type"),p=h.getAttribute("src");d.push({src:p,type:m,origSrc:null,descSrc:null})}}),r.forEach(h=>{h.remove()}),d.forEach(h=>{const g=document.createElement("source");g.setAttribute("src",h.src),h.type&&g.setAttribute("type",h.type),h.origSrc&&g.setAttribute("data-orig-src",h.origSrc),h.descSrc&&g.setAttribute("data-desc-src",h.descSrc),this.element.appendChild(g)}),this.element.load(),this.invalidateTrackCache()}else this.element.src=this.audioDescriptionSrc}if(await new Promise(r=>{const c=()=>{this.element.removeEventListener("loadedmetadata",c),r()};this.element.addEventListener("loadedmetadata",c)}),this.element.tagName==="VIDEO"&&s===0&&!a&&this.element.readyState>=1&&(this.element.currentTime=.001,this.setManagedTimeout(()=>{this.element.currentTime=0},10)),s>0&&this.seek(s),a&&this.play(),o.length>0&&this.captionManager){const r=this.state.captionsEnabled;let c=null;if(this.captionManager.currentTrack){const d=this.captionManager.tracks.findIndex(h=>h.track===this.captionManager.currentTrack.track);d>=0&&(c={language:this.captionManager.tracks[d].language,kind:this.captionManager.tracks[d].kind})}setTimeout(()=>{if(this.captionManager.tracks=[],this.captionManager.loadTracks(),r&&c&&this.captionManager.tracks.length>0){const d=this.captionManager.tracks.findIndex(h=>h.language===c.language&&h.kind===c.kind);d>=0?this.captionManager.enable(d):this.captionManager.tracks.length>0&&this.captionManager.enable(0)}},600)}if(this.transcriptManager&&this.transcriptManager.isVisible){const r=typeof o<"u"?o:[];if(r.length>0){const c=()=>{this.invalidateTrackCache();const h=this.textTracks,g=r.map(p=>{const b=p.trackElement,v=b.getAttribute("src"),E=b.getAttribute("srclang"),x=b.getAttribute("kind");let C=h.find(w=>b.track===w);if(C||(C=h.find(w=>{if(w.language===E&&(w.kind===x||x==="captions"&&w.kind==="subtitles")){const S=this.findTrackElement(w);if(S&&S.getAttribute("src")===v)return!0}return!1})),C){const w=this.findTrackElement(C);if(w&&w.getAttribute("src")!==v)return null}return C}).filter(Boolean);if(g.length===0){this.setManagedTimeout(()=>{this.transcriptManager&&this.transcriptManager.loadTranscriptData&&this.transcriptManager.loadTranscriptData()},1e3);return}g.forEach(p=>{p.mode==="disabled"&&(p.mode="hidden")});let y=0;const m=()=>{y++,y>=g.length&&this.setManagedTimeout(()=>{if(this.transcriptManager&&this.transcriptManager.loadTranscriptData){this.invalidateTrackCache(),this.textTracks;const p=r.map(v=>v.describedSrc);(g.some(v=>{const E=this.findTrackElement(v);return E&&p.includes(E.getAttribute("src"))})||g.length>0)&&this.transcriptManager.loadTranscriptData()}},800)};g.forEach(p=>{p.mode==="disabled"&&(p.mode="hidden");const b=this.findTrackElement(p),v=b?b.getAttribute("src"):null,E=r.find(C=>{const w=C.trackElement;return w&&(w.track===p||w.getAttribute("srclang")===p.language&&w.getAttribute("kind")===p.kind)}),x=E?E.describedSrc:null;if(x&&v&&v!==x){m();return}if(p.readyState>=2&&p.cues&&p.cues.length>0)m();else{p.mode==="disabled"&&(p.mode="hidden");const C=()=>{this.setManagedTimeout(m,300)};p.readyState>=2?this.setManagedTimeout(()=>{p.cues&&p.cues.length>0?m():p.addEventListener("load",C,{once:!0})},100):(p.addEventListener("load",C,{once:!0}),p.addEventListener("error",()=>{m()},{once:!0}))}})};(()=>{this.setManagedTimeout(()=>{this.element.readyState>=1?c():(this.element.addEventListener("loadedmetadata",c,{once:!0}),this.setManagedTimeout(c,2e3))},500)})(),setTimeout(()=>{this.transcriptManager&&this.transcriptManager.loadTranscriptData&&this.transcriptManager.loadTranscriptData()},5e3)}else setTimeout(()=>{this.transcriptManager&&this.transcriptManager.loadTranscriptData&&this.transcriptManager.loadTranscriptData()},800)}n||this.hidePosterOverlay(),this._audioDescriptionDesiredState&&(this.state.audioDescriptionEnabled=!0,this.emit("audiodescriptionenabled"))}async disableAudioDescription(){if(!this.originalSrc)return;const t=this.state.currentTime,i=this.state.playing;this.audioDescriptionCaptionTracks.length>0&&this.audioDescriptionCaptionTracks.forEach(n=>{n.trackElement&&n.originalTrackSrc&&n.trackElement.setAttribute("src",n.originalTrackSrc)});const s=this.sourceElements;if(s.some(n=>n.getAttribute("data-orig-src"))){const n=[];s.forEach(o=>{const r=o.getAttribute("data-orig-src"),c=o.getAttribute("data-desc-src");if(r){const d=o.getAttribute("type");n.push({src:r,type:d,origSrc:r,descSrc:c})}else{const d=o.getAttribute("type"),h=o.getAttribute("src");n.push({src:h,type:d,origSrc:null,descSrc:c})}}),s.forEach(o=>{o.remove()}),n.forEach(o=>{const r=document.createElement("source");r.setAttribute("src",o.src),o.type&&r.setAttribute("type",o.type),o.origSrc&&r.setAttribute("data-orig-src",o.origSrc),o.descSrc&&r.setAttribute("data-desc-src",o.descSrc);const c=this.element.querySelector("track");c?this.element.insertBefore(r,c):this.element.appendChild(r)}),this._sourceElementsDirty=!0,this._sourceElementsCache=null,this.element.load()}else{const n=this.originalAudioDescriptionSource||this.originalSrc;this.element.src=n,this.element.load()}(t>0||i)&&(await new Promise(n=>{const o=()=>{this.element.removeEventListener("loadedmetadata",o),n()};this.element.addEventListener("loadedmetadata",o)}),t>0&&this.seek(t),i&&this.play()),!i&&t===0?this.showPosterOverlay():this.hidePosterOverlay(),this.transcriptManager&&this.transcriptManager.isVisible&&this.setManagedTimeout(()=>{this.transcriptManager&&this.transcriptManager.loadTranscriptData&&this.transcriptManager.loadTranscriptData()},500),!this._audioDescriptionDesiredState&&(this.state.audioDescriptionEnabled=!1,this.emit("audiodescriptiondisabled"))}async toggleAudioDescription(){const t=this.findTextTrack("descriptions"),i=this.audioDescriptionSrc||this.sourceElements.some(s=>s.getAttribute("data-desc-src"));if(t&&i)if(this.state.audioDescriptionEnabled)this._audioDescriptionDesiredState=!1,t.mode="hidden",await this.disableAudioDescription();else{this._audioDescriptionDesiredState=!0,await this.enableAudioDescription();const s=()=>{this.invalidateTrackCache();const a=this.findTextTrack("descriptions");a?a.mode==="disabled"?(a.mode="hidden",this.setManagedTimeout(()=>{a.mode="showing"},50)):a.mode="showing":this.element.readyState<2&&this.setManagedTimeout(s,100)};this.element.readyState>=1?this.setManagedTimeout(s,200):this.element.addEventListener("loadedmetadata",()=>{this.setManagedTimeout(s,200)},{once:!0})}else t?t.mode==="showing"?(this._audioDescriptionDesiredState=!1,t.mode="hidden",this.state.audioDescriptionEnabled=!1,this.emit("audiodescriptiondisabled")):(this._audioDescriptionDesiredState=!0,t.mode="showing",this.state.audioDescriptionEnabled=!0,this.emit("audiodescriptionenabled")):i&&(this.state.audioDescriptionEnabled?(this._audioDescriptionDesiredState=!1,await this.disableAudioDescription()):(this._audioDescriptionDesiredState=!0,await this.enableAudioDescription()))}enableSignLanguage(){if(!this.signLanguageSrc){console.warn("No sign language video source provided");return}if(this.signLanguageWrapper){this.signLanguageWrapper.style.display="block",this.state.signLanguageEnabled=!0,this.emit("signlanguageenabled");return}this.signLanguageWrapper=document.createElement("div"),this.signLanguageWrapper.className="vidply-sign-language-wrapper",this.signLanguageWrapper.setAttribute("tabindex","0"),this.signLanguageWrapper.setAttribute("aria-label","Sign Language Video - Press D to drag with keyboard, R to resize"),this.signLanguageVideo=document.createElement("video"),this.signLanguageVideo.className="vidply-sign-language-video",this.signLanguageVideo.src=this.signLanguageSrc,this.signLanguageVideo.setAttribute("aria-label",u.t("player.signLanguage")),this.signLanguageVideo.muted=!0;const t=["nw","ne","sw","se"].map(s=>{const a=document.createElement("div");return a.className=`vidply-sign-resize-handle vidply-sign-resize-${s}`,a.setAttribute("data-direction",s),a.setAttribute("aria-label",`Resize ${s.toUpperCase()}`),a});this.signLanguageWrapper.appendChild(this.signLanguageVideo),t.forEach(s=>this.signLanguageWrapper.appendChild(s));const i=this.storage.getSignLanguagePreferences();i&&i.size&&i.size.width?this.signLanguageWrapper.style.width=i.size.width:this.signLanguageWrapper.style.width="280px",this.signLanguageWrapper.style.height="auto",this.signLanguageDesiredPosition=this.options.signLanguagePosition||"bottom-right",this.container.appendChild(this.signLanguageWrapper),requestAnimationFrame(()=>{this.constrainSignLanguagePosition()}),this.signLanguageVideo.currentTime=this.state.currentTime,this.state.paused||this.signLanguageVideo.play(),this.setupSignLanguageInteraction(),this.signLanguageHandlers={play:()=>{this.signLanguageVideo&&this.signLanguageVideo.play()},pause:()=>{this.signLanguageVideo&&this.signLanguageVideo.pause()},timeupdate:()=>{this.signLanguageVideo&&Math.abs(this.signLanguageVideo.currentTime-this.state.currentTime)>.5&&(this.signLanguageVideo.currentTime=this.state.currentTime)},ratechange:()=>{this.signLanguageVideo&&(this.signLanguageVideo.playbackRate=this.state.playbackSpeed)}},this.on("play",this.signLanguageHandlers.play),this.on("pause",this.signLanguageHandlers.pause),this.on("timeupdate",this.signLanguageHandlers.timeupdate),this.on("ratechange",this.signLanguageHandlers.ratechange),this.state.signLanguageEnabled=!0,this.emit("signlanguageenabled")}disableSignLanguage(){this.signLanguageWrapper&&(this.signLanguageWrapper.style.display="none"),this.state.signLanguageEnabled=!1,this.emit("signlanguagedisabled")}toggleSignLanguage(){this.state.signLanguageEnabled?this.disableSignLanguage():this.enableSignLanguage()}setupSignLanguageInteraction(){if(!this.signLanguageWrapper)return;const t=Array.from(this.signLanguageWrapper.querySelectorAll(".vidply-sign-resize-handle"));this.signLanguageDraggable=new $(this.signLanguageWrapper,{dragHandle:this.signLanguageVideo,resizeHandles:t,constrainToViewport:!0,maintainAspectRatio:!0,minWidth:150,minHeight:100,classPrefix:"vidply-sign",keyboardDragKey:"d",keyboardResizeKey:"r",keyboardStep:5,keyboardStepLarge:10}),this.signLanguageInteractionHandlers={draggable:this.signLanguageDraggable}}constrainSignLanguagePosition(){if(!this.signLanguageWrapper||!this.videoWrapper)return;(!this.signLanguageWrapper.style.width||this.signLanguageWrapper.style.width==="")&&(this.signLanguageWrapper.style.width="280px");const t=this.videoWrapper.getBoundingClientRect(),i=this.container.getBoundingClientRect(),s=this.signLanguageWrapper.getBoundingClientRect(),a=t.left-i.left,n=t.top-i.top,o=t.width,r=t.height;let c=s.width||280,d=s.height||280*9/16,h,g;const y=16,m=95;switch(this.signLanguageDesiredPosition||"bottom-right"){case"bottom-right":h=a+o-c-y,g=n+r-d-m;break;case"bottom-left":h=a+y,g=n+r-d-m;break;case"top-right":h=a+o-c-y,g=n+y;break;case"top-left":h=a+y,g=n+y;break;default:h=a+o-c-y,g=n+r-d-m}h=Math.max(a,Math.min(h,a+o-c)),g=Math.max(n,Math.min(g,n+r-d-m)),this.signLanguageWrapper.style.left=`${h}px`,this.signLanguageWrapper.style.top=`${g}px`,this.signLanguageWrapper.style.right="auto",this.signLanguageWrapper.style.bottom="auto",this.signLanguageWrapper.classList.remove(...Array.from(this.signLanguageWrapper.classList).filter(b=>b.startsWith("vidply-sign-position-")))}saveSignLanguagePreferences(){this.signLanguageWrapper&&this.storage.saveSignLanguagePreferences({size:{width:this.signLanguageWrapper.style.width}})}cleanupSignLanguage(){this.signLanguageHandlers&&(this.off("play",this.signLanguageHandlers.play),this.off("pause",this.signLanguageHandlers.pause),this.off("timeupdate",this.signLanguageHandlers.timeupdate),this.off("ratechange",this.signLanguageHandlers.ratechange),this.signLanguageHandlers=null),this.signLanguageDraggable&&(this.signLanguageDraggable.destroy(),this.signLanguageDraggable=null),this.signLanguageInteractionHandlers=null,this.signLanguageWrapper&&this.signLanguageWrapper.parentNode&&(this.signLanguageVideo&&(this.signLanguageVideo.pause(),this.signLanguageVideo.src=""),this.signLanguageWrapper.parentNode.removeChild(this.signLanguageWrapper),this.signLanguageWrapper=null,this.signLanguageVideo=null)}showSettings(){console.warn("[VidPly] Settings dialog has been removed. Use individual control buttons (speed, captions, etc.)")}hideSettings(){}getCurrentTime(){return this.state.currentTime}getDuration(){return this.state.duration}isPlaying(){return this.state.playing}isPaused(){return this.state.paused}isEnded(){return this.state.ended}isMuted(){return this.state.muted}isFullscreen(){return this.state.fullscreen}handleError(t){this.log("Error:",t,"error"),this.emit("error",t),this.options.onError&&this.options.onError.call(this,t)}log(...t){if(!this.options.debug)return;let i="log";if(t.length>0){const s=t[t.length-1];typeof s=="string"&&console[s]&&(i=s,t=t.slice(0,-1))}t.length===0&&(t=[""]),typeof console[i]=="function"?console[i]("[VidPly]",...t):console.log("[VidPly]",...t)}setupResponsiveHandlers(){if(typeof ResizeObserver<"u"?(this.resizeObserver=new ResizeObserver(t=>{for(const i of t){const s=i.contentRect.width;this.controlBar&&typeof this.controlBar.updateControlsForViewport=="function"&&this.controlBar.updateControlsForViewport(s),this.transcriptManager&&this.transcriptManager.isVisible&&this.transcriptManager.positionTranscript()}}),this.resizeObserver.observe(this.container)):(this.resizeHandler=()=>{const t=this.container.clientWidth;this.controlBar&&typeof this.controlBar.updateControlsForViewport=="function"&&this.controlBar.updateControlsForViewport(t),this.transcriptManager&&this.transcriptManager.isVisible&&(!this.transcriptManager.draggableResizable||!this.transcriptManager.draggableResizable.manuallyPositioned)&&this.transcriptManager.positionTranscript()},window.addEventListener("resize",this.resizeHandler)),window.matchMedia){this.orientationHandler=i=>{setTimeout(()=>{this.transcriptManager&&this.transcriptManager.isVisible&&(!this.transcriptManager.draggableResizable||!this.transcriptManager.draggableResizable.manuallyPositioned)&&this.transcriptManager.positionTranscript()},100)};const t=window.matchMedia("(orientation: portrait)");t.addEventListener?t.addEventListener("change",this.orientationHandler):t.addListener&&t.addListener(this.orientationHandler),this.orientationQuery=t}this.fullscreenChangeHandler=()=>{const t=!!(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement);this.state.fullscreen!==t&&(this.state.fullscreen=t,t?this.container.classList.add(`${this.options.classPrefix}-fullscreen`):this.container.classList.remove(`${this.options.classPrefix}-fullscreen`),this.emit("fullscreenchange",t),this.controlBar&&this.controlBar.updateFullscreenButton(),this.signLanguageWrapper&&this.signLanguageWrapper.style.display!=="none"&&this.setManagedTimeout(()=>{requestAnimationFrame(()=>{this.storage.saveSignLanguagePreferences({size:null}),this.signLanguageDesiredPosition="bottom-right",this.signLanguageWrapper.style.width=t?"400px":"280px",this.constrainSignLanguagePosition()})},500))},document.addEventListener("fullscreenchange",this.fullscreenChangeHandler),document.addEventListener("webkitfullscreenchange",this.fullscreenChangeHandler),document.addEventListener("mozfullscreenchange",this.fullscreenChangeHandler),document.addEventListener("MSFullscreenChange",this.fullscreenChangeHandler)}destroy(){if(this.log("Destroying player"),this.renderer&&this.renderer.destroy(),this.controlBar&&this.controlBar.destroy(),this.captionManager&&this.captionManager.destroy(),this.keyboardManager&&this.keyboardManager.destroy(),this.transcriptManager&&this.transcriptManager.destroy(),this.cleanupSignLanguage(),this.playButtonOverlay&&this.playButtonOverlay.parentNode&&(this.playButtonOverlay.remove(),this.playButtonOverlay=null),this.resizeObserver&&(this.resizeObserver.disconnect(),this.resizeObserver=null),this.resizeHandler&&(window.removeEventListener("resize",this.resizeHandler),this.resizeHandler=null),this.orientationQuery&&this.orientationHandler&&(this.orientationQuery.removeEventListener?this.orientationQuery.removeEventListener("change",this.orientationHandler):this.orientationQuery.removeListener&&this.orientationQuery.removeListener(this.orientationHandler),this.orientationQuery=null,this.orientationHandler=null),this.fullscreenChangeHandler&&(document.removeEventListener("fullscreenchange",this.fullscreenChangeHandler),document.removeEventListener("webkitfullscreenchange",this.fullscreenChangeHandler),document.removeEventListener("mozfullscreenchange",this.fullscreenChangeHandler),document.removeEventListener("MSFullscreenChange",this.fullscreenChangeHandler),this.fullscreenChangeHandler=null),this.timeouts.forEach(t=>clearTimeout(t)),this.timeouts.clear(),this.metadataCueChangeHandler){const i=this.textTracks.find(s=>s.kind==="metadata");i&&i.removeEventListener("cuechange",this.metadataCueChangeHandler),this.metadataCueChangeHandler=null}this.metadataAlertHandlers&&this.metadataAlertHandlers.size>0&&(this.metadataAlertHandlers.forEach(({button:t,handler:i})=>{t&&i&&t.removeEventListener("click",i)}),this.metadataAlertHandlers.clear()),this.container&&this.container.parentNode&&(this.container.parentNode.insertBefore(this.element,this.container),this.container.parentNode.removeChild(this.container)),this.removeAllListeners()}setupMetadataHandling(){const t=()=>{const s=this.textTracks.find(a=>a.kind==="metadata");if(s){if(s.mode==="disabled"&&(s.mode="hidden"),this.metadataCueChangeHandler&&s.removeEventListener("cuechange",this.metadataCueChangeHandler),this.metadataCueChangeHandler=()=>{const a=Array.from(s.activeCues||[]);a.length>0&&this.options.debug&&this.log("[Metadata] Active cues:",a.map(n=>({start:n.startTime,end:n.endTime,text:n.text}))),a.forEach(n=>{this.handleMetadataCue(n)})},s.addEventListener("cuechange",this.metadataCueChangeHandler),this.options.debug){const a=s.cues?s.cues.length:0;this.log("[Metadata] Track enabled,",a,"cues available")}}else this.options.debug&&this.log("[Metadata] No metadata track found")};t(),this.on("loadedmetadata",t)}normalizeMetadataSelector(t){if(!t)return null;const i=t.trim();return i?i.startsWith("#")||i.startsWith(".")||i.startsWith("[")?i:`#${i}`:null}resolveMetadataConfig(t,i){if(!t||!i)return null;if(Object.prototype.hasOwnProperty.call(t,i))return t[i];const s=i.replace(/^#/,"");return Object.prototype.hasOwnProperty.call(t,s)?t[s]:null}cacheMetadataAlertContent(t,i={}){if(!t)return;const s=i.titleSelector||"[data-vidply-alert-title], h3, header",a=i.messageSelector||"[data-vidply-alert-message], p",n=t.querySelector(s);n&&!n.dataset.vidplyAlertTitleOriginal&&(n.dataset.vidplyAlertTitleOriginal=n.textContent.trim());const o=t.querySelector(a);o&&!o.dataset.vidplyAlertMessageOriginal&&(o.dataset.vidplyAlertMessageOriginal=o.textContent.trim())}restoreMetadataAlertContent(t,i={}){if(!t)return;const s=i.titleSelector||"[data-vidply-alert-title], h3, header",a=i.messageSelector||"[data-vidply-alert-message], p",n=t.querySelector(s);n&&n.dataset.vidplyAlertTitleOriginal&&(n.textContent=n.dataset.vidplyAlertTitleOriginal);const o=t.querySelector(a);o&&o.dataset.vidplyAlertMessageOriginal&&(o.textContent=o.dataset.vidplyAlertMessageOriginal)}focusMetadataTarget(t,i=null){var s,a;if(!(!t||t==="none")){if(t==="alert"&&i){i.focus();return}if(t==="player"){this.container&&this.container.focus();return}if(t==="media"){this.element.focus();return}if(t==="playButton"){const n=(a=(s=this.controlBar)==null?void 0:s.controls)==null?void 0:a.playPause;n&&n.focus();return}if(typeof t=="string"){const n=document.querySelector(t);n&&(n.tabIndex===-1&&!n.hasAttribute("tabindex")&&n.setAttribute("tabindex","-1"),n.focus())}}}handleMetadataAlert(t,i={}){if(!t)return;const s=this.resolveMetadataConfig(this.options.metadataAlerts,t)||{},a=i.element||document.querySelector(t);if(!a){this.options.debug&&this.log("[Metadata] Alert element not found:",t);return}this.options.debug&&this.log("[Metadata] Handling alert",t,{reason:i.reason,config:s}),this.cacheMetadataAlertContent(a,s),a.dataset.vidplyAlertOriginalDisplay||(a.dataset.vidplyAlertOriginalDisplay=a.style.display||""),a.dataset.vidplyAlertDisplay||(a.dataset.vidplyAlertDisplay=s.display||"block");const n=i.show!==void 0?i.show:s.show!==!1;if(n){const d=s.display||a.dataset.vidplyAlertDisplay||"block";a.style.display=d,a.hidden=!1,a.removeAttribute("hidden"),a.setAttribute("aria-hidden","false"),a.setAttribute("data-vidply-alert-active","true")}s.resetContent!==!1&&i.reason==="focus"&&this.restoreMetadataAlertContent(a,s);const r=i.focus!==void 0?i.focus:s.focusOnShow??i.reason!=="focus";n&&r&&(a.tabIndex===-1&&!a.hasAttribute("tabindex")&&a.setAttribute("tabindex","-1"),a.focus()),n&&s.autoScroll!==!1&&i.autoScroll!==!1&&a.scrollIntoView({behavior:"smooth",block:"nearest"});const c=s.continueButton;if(c){let d=null;if(c==="self"||a.matches(c)?d=a:d=a.querySelector(c)||document.querySelector(c),d&&!this.metadataAlertHandlers.has(t)){const h=()=>{if(s.hideOnContinue!==!1){const m=a.dataset.vidplyAlertOriginalDisplay||"";a.style.display=s.hideDisplay||m||"none",a.setAttribute("aria-hidden","true"),a.removeAttribute("data-vidply-alert-active")}s.resume!==!1&&this.state.paused&&this.play();const y=s.focusTarget||"playButton";this.setManagedTimeout(()=>{this.focusMetadataTarget(y,a)},s.focusDelay??100)};d.addEventListener("click",h),this.metadataAlertHandlers.set(t,{button:d,handler:h})}}return a}handleMetadataHashtags(t){if(!Array.isArray(t)||t.length===0)return;const i=this.options.metadataHashtags;i&&t.forEach(s=>{const a=this.resolveMetadataConfig(i,s);if(!a)return;const n=this.normalizeMetadataSelector(a.alert||a.selector||a.target);if(!n)return;const o=document.querySelector(n);if(!o){this.options.debug&&this.log("[Metadata] Hashtag target not found:",n);return}if(this.options.debug&&this.log("[Metadata] Handling hashtag",s,{selector:n,config:a}),this.cacheMetadataAlertContent(o,a),a.title){const d=a.titleSelector||"[data-vidply-alert-title], h3, header",h=o.querySelector(d);h&&(h.textContent=a.title)}if(a.message){const d=a.messageSelector||"[data-vidply-alert-message], p",h=o.querySelector(d);h&&(h.textContent=a.message)}const r=a.show!==!1,c=a.focus!==void 0?a.focus:!1;this.handleMetadataAlert(n,{element:o,show:r,focus:c,autoScroll:a.autoScroll,reason:"hashtag"})})}handleMetadataCue(t){const i=t.text.trim();this.options.debug&&this.log("[Metadata] Processing cue:",{time:t.startTime,text:i}),this.emit("metadata",{time:t.startTime,endTime:t.endTime,text:i,cue:t}),i.includes("PAUSE")&&(this.state.paused||(this.options.debug&&this.log("[Metadata] Pausing video at",t.startTime),this.pause()),this.emit("metadata:pause",{time:t.startTime,text:i}));const s=i.match(/FOCUS:([\w#-]+)/);if(s){const n=s[1],o=this.normalizeMetadataSelector(n),r=o?document.querySelector(o):null;r?(this.options.debug&&this.log("[Metadata] Focusing element:",o),r.tabIndex===-1&&!r.hasAttribute("tabindex")&&r.setAttribute("tabindex","-1"),this.setManagedTimeout(()=>{r.focus(),r.scrollIntoView({behavior:"smooth",block:"nearest"})},10)):this.options.debug&&this.log("[Metadata] Element not found:",o||n),this.emit("metadata:focus",{time:t.startTime,target:n,selector:o,element:r,text:i}),o&&this.handleMetadataAlert(o,{element:r,reason:"focus"})}const a=i.match(/#[\w-]+/g);a&&(this.options.debug&&this.log("[Metadata] Hashtags found:",a),this.emit("metadata:hashtags",{time:t.startTime,hashtags:a,text:i}),this.handleMetadataHashtags(a))}};N.instances=[];function R(){document.querySelectorAll("[data-vidply]").forEach(t=>{const i=t.dataset.vidplyOptions?JSON.parse(t.dataset.vidplyOptions):{},a={...se(t.dataset),...i};new N(t,a)})}function se(e){const t={},i={signLanguageSrc:"signLanguageSrc",signLanguageButton:"signLanguageButton",signLanguagePosition:"signLanguagePosition",audioDescriptionSrc:"audioDescriptionSrc",audioDescriptionButton:"audioDescriptionButton",autoplay:"autoplay",loop:"loop",muted:"muted",controls:"controls",poster:"poster",width:"width",height:"height",language:"language",captions:"captions",captionsDefault:"captionsDefault",transcript:"transcript",transcriptButton:"transcriptButton",keyboard:"keyboard",responsive:"responsive",pipButton:"pipButton",fullscreenButton:"fullscreenButton"};return Object.keys(i).forEach(s=>{const a=i[s],n=e[s];n!==void 0&&(n==="true"?t[a]=!0:n==="false"?t[a]=!1:!isNaN(n)&&n!==""?t[a]=Number(n):t[a]=n)}),t}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",R):R();
